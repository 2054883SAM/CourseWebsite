"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2446],{2374:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{cancelIdleCallback:function(){return a},requestIdleCallback:function(){return r}});let r="undefined"!=typeof self&&self.requestIdleCallback&&self.requestIdleCallback.bind(window)||function(e){let t=Date.now();return self.setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},a="undefined"!=typeof self&&self.cancelIdleCallback&&self.cancelIdleCallback.bind(window)||function(e){return clearTimeout(e)};("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},2446:(e,t,r)=>{r.d(t,{A:()=>s});var a=r(5155),n=r(2115),i=r(3554),o=r(8998),l=r(6738);let s=(0,n.memo)(function(e){let{videoId:t,watermark:r,className:s,chapters:c=[],userId:d,courseId:u,duration:f,onChapterSeek:p,onProgress:h,onComplete:y,onChapterComplete:m}=e,g=(0,n.useRef)(null),v=(0,n.useRef)(!1),x=(0,n.useRef)(!1),[b,w]=(0,n.useState)(null),[j,k]=(0,n.useState)(0),[_,C]=(0,n.useState)(!1),N=(0,l.UQ)(c),I=(0,n.useRef)(0),T=(0,n.useRef)(-1),P=(0,n.useRef)(!1),S=(0,n.useRef)(!1),O=(0,n.useRef)(new Set);(0,n.useEffect)(()=>{if(v.current||!t)return;v.current=!0;let e=async()=>{try{console.log("Fetching VdoCipher OTP for videoId:",t);let e=await fetch("/api/video/vdocipher-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoId:t})});if(!e.ok)return void console.error("Failed to fetch VdoCipher OTP",await e.text());let{otp:a,playbackInfo:n}=await e.json(),i=r?"&watermark=".concat(encodeURIComponent("text:".concat(r,",opacity:0.5,size:14,pos:top-right"))):"",o="https://player.vdocipher.com/v2/?otp=".concat(a,"&playbackInfo=").concat(n).concat(i);console.log("VdoCipher player initialized successfully"),w(o);try{sessionStorage.setItem("vdoCipher_".concat(t),o)}catch(e){console.warn("Could not store player URL in sessionStorage:",e)}}catch(e){console.error("Error loading video player:",e)}};try{let e=sessionStorage.getItem("vdoCipher_".concat(t));if(e){console.log("Retrieved player URL from sessionStorage"),w(e);return}}catch(e){console.warn("Could not read from sessionStorage:",e)}e()},[t,r]),(0,n.useEffect)(()=>{if(!b||!g.current)return;let e=async()=>{try{if(!window.VdoPlayer)return void console.warn("VdoPlayer API not available yet, waiting...");if(!g.current)return void console.warn("iframe reference is not available");console.log("Setting up VdoCipher player using VdoPlayer API"),x.current=!0;let e=g.current,t=window.VdoPlayer.getInstance(e);try{(null==t?void 0:t.video)&&t.video.addEventListener("play",()=>{P.current=!0})}catch(e){console.warn("Could not attach play listener:",e)}if((!N||0===N.length)&&t.api)try{let e=await t.api.getMetaData();e&&e.chapters&&e.chapters.length>0&&console.log("Retrieved chapters from VdoCipher metadata:",e.chapters)}catch(e){console.error("Error fetching VdoCipher metadata:",e)}let r=null,a=async e=>{if(!d||!u)return;let t=Date.now();if(!(t-I.current<5e3)&&T.current!==e){I.current=t,T.current=e;try{let t=await fetch("/api/courses/progress/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:d,courseId:u,progress:e})});t.ok||console.error("Failed to update progress:",await t.text())}catch(e){console.error("Error updating progress:",e)}}};return r=setInterval(()=>{if(e&&window.VdoPlayer)try{var t,r,n,i,o;let l=window.VdoPlayer.getInstance(e),s=l.video.currentTime,c=(null==(t=l.video)?void 0:t.duration)||f||0;if(k(s),c>0&&P.current){let e=Math.min(Math.round(s/c*100),100);if("function"==typeof h)try{h(e)}catch(e){}if(!S.current&&e>=100){S.current=!0;try{null==(r=(n=l.video).pause)||r.call(n)}catch(e){}if("function"==typeof y)try{y()}catch(e){}}d&&u&&a(e)}if(N&&N.length>0){let e=N.findIndex((e,t)=>{let r=N[t+1];return e.startTime<=s&&(!r||s<r.startTime)});if(e>=0){let t=N[e],r=N[e+1],a=Number.NaN;if("number"==typeof t.duration&&t.duration>0?a=t.startTime+t.duration:r?a=r.startTime:c>0&&(a=c),!Number.isNaN(a)&&P.current&&!0===t.flashcard&&s>=a-.25&&!O.current.has(t.id)){O.current.add(t.id);try{null==(i=(o=l.video).pause)||i.call(o)}catch(e){}if("function"==typeof m)try{m(t)}catch(e){}}}}}catch(e){console.error("Error getting currentTime from VdoPlayer API:",e)}},1e3),()=>{r&&clearInterval(r)}}catch(e){console.error("Error initializing VdoPlayer:",e)}},t=setTimeout(()=>{e()},1e3),r=g.current;return r&&r.addEventListener("load",e),()=>{clearTimeout(t),r&&r.removeEventListener("load",e)}},[b,c,p,N,d,u,f,h,y,m]);let M=b?(0,a.jsx)("iframe",{ref:g,src:b,width:"100%",height:"100%",style:{aspectRatio:"16 / 9",border:"none"},allowFullScreen:!0,allow:"encrypted-media",sandbox:"allow-scripts allow-same-origin allow-presentation allow-popups"},"player-".concat(t)):(0,a.jsx)("div",{className:"flex aspect-video w-full items-center justify-center text-gray-500",children:"Loading secure video..."});return(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,a.jsx)(i.default,{src:"https://player.vdocipher.com/v2/api.js",strategy:"afterInteractive"}),(0,a.jsx)("div",{className:"col-span-1 md:col-span-2",children:(0,a.jsx)("div",{className:s,children:M})}),N&&N.length>0&&(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsx)(o.A,{chapters:N,currentTime:j,onChapterClick:e=>{C(!0);try{if(g.current&&window.VdoPlayer){console.log("Seeking to chapter at time: ".concat(e.startTime));let t=g.current;if(!t)throw Error("Iframe element is null");let r=window.VdoPlayer.getInstance(t);r.video.currentTime=e.startTime,r.video.play(),k(e.startTime),p&&p(e,e.startTime),setTimeout(()=>{C(!1)},1e3)}else console.error("Player iframe not available for seeking or VdoPlayer API not loaded"),C(!1)}catch(e){console.error("Error seeking to chapter:",e),C(!1)}},isLoading:_,onFinish:()=>{try{if(g.current&&window.VdoPlayer){var e,t,r;let a=g.current,n=window.VdoPlayer.getInstance(a),i=(null==(e=n.video)?void 0:e.duration)||f||0;if(i>0){let e=Math.max(i-.05,0);if(n.video.currentTime=e,null==(t=(r=n.video).play)||t.call(r),"function"==typeof h)try{h(100)}catch(e){}if(!S.current&&"function"==typeof y){S.current=!0;try{y()}catch(e){}}d&&u&&fetch("/api/courses/progress/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:d,courseId:u,progress:100})}).catch(()=>{})}}}catch(e){console.warn("Could not jump to end:",e)}}})})]})},(e,t)=>{let r=e.videoId===t.videoId,a=e.watermark===t.watermark,n=e.onChapterSeek===t.onChapterSeek,i=!e.chapters&&!t.chapters||Array.isArray(e.chapters)&&Array.isArray(t.chapters)&&e.chapters.length===t.chapters.length;return r&&a&&i&&n})},2714:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"setAttributesFromProps",{enumerable:!0,get:function(){return i}});let r={acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv",noModule:"noModule"},a=["onLoad","onReady","dangerouslySetInnerHTML","children","onError","strategy","stylesheets"];function n(e){return["async","defer","noModule"].includes(e)}function i(e,t){for(let[i,o]of Object.entries(t)){if(!t.hasOwnProperty(i)||a.includes(i)||void 0===o)continue;let l=r[i]||i.toLowerCase();"SCRIPT"===e.tagName&&n(l)?e[l]=!!o:e.setAttribute(l,String(o)),(!1===o||"SCRIPT"===e.tagName&&n(l)&&(!o||"false"===o))&&(e.setAttribute(l,""),e.removeAttribute(l))}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},3554:(e,t,r)=>{r.d(t,{default:()=>n.a});var a=r(9243),n=r.n(a)},8998:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5155);r(2115);var n=r(6738);let i=e=>{let t=Math.floor(e/60),r=Math.floor(e%60);return"".concat(t,":").concat(r.toString().padStart(2,"0"))},o=(e,t)=>{var r;let a=[...e].sort((e,t)=>e.startTime-t.startTime);for(let e=a.length-1;e>=0;e--)if(t>=a[e].startTime)return a[e].id;return(null==(r=a[0])?void 0:r.id)||null},l=e=>{let{chapters:t,currentTime:r,onChapterClick:l,className:s="",isLoading:c=!1,onFinish:d}=e,u=(0,n.UQ)(t);if(!u||0===u.length)return(0,a.jsx)("div",{className:"p-4 text-center text-gray-500 ".concat(s),children:(0,a.jsx)("p",{children:"No chapters available"})});let f=o(u,r);return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg ".concat(s),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[(0,a.jsx)("svg",{className:"w-5 h-5 mr-2 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),"Chapitres"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[t.length," chapitre",1!==t.length?"s":""]}),(0,a.jsx)("div",{className:"mt-3 flex justify-end",children:(0,a.jsx)("button",{type:"button",className:"rounded bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-indigo-700 disabled:opacity-50",onClick:()=>d&&d(),disabled:!!c,title:"Mark video as finished and jump near the end",children:"Termin\xe9"})})]}),(0,a.jsx)("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:u.map((e,t)=>{let r=e.id===f;return(0,a.jsx)("div",{"data-testid":"chapter-".concat(e.id),className:"\n                transition-colors duration-200\n                ".concat(r?"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500":"hover:bg-gray-50 dark:hover:bg-gray-700/50","\n              "),children:(0,a.jsxs)("button",{"data-testid":"chapter-button-".concat(e.id),onClick:()=>l(e),disabled:c,className:"w-full p-4 text-left focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset ".concat(c?"opacity-50 cursor-not-allowed":""),"aria-label":"Chapter ".concat(t+1,": ").concat(e.title),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center mb-1",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-xs font-medium rounded-full flex items-center justify-center mr-3",children:t+1}),(0,a.jsx)("h4",{className:"text-sm font-medium truncate ".concat(r?"text-blue-700 dark:text-blue-300":"text-gray-900 dark:text-white"),children:e.title}),!0===e.flashcard&&(0,a.jsx)("span",{className:"ml-2 inline-flex items-center",title:"Flashcard available","aria-label":"Flashcard available",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-yellow-500",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:(0,a.jsx)("path",{d:"M12 2l2.39 4.84 5.34.78-3.86 3.76.91 5.32L12 14.77 6.22 16.7l.91-5.32-3.86-3.76 5.34-.78L12 2z"})})})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 ml-9",children:e.description})]}),(0,a.jsxs)("div",{className:"flex-shrink-0 ml-4 text-right",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:i(e.startTime)}),e.duration&&(0,a.jsx)("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:i(e.duration+e.startTime)})]})]}),r&&(0,a.jsxs)("div",{className:"flex items-center mt-2 ml-9",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse mr-2"}),(0,a.jsx)("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium",children:"En cours"})]})]})},e.id)})})]})}},9243:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return v},handleClientScriptLoad:function(){return y},initScriptLoader:function(){return m}});let a=r(8229),n=r(6966),i=r(5155),o=a._(r(7650)),l=n._(r(2115)),s=r(2830),c=r(2714),d=r(2374),u=new Map,f=new Set,p=e=>{if(o.default.preinit)return void e.forEach(e=>{o.default.preinit(e,{as:"style"})});{let t=document.head;e.forEach(e=>{let r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,t.appendChild(r)})}},h=e=>{let{src:t,id:r,onLoad:a=()=>{},onReady:n=null,dangerouslySetInnerHTML:i,children:o="",strategy:l="afterInteractive",onError:s,stylesheets:d}=e,h=r||t;if(h&&f.has(h))return;if(u.has(t)){f.add(h),u.get(t).then(a,s);return}let y=()=>{n&&n(),f.add(h)},m=document.createElement("script"),g=new Promise((e,t)=>{m.addEventListener("load",function(t){e(),a&&a.call(this,t),y()}),m.addEventListener("error",function(e){t(e)})}).catch(function(e){s&&s(e)});i?(m.innerHTML=i.__html||"",y()):o?(m.textContent="string"==typeof o?o:Array.isArray(o)?o.join(""):"",y()):t&&(m.src=t,u.set(t,g)),(0,c.setAttributesFromProps)(m,e),"worker"===l&&m.setAttribute("type","text/partytown"),m.setAttribute("data-nscript",l),d&&p(d),document.body.appendChild(m)};function y(e){let{strategy:t="afterInteractive"}=e;"lazyOnload"===t?window.addEventListener("load",()=>{(0,d.requestIdleCallback)(()=>h(e))}):h(e)}function m(e){e.forEach(y),[...document.querySelectorAll('[data-nscript="beforeInteractive"]'),...document.querySelectorAll('[data-nscript="beforePageRender"]')].forEach(e=>{let t=e.id||e.getAttribute("src");f.add(t)})}function g(e){let{id:t,src:r="",onLoad:a=()=>{},onReady:n=null,strategy:c="afterInteractive",onError:u,stylesheets:p,...y}=e,{updateScripts:m,scripts:g,getIsSsr:v,appDir:x,nonce:b}=(0,l.useContext)(s.HeadManagerContext),w=(0,l.useRef)(!1);(0,l.useEffect)(()=>{let e=t||r;w.current||(n&&e&&f.has(e)&&n(),w.current=!0)},[n,t,r]);let j=(0,l.useRef)(!1);if((0,l.useEffect)(()=>{if(!j.current){if("afterInteractive"===c)h(e);else"lazyOnload"===c&&("complete"===document.readyState?(0,d.requestIdleCallback)(()=>h(e)):window.addEventListener("load",()=>{(0,d.requestIdleCallback)(()=>h(e))}));j.current=!0}},[e,c]),("beforeInteractive"===c||"worker"===c)&&(m?(g[c]=(g[c]||[]).concat([{id:t,src:r,onLoad:a,onReady:n,onError:u,...y}]),m(g)):v&&v()?f.add(t||r):v&&!v()&&h(e)),x){if(p&&p.forEach(e=>{o.default.preinit(e,{as:"style"})}),"beforeInteractive"===c)if(!r)return y.dangerouslySetInnerHTML&&(y.children=y.dangerouslySetInnerHTML.__html,delete y.dangerouslySetInnerHTML),(0,i.jsx)("script",{nonce:b,dangerouslySetInnerHTML:{__html:"(self.__next_s=self.__next_s||[]).push("+JSON.stringify([0,{...y,id:t}])+")"}});else return o.default.preload(r,y.integrity?{as:"script",integrity:y.integrity,nonce:b,crossOrigin:y.crossOrigin}:{as:"script",nonce:b,crossOrigin:y.crossOrigin}),(0,i.jsx)("script",{nonce:b,dangerouslySetInnerHTML:{__html:"(self.__next_s=self.__next_s||[]).push("+JSON.stringify([r,{...y,id:t}])+")"}});"afterInteractive"===c&&r&&o.default.preload(r,y.integrity?{as:"script",integrity:y.integrity,nonce:b,crossOrigin:y.crossOrigin}:{as:"script",nonce:b,crossOrigin:y.crossOrigin})}return null}Object.defineProperty(g,"__nextScript",{value:!0});let v=g;("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}}]);