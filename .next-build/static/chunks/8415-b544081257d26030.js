"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8415],{20:(e,t,r)=>{r.d(t,{As:()=>l,OJ:()=>i,cy:()=>a});var n=r(5155),s=r(2115),o=r(6414);let a=(0,s.createContext)(null);function i(e){let{children:t}=e,[r,i]=(0,s.useState)(null),[l,u]=(0,s.useState)(null),[c,d]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=(()=>{let e="https://qrowzznnnarfogfbnnow.supabase.co";if(!e)return"default";let t=e.match(/https:\/\/([a-z0-9-]+)\.supabase\.co/);return t?t[1]:"default"})();console.log("Auth cookies at startup:",document.cookie.split(";").map(e=>e.trim()).filter(e=>e.startsWith("sb-")||e.includes("supabase"))),console.log("Looking for cookie format:","sb-".concat(e,"-auth-token")),o.N.auth.getUser().then(e=>{let{data:{user:t},error:r}=e;r&&console.error("Error getting initial user:",r),console.log("Initial auth user:",t?"Present":"None",t?"(User: ".concat(t.email,")"):""),i(null!=t?t:null),t?h(t.id):d(!1)});let{data:{subscription:t}}=o.N.auth.onAuthStateChange(async(e,t)=>{var r;if(console.log("Auth state change event:",e),console.log("Session after event:",t?"Present":"None"),i(null!=(r=null==t?void 0:t.user)?r:null),null==t?void 0:t.user){if("SIGNED_IN"===e||"TOKEN_REFRESHED"===e)try{await fetch("/api/auth/cookie",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:t.access_token,refresh_token:t.refresh_token}),credentials:"include"})}catch(e){console.warn("Failed to sync auth cookies on state change:",e)}h(t.user.id)}else u(null),d(!1)});return()=>{t.unsubscribe()}},[]);let h=async e=>{try{let{data:t,error:r}=await o.N.from("users").select("*").eq("id",e).single();if(r)throw r;u(t)}catch(e){console.error("Error fetching user data:",e),u(null)}finally{d(!1)}},m=async(e,t)=>{try{console.log("Attempting sign in for:",e),await o.N.auth.signOut();let{data:r,error:n}=await o.N.auth.signInWithPassword({email:e,password:t});return r.session&&await fetch("/api/auth/cookie",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:r.session.access_token,refresh_token:r.session.refresh_token}),credentials:"include"}),{error:n}}catch(e){return console.error("Unexpected error during sign in:",e),{error:e}}},g=async()=>{try{await o.N.auth.signOut(),console.log("Sign out completed. Session cleared.")}catch(e){console.error("Error signing out:",e)}},p=async(e,t,r)=>{try{console.log("Attempting sign up for:",e);let{data:s,error:a}=await o.N.auth.signUp({email:e,password:t,options:{data:{name:r},emailRedirectTo:"".concat(window.location.origin,"/signin")}});if(a)throw a;let i={success:!a,user:s.user?"".concat(s.user.email):"Missing",session:s.session?"Present":"Missing (email confirmation may be required)"};console.log("Sign up response:",i);let l=!s.session;if(s.user){var n;return{error:null,requiresEmailConfirmation:l,email:null!=(n=s.user.email)?n:e}}throw Error("Signup failed. Please try again.")}catch(e){return console.error("Error during sign up:",e),{error:e,requiresEmailConfirmation:!1}}},f=async e=>{try{let{error:t}=await o.N.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});if(t)return{error:t};return{error:null}}catch(e){return console.error("Error sending password reset email:",e),{error:e}}},y=async(e,t)=>{try{let{data:r,error:n}=await o.N.auth.signInWithOAuth({provider:e,options:{redirectTo:null!=t?t:"".concat(window.location.origin,"/"),queryParams:{prompt:"select_account"}}});if(n)throw n;return{error:null}}catch(e){return console.error("OAuth sign-in error:",e),{error:e}}};return(0,n.jsx)(a.Provider,{value:{user:r,dbUser:l,loading:c,signIn:m,signOut:g,signUp:p,signInWithProvider:y,resetPassword:f,checkPermission:e=>{let t=null==l?void 0:l.role;return!!t&&("admin"===e?"admin"===t:"teacher"===e?"admin"===t||"teacher"===t:"student"===e)}},children:t})}function l(){let e=(0,s.useContext)(a);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},1477:(e,t,r)=>{r.d(t,{Newsletter:()=>o});var n=r(5155),s=r(2115);function o(e){let{title:t="Abonnez-vous \xe0 notre newsletter",description:r="Recevez les derni\xe8res mises \xe0 jour et actualit\xe9s directement dans votre bo\xeete mail.",className:o=""}=e,[a,i]=(0,s.useState)(""),[l,u]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!1),[h,m]=(0,s.useState)(null),g="newsletter-email",p=async e=>{e.preventDefault(),u(!0),m(null);try{await new Promise(e=>setTimeout(e,1e3)),d(!0),i("")}catch(e){m("Une erreur est survenue. Veuillez r\xe9essayer.")}finally{u(!1)}};return(0,n.jsxs)("div",{className:"".concat(o),role:"region","aria-labelledby":"newsletter-heading",children:[(0,n.jsx)("h3",{id:"newsletter-heading",className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3",children:t}),(0,n.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",id:"newsletter-description",children:r}),c?(0,n.jsx)("div",{className:"bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-300 p-3 rounded-md text-sm",role:"status","aria-live":"polite",children:"Merci pour votre abonnement ! Nous vous avons envoy\xe9 un e-mail de confirmation."}):(0,n.jsxs)("form",{onSubmit:p,className:"space-y-3",id:"newsletter-form","aria-describedby":"newsletter-description",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:g,className:"sr-only",children:"Adresse e-mail"}),(0,n.jsx)("input",{id:g,name:"email",type:"email",autoComplete:"email",required:!0,value:a,onChange:e=>i(e.target.value),className:"w-full px-4 py-2 text-base text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Entrez votre adresse e-mail","aria-required":"true","aria-invalid":h?"true":"false"})]}),h&&(0,n.jsx)("div",{className:"text-red-600 dark:text-red-400 text-sm",role:"alert","aria-live":"assertive",children:h}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{type:"submit",disabled:l,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed","aria-busy":l,children:l?"Abonnement en cours...":"S'abonner"})})]})]})}},3107:(e,t,r)=>{r.d(t,{As:()=>o,aU:()=>l,h7:()=>i});var n=r(2115),s=r(20);function o(){let e=(0,n.useContext)(s.cy);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}r(5695);let a=e=>{let{checkPermission:t,loading:r}=o();return{hasRole:t(e),loading:r}},i=()=>a("admin"),l=()=>a("teacher")},6414:(e,t,r)=>{r.d(t,{N:()=>l});var n=r(5647);let s="https://qrowzznnnarfogfbnnow.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI";if(!s)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_URL");if(!o)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_ANON_KEY");let a=(()=>{if(!s)return"default";let e=s.match(/https:\/\/([a-z0-9-]+)\.supabase\.co/);return e?e[1]:"default"})();console.log("Supabase project ref for cookies:",a);let i={auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storageKey:"sb-".concat(a,"-auth-token"),cookieOptions:{name:"sb-".concat(a,"-auth-token"),path:"/",sameSite:"Lax",secure:!0,maxAge:604800}}};console.log("Supabase client initialized with cookie config:",{cookieName:i.auth.cookieOptions.name,cookiePath:i.auth.cookieOptions.path,detectSessionInUrl:i.auth.detectSessionInUrl,persistSession:i.auth.persistSession});let l=(0,n.UU)(s,o,i);l.auth.getUser().then(()=>{}),l.auth.onAuthStateChange((e,t)=>{console.log("Supabase auth event:",e)}),window.addEventListener("focus",()=>{l.auth.refreshSession().catch(e=>{console.error("Error refreshing Supabase session on focus:",e)})})}}]);