(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8407],{20:(e,s,t)=>{"use strict";t.d(s,{As:()=>l,OJ:()=>i,cy:()=>o});var r=t(5155),n=t(2115),a=t(6414);let o=(0,n.createContext)(null);function i(e){let{children:s}=e,[t,i]=(0,n.useState)(null),[l,c]=(0,n.useState)(null),[u,d]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=(()=>{let e="https://qrowzznnnarfogfbnnow.supabase.co";if(!e)return"default";let s=e.match(/https:\/\/([a-z0-9-]+)\.supabase\.co/);return s?s[1]:"default"})();console.log("Auth cookies at startup:",document.cookie.split(";").map(e=>e.trim()).filter(e=>e.startsWith("sb-")||e.includes("supabase"))),console.log("Looking for cookie format:","sb-".concat(e,"-auth-token")),a.N.auth.getUser().then(e=>{let{data:{user:s},error:t}=e;t&&console.error("Error getting initial user:",t),console.log("Initial auth user:",s?"Present":"None",s?"(User: ".concat(s.email,")"):""),i(null!=s?s:null),s?h(s.id):d(!1)});let{data:{subscription:s}}=a.N.auth.onAuthStateChange(async(e,s)=>{var t;if(console.log("Auth state change event:",e),console.log("Session after event:",s?"Present":"None"),i(null!=(t=null==s?void 0:s.user)?t:null),null==s?void 0:s.user){if("SIGNED_IN"===e||"TOKEN_REFRESHED"===e)try{await fetch("/api/auth/cookie",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:s.access_token,refresh_token:s.refresh_token}),credentials:"include"})}catch(e){console.warn("Failed to sync auth cookies on state change:",e)}h(s.user.id)}else c(null),d(!1)});return()=>{s.unsubscribe()}},[]);let h=async e=>{try{let{data:s,error:t}=await a.N.from("users").select("*").eq("id",e).single();if(t)throw t;c(s)}catch(e){console.error("Error fetching user data:",e),c(null)}finally{d(!1)}},m=async(e,s)=>{try{console.log("Attempting sign in for:",e),await a.N.auth.signOut();let{data:t,error:r}=await a.N.auth.signInWithPassword({email:e,password:s});return t.session&&await fetch("/api/auth/cookie",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:t.session.access_token,refresh_token:t.session.refresh_token}),credentials:"include"}),{error:r}}catch(e){return console.error("Unexpected error during sign in:",e),{error:e}}},x=async()=>{try{await a.N.auth.signOut(),console.log("Sign out completed. Session cleared.")}catch(e){console.error("Error signing out:",e)}},p=async(e,s,t)=>{try{console.log("Attempting sign up for:",e);let{data:n,error:o}=await a.N.auth.signUp({email:e,password:s,options:{data:{name:t},emailRedirectTo:"".concat(window.location.origin,"/signin")}});if(o)throw o;let i={success:!o,user:n.user?"".concat(n.user.email):"Missing",session:n.session?"Present":"Missing (email confirmation may be required)"};console.log("Sign up response:",i);let l=!n.session;if(n.user){var r;return{error:null,requiresEmailConfirmation:l,email:null!=(r=n.user.email)?r:e}}throw Error("Signup failed. Please try again.")}catch(e){return console.error("Error during sign up:",e),{error:e,requiresEmailConfirmation:!1}}},g=async e=>{try{let{error:s}=await a.N.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});if(s)return{error:s};return{error:null}}catch(e){return console.error("Error sending password reset email:",e),{error:e}}},f=async(e,s)=>{try{let{data:t,error:r}=await a.N.auth.signInWithOAuth({provider:e,options:{redirectTo:null!=s?s:"".concat(window.location.origin,"/"),queryParams:{prompt:"select_account"}}});if(r)throw r;return{error:null}}catch(e){return console.error("OAuth sign-in error:",e),{error:e}}};return(0,r.jsx)(o.Provider,{value:{user:t,dbUser:l,loading:u,signIn:m,signOut:x,signUp:p,signInWithProvider:f,resetPassword:g,checkPermission:e=>{let s=null==l?void 0:l.role;return!!s&&("admin"===e?"admin"===s:"teacher"===e?"admin"===s||"teacher"===s:"student"===e)}},children:s})}function l(){let e=(0,n.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},2548:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>l});var r=t(5155),n=t(2115),a=t(5695),o=t(20);function i(){let e=(0,a.useRouter)(),s=(0,a.useSearchParams)(),{user:t}=(0,o.As)(),[i,l]=(0,n.useState)(!1),[c,u]=(0,n.useState)(null),d=async()=>{try{u(null),l(!0);let e=(null==s?void 0:s.get("courseId"))||void 0,t=await fetch("/api/stripe/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({courseId:e})}),r=await t.json();if(!t.ok||!(null==r?void 0:r.url))throw Error((null==r?void 0:r.error)||"Failed to start checkout");window.location.href=r.url}catch(e){u((null==e?void 0:e.message)||"Something went wrong")}finally{l(!1)}};return(0,r.jsx)("div",{className:"min-h-screen w-full bg-gray-50 px-4 py-16",children:(0,r.jsxs)("div",{className:"mx-auto max-w-6xl",children:[(0,r.jsxs)("div",{className:"mb-16 text-center",children:[(0,r.jsx)("h1",{className:"mb-4 text-4xl font-bold text-gray-900 md:text-5xl",children:"Choisissez votre abonnement"}),(0,r.jsx)("p",{className:"mx-auto max-w-2xl text-xl text-gray-600",children:"Acc\xe9dez \xe0 tous nos cours premium et donnez \xe0 votre enfant les meilleures chances de r\xe9ussite"})]}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("div",{className:"w-full max-w-xl",children:(0,r.jsxs)("div",{className:"hover:shadow-3xl relative mt-6 transform overflow-hidden rounded-3xl border border-gray-200 bg-white shadow-2xl transition-shadow duration-300",children:[(0,r.jsx)("div",{className:"absolute left-1/2 top-0 z-10 -translate-x-1/2 -translate-y-1/2 transform",children:(0,r.jsx)("div",{className:"rounded-full bg-gradient-to-r from-green-500 to-emerald-600 px-6 py-2 text-sm font-bold text-white shadow-lg",children:"⭐ Le plus populaire"})}),(0,r.jsxs)("div",{className:"border-b border-gray-100 px-10 pb-8 pt-12 text-center",children:[(0,r.jsx)("h3",{className:"mb-3 text-3xl font-bold text-[#1D4ED8]",children:"Premium"}),(0,r.jsx)("p",{className:"mb-8 text-lg text-gray-600",children:"Acc\xe8s complet \xe0 tous les cours"}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"mb-3 flex items-center justify-center gap-3",children:[(0,r.jsx)("span",{className:"text-lg text-gray-500 line-through",children:"$70"}),(0,r.jsx)("span",{className:"rounded-full bg-red-100 px-3 py-1 text-sm font-semibold text-red-600",children:"-29%"})]}),(0,r.jsxs)("div",{className:"flex items-baseline justify-center gap-2",children:[(0,r.jsx)("span",{className:"text-6xl font-black text-[#1D4ED8]",children:"$50"}),(0,r.jsx)("span",{className:"text-xl font-medium text-gray-600",children:"/mois"})]})]})]}),(0,r.jsx)("div",{className:"px-10 py-8",children:(0,r.jsxs)("ul",{className:"space-y-5",children:[(0,r.jsxs)("li",{className:"flex items-center gap-4",children:[(0,r.jsx)("span",{className:"text-2xl text-green-500",children:"✅"}),(0,r.jsx)("span",{className:"text-lg font-semibold text-gray-700",children:"Acc\xe8s illimit\xe9 \xe0 tous les cours"})]}),(0,r.jsxs)("li",{className:"flex items-center gap-4",children:[(0,r.jsx)("span",{className:"text-2xl text-blue-500",children:"\uD83D\uDCD8"}),(0,r.jsx)("span",{className:"text-lg font-semibold text-gray-700",children:"Nouveau contenu ajout\xe9 chaque mois"})]}),(0,r.jsxs)("li",{className:"flex items-center gap-4",children:[(0,r.jsx)("span",{className:"text-2xl text-blue-500",children:"\uD83D\uDD12"}),(0,r.jsx)("span",{className:"text-lg font-semibold text-gray-700",children:"Acc\xe8s s\xe9curis\xe9 et paiement Stripe"})]}),(0,r.jsxs)("li",{className:"flex items-center gap-4",children:[(0,r.jsx)("span",{className:"text-2xl text-green-500",children:"❌"}),(0,r.jsx)("span",{className:"text-lg font-semibold text-gray-700",children:"Annulable \xe0 tout moment"})]})]})}),c&&(0,r.jsx)("div",{className:"mx-10 mb-6 rounded-xl border border-red-200 bg-red-50 p-4 text-center text-sm text-red-700",children:(0,r.jsxs)("span",{className:"font-medium",children:["⚠️ ",c]})}),(0,r.jsxs)("div",{className:"px-10 pb-10",children:[t?(0,r.jsx)("button",{onClick:d,disabled:i,className:"w-full transform rounded-2xl bg-[#1D4ED8] px-8 py-5 text-lg font-bold text-white shadow-lg transition-all duration-300 hover:scale-[1.02] hover:bg-blue-700 hover:shadow-xl disabled:transform-none disabled:cursor-not-allowed disabled:opacity-50",children:i?(0,r.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,r.jsx)("div",{className:"h-6 w-6 animate-spin rounded-full border-b-2 border-white"}),(0,r.jsx)("span",{children:"Redirection vers Stripe..."})]}):(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)("span",{children:"\uD83D\uDE80"}),(0,r.jsx)("span",{children:"S'abonner maintenant"})]})}):(0,r.jsx)("button",{onClick:()=>{e.push("/signin")},className:"w-full transform rounded-2xl bg-[#1D4ED8] px-8 py-5 text-lg font-bold text-white shadow-lg transition-all duration-300 hover:scale-[1.02] hover:bg-blue-700 hover:shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)("span",{children:"\uD83D\uDD10"}),(0,r.jsx)("span",{children:"Se connecter pour s'abonner"})]})}),(0,r.jsx)("p",{className:"mt-6 text-center text-sm text-gray-500",children:"Annulation possible \xe0 tout moment. Paiement s\xe9curis\xe9."})]})]})})}),(0,r.jsx)("div",{className:"mt-16 text-center",children:(0,r.jsxs)("div",{className:"mx-auto grid max-w-4xl gap-8 md:grid-cols-3",children:[(0,r.jsxs)("div",{className:"rounded-xl border border-gray-100 bg-white p-6 shadow-sm",children:[(0,r.jsx)("div",{className:"mb-3 text-3xl",children:"\uD83D\uDCB3"}),(0,r.jsx)("h4",{className:"mb-2 font-semibold text-gray-900",children:"Paiement s\xe9curis\xe9"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Vos donn\xe9es sont prot\xe9g\xe9es par Stripe"})]}),(0,r.jsxs)("div",{className:"rounded-xl border border-gray-100 bg-white p-6 shadow-sm",children:[(0,r.jsx)("div",{className:"mb-3 text-3xl",children:"\uD83D\uDCDE"}),(0,r.jsx)("h4",{className:"mb-2 font-semibold text-gray-900",children:"Support 24/7"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Notre \xe9quipe est l\xe0 pour vous aider"})]}),(0,r.jsxs)("div",{className:"rounded-xl border border-gray-100 bg-white p-6 shadow-sm",children:[(0,r.jsx)("div",{className:"mb-3 text-3xl",children:"\uD83C\uDF93"}),(0,r.jsx)("h4",{className:"mb-2 font-semibold text-gray-900",children:"Contenu premium"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Cours cr\xe9\xe9s par des experts"})]})]})})]})})}function l(){return(0,r.jsx)(n.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen w-full bg-gray-50 px-4 py-16",children:"Chargement…"}),children:(0,r.jsx)(i,{})})}},5078:(e,s,t)=>{Promise.resolve().then(t.bind(t,2548))},5695:(e,s,t)=>{"use strict";var r=t(8999);t.o(r,"useParams")&&t.d(s,{useParams:function(){return r.useParams}}),t.o(r,"usePathname")&&t.d(s,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})},6414:(e,s,t)=>{"use strict";t.d(s,{N:()=>l});var r=t(5647);let n="https://qrowzznnnarfogfbnnow.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI";if(!n)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_URL");if(!a)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_ANON_KEY");let o=(()=>{if(!n)return"default";let e=n.match(/https:\/\/([a-z0-9-]+)\.supabase\.co/);return e?e[1]:"default"})();console.log("Supabase project ref for cookies:",o);let i={auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storageKey:"sb-".concat(o,"-auth-token"),cookieOptions:{name:"sb-".concat(o,"-auth-token"),path:"/",sameSite:"Lax",secure:!0,maxAge:604800}}};console.log("Supabase client initialized with cookie config:",{cookieName:i.auth.cookieOptions.name,cookiePath:i.auth.cookieOptions.path,detectSessionInUrl:i.auth.detectSessionInUrl,persistSession:i.auth.persistSession});let l=(0,r.UU)(n,a,i);l.auth.getUser().then(()=>{}),l.auth.onAuthStateChange((e,s)=>{console.log("Supabase auth event:",e)}),window.addEventListener("focus",()=>{l.auth.refreshSession().catch(e=>{console.error("Error refreshing Supabase session on focus:",e)})})}},e=>{var s=s=>e(e.s=s);e.O(0,[5647,8441,1684,7358],()=>s(5078)),_N_E=e.O()}]);