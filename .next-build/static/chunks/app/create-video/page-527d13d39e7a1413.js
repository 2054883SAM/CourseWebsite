(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1737],{1782:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var a=r(5155),s=r(2115),o=r(4647),n=r(3107),i=r(9535),l=r(5695);function d(e){let{section:t,sectionIndex:r,onSectionChange:o,onRemoveSection:n,canRemove:i}=e,[l,d]=(0,s.useState)({title:"",startTime:0,startTimeFormatted:"00:00",duration:void 0,durationFormatted:"",description:void 0,thumbnail:void 0,flashcard:!1}),c=(0,s.useRef)(null),u=e=>{o(r,{...t,...e})},m=e=>{u({chapters:t.chapters.filter(t=>t.id!==e)})},g=e=>{let t=Math.floor(e/3600),r=Math.floor(e%3600/60),a=Math.floor(e%60);return t>0?"".concat(t,":").concat(r.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0")):"".concat(r,":").concat(a.toString().padStart(2,"0"))};return(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8 dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("h3",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center",children:[(0,a.jsx)("span",{className:"mr-3",children:"\uD83C\uDFAC"}),"Section ",r+1]}),i&&(0,a.jsx)("button",{type:"button",onClick:()=>n(r),className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:"\uD83D\uDDD1️ Supprimer"})]}),"pending"!==t.status&&"completed"!==t.status&&(0,a.jsxs)("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-500",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"mr-2",children:["uploading"===t.status&&"\uD83D\uDCE4","processing"===t.status&&"⚙️","transcribing"===t.status&&"\uD83C\uDFA4","translating"===t.status&&"\uD83C\uDF0D","error"===t.status&&"❌"]}),(0,a.jsxs)("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:["Section ",r+1,": ",t.currentStep]})]}),(0,a.jsxs)("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:[t.uploadProgress,"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-3 dark:bg-blue-800",children:(0,a.jsx)("div",{className:"h-3 rounded-full transition-all duration-300 ".concat("error"===t.status?"bg-red-500":"bg-gradient-to-r from-blue-500 to-blue-600"),style:{width:"".concat(t.uploadProgress,"%")}})}),t.error&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:["Erreur: ",t.error]})]}),"completed"===t.status&&(0,a.jsx)("div",{className:"mb-6 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"mr-2",children:"✅"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:["Section ",r+1," termin\xe9e avec succ\xe8s"]})]})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Titre de la section *"}),(0,a.jsx)("input",{type:"text",value:t.title,onChange:e=>{u({title:e.target.value})},required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200",placeholder:"Ex: Introduction - Partie ".concat(r+1)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Vid\xe9o de la section *"}),(0,a.jsx)("input",{type:"file",ref:c,onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&(u({videoFile:a}),console.log("Section ".concat(r," - Vid\xe9o s\xe9lectionn\xe9e:"),a.name,"Taille:",a.size))},accept:"video/*",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200"}),t.videoFile&&(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Vid\xe9o s\xe9lectionn\xe9e: ",t.videoFile.name," (",(t.videoFile.size/1024/1024).toFixed(2)," MB)"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-xl dark:border-gray-700",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:t.aiGeneratedChapters,onChange:e=>{u({aiGeneratedChapters:e.target.checked})},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500 dark:border-gray-600"}),(0,a.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"G\xe9n\xe9rer les chapitres automatiquement avec l'IA"})]}),t.aiGeneratedChapters&&(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Les chapitres seront g\xe9n\xe9r\xe9s \xe0 partir de la transcription."})]}),t.chapters.length>0&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:["Chapitres (",t.chapters.length,")"]}),(0,a.jsx)("div",{className:"border rounded-xl overflow-hidden dark:border-gray-700",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Titre"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"D\xe9but"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Dur\xe9e"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Description"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200 dark:bg-gray-900 dark:divide-gray-700",children:t.chapters.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:e.title}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:g(e.startTime)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.duration?g(e.duration):"-"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.description||"-"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsx)("button",{onClick:()=>m(e.id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:"Supprimer"})})]},e.id))})]})})]})]})]})}var c=r(6766);function u(){let{user:e,dbUser:t,loading:r}=(0,n.As)(),u=(0,l.useRouter)(),m=(0,i.createBrowserClient)("https://qrowzznnnarfogfbnnow.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI"),[g,p]=(0,s.useState)({title:"",description:"",isFeatured:!1,aiGenerated:!1,thumbnailUrl:"",thumbnailDescription:"",primary_language:"fr",ceQueVousAllezApprendre:"",dureeEstimee:""}),[x,h]=(0,s.useState)(!1),[b,f]=(0,s.useState)(0),[y,v]=(0,s.useState)(null),[j,N]=(0,s.useState)(""),[w,k]=(0,s.useState)([{id:crypto.randomUUID(),title:"",videoFile:null,aiGeneratedChapters:!1,chapters:[],uploadProgress:0,status:"pending",currentStep:"En attente"}]),[S,C]=(0,s.useState)(0);(0,s.useRef)(null);let I=(0,s.useRef)(null),E=e=>{console.log("Success:",e),alert(e)},D=e=>{console.error("Error:",e),alert("Erreur: "+e)};if(r)return(0,a.jsx)(o.Mx,{children:(0,a.jsx)(o.wn,{className:"py-8",children:(0,a.jsx)(o.mc,{children:(0,a.jsx)("div",{className:"flex min-h-[400px] items-center justify-center",children:(0,a.jsx)("div",{className:"h-12 w-12 animate-spin rounded-full border-b-2 border-t-2 border-blue-600"})})})})});if(!e||!t)return(0,a.jsx)(o.Mx,{children:(0,a.jsx)(o.wn,{className:"py-8",children:(0,a.jsx)(o.mc,{children:(0,a.jsxs)("div",{className:"p-8 text-center",children:[(0,a.jsx)("div",{className:"mb-2 text-xl font-semibold text-gray-700 dark:text-gray-300",children:"Non authentifi\xe9"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Veuillez vous connecter pour cr\xe9er un cours."})]})})})});if(!["admin","teacher"].includes(t.role))return(0,a.jsx)(o.Mx,{children:(0,a.jsx)(o.wn,{className:"py-8",children:(0,a.jsx)(o.mc,{children:(0,a.jsxs)("div",{className:"p-8 text-center",children:[(0,a.jsx)("div",{className:"mb-2 text-xl font-semibold text-gray-700 dark:text-gray-300",children:"Acc\xe8s non autoris\xe9"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Seuls les administrateurs et les enseignants peuvent cr\xe9er des cours."}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-500",children:["Votre r\xf4le actuel: ",t.role]})]})})})});let O=e=>{let{name:t,value:r,type:a}=e.target,s=e.target.checked;p(e=>({...e,[t]:"checkbox"===a?s:r}))},U=e=>{w.length>1&&k(t=>t.filter((t,r)=>r!==e))},T=(e,t)=>{k(r=>r.map((r,a)=>a===e?t:r))},A=async(e,t,r)=>{try{console.log("VDOCIPHER: Requesting upload credentials..."),r(10);let a=await fetch("/api/upload-video/vdocipher-credentials",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:(null==t?void 0:t.trim())||"Untitled video",folderId:"root"})});if(!a.ok){let e=await a.text();throw Error("Credentials request failed: ".concat(a.status," - ").concat(e))}let{clientPayload:s,videoId:o}=await a.json();console.log("VDOCIPHER: Upload credentials received",{videoId:o}),r(25),console.log("VDOCIPHER: Uploading file to VdoCipher...");let n=new FormData;n.append("file",e),n.append("uploadCredentials",JSON.stringify(s));let i=await fetch("/api/upload-video/vdocipher-upload",{method:"POST",body:n});if(!i.ok){let e=await i.text();throw Error("Upload failed: ".concat(i.status," - ").concat(e))}try{await i.json()}catch(e){}console.log("VDOCIPHER: Upload completed"),r(50),console.log("VDOCIPHER: Monitoring processing status (up to ~10 minutes)...");let l=!1,d=0,c=Date.now();for(;!l&&d<60;){d++;let e=((Date.now()-c)/6e4).toFixed(1),t=50+d/60*40;r(t),d>1&&await new Promise(e=>setTimeout(e,1e4));let a=await fetch("/api/upload-video/vdocipher-status?videoId=".concat(o),{method:"GET"});if(!a.ok){let e=await a.text();console.warn("VDOCIPHER: Status check failed",{status:a.status,error:e});continue}let s=await a.json();if(console.log("VDOCIPHER: Status check",{attempt:d,...s,elapsedMinutes:e}),s.isReady)l=!0,console.log("VDOCIPHER: Video is ready after ".concat(e," minutes"));else if("Error"===s.status||"Failed"===s.status)throw Error("Video processing failed with status: ".concat(s.status))}if(!l){let e=((Date.now()-c)/6e4).toFixed(1);console.warn("VDOCIPHER: Video still processing after ".concat(e," minutes. Proceeding with course creation; processing continues in background."))}return r(100),o}catch(e){throw console.error("VDOCIPHER: Upload error",e),e}},P=async r=>{if(console.log("Starting thumbnail upload for file:",r.name,"Size:",r.size),!r.type.startsWith("image/"))throw Error("Le fichier doit \xeatre une image");if(r.size>5242880)throw Error("L'image doit faire moins de 5MB");let a=r.name.split(".").pop(),s="".concat(Math.random(),".").concat(a),o="course-thumbnails/".concat(s);console.log("Uploading to path:",o),console.log("User role:",null==t?void 0:t.role),console.log("User ID:",null==e?void 0:e.id);let{data:n,error:i}=await m.storage.from("course-thumbnails").upload(o,r);if(i)throw console.error("Upload error details:",i),Error("Erreur lors de l'upload de la thumbnail: ".concat(i.message));console.log("Upload successful:",n);let{data:{publicUrl:l}}=m.storage.from("course-thumbnails").getPublicUrl(o);return console.log("Generated public URL:",l),l},F=(e,t)=>{k(r=>r.map((r,a)=>a===e?{...r,...t}:r))},R=async e=>new Promise(t=>{try{let r=URL.createObjectURL(e),a=document.createElement("video");a.preload="metadata",a.onloadedmetadata=()=>{let e=a.duration;if(URL.revokeObjectURL(r),!isNaN(e)&&isFinite(e)&&e>0){let r=Math.max(1,Math.round(e/60));console.log("LOCAL DURATION: Extracted from file",{seconds:e,minutes:r}),t(r)}else t(1)},a.onerror=()=>{URL.revokeObjectURL(r),t(1)},a.src=r}catch(e){console.warn("LOCAL DURATION: Error extracting duration from file",e),t(1)}}),V=async(e,t,r)=>{if(!e.videoFile)throw Error("Aucun fichier vid\xe9o s\xe9lectionn\xe9");try{let r=await R(e.videoFile);console.log("DURATION: Local file analysis result",{minutes:r}),F(t,{status:"uploading",currentStep:"Upload de la vid\xe9o...",uploadProgress:0});let a=await A(e.videoFile,e.title,e=>{F(t,{uploadProgress:Math.round(.4*e),currentStep:"Upload de la vid\xe9o... ".concat(Math.round(e),"%")})});F(t,{playbackId:a,status:"processing",currentStep:"Vid\xe9o upload\xe9e, obtention de la dur\xe9e...",uploadProgress:40});let s=r;if(1===r)try{let e=await fetch("/api/upload-video/vdocipher-status?videoId=".concat(a),{method:"GET"});if(e.ok){let t=await e.json();"number"==typeof t.duration&&t.duration>0&&(s=Math.max(1,Math.round(t.duration/60)),console.log("DURATION: Got duration from VdoCipher",{seconds:t.duration,minutes:s}))}}catch(e){console.warn("DURATION: Could not get duration from VdoCipher, using local duration",e)}console.log("DURATION: Final duration for section",{minutes:s,source:r>1?"local":"vdocipher"}),F(t,{currentStep:"Dur\xe9e obtenue, g\xe9n\xe9ration des sous-titres...",uploadProgress:45}),F(t,{status:"transcribing",currentStep:"G\xe9n\xe9ration des sous-titres...",uploadProgress:50});let o="temp_"+crypto.randomUUID(),n=e.id,i=new FormData;i.append("file",e.videoFile),i.append("format","vtt"),i.append("language",g.primary_language),i.append("courseId",o),i.append("sectionId",n),i.append("videoId",a);let l=await fetch("/api/upload-video/deepgram-captions",{method:"POST",body:i});if(!l.ok){let e=await l.text();throw Error("Erreur lors de la g\xe9n\xe9ration des sous-titres: ".concat(e))}let d=await l.json();console.log("CAPTIONS: Generated for section",n),F(t,{currentStep:"Sous-titres g\xe9n\xe9r\xe9s...",uploadProgress:65});let c=e.chapters;if(e.aiGeneratedChapters&&(null==d?void 0:d.captions)){F(t,{currentStep:"G\xe9n\xe9ration des chapitres IA...",uploadProgress:70});try{let r=await fetch("/api/upload-video/generate-chapters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({captions:String(d.captions),language:g.primary_language})});if(r.ok){let{chapters:a}=await r.json();Array.isArray(a)&&(c=a.map(e=>({id:crypto.randomUUID(),title:String(e.title||"").trim(),startTime:Math.max(0,Math.floor(Number(e.startTime)||0)),duration:null!=e.duration?Math.max(1,Math.floor(Number(e.duration))):void 0,description:null!=e.description?String(e.description):void 0,flashcard:"boolean"==typeof e.flashcard&&e.flashcard})),F(t,{chapters:c}),console.log("CHAPTERS: AI chapters generated for section",e.title))}}catch(e){console.warn("CHAPTERS: Error during AI generation",e)}}F(t,{currentStep:"Chapitres trait\xe9s...",uploadProgress:80}),F(t,{status:"translating",currentStep:"Traduction des sous-titres...",uploadProgress:85});try{(await fetch("/api/upload-video/translate-and-upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({courseId:o,sectionId:n,videoId:a,sourceLanguage:g.primary_language})})).ok&&console.log("CAPTIONS: Translation completed for section",e.title)}catch(e){console.warn("CAPTIONS: Error in translate/upload step",e)}return F(t,{status:"completed",currentStep:"Section termin\xe9e",uploadProgress:100}),{playbackId:a,chapters:c,duration:s}}catch(e){throw F(t,{status:"error",currentStep:"Erreur",uploadProgress:0,error:e instanceof Error?e.message:"Erreur inconnue"}),e}},M=async t=>{if(t.preventDefault(),!e)return;let r=w.filter(e=>e.title.trim()&&e.videoFile);if(0===r.length)return void D("Au moins une section avec un titre et une vid\xe9o est requise");h(!0),window.scrollTo({top:0,behavior:"smooth"}),f(0);try{let t=g.thumbnailUrl;y&&(f(5),t=await P(y),f(10)),console.log("Starting processing of ".concat(r.length," sections..."));let a=[],s=80/r.length;for(let e=0;e<r.length;e++){let t=r[e],o=w.findIndex(e=>e.id===t.id);console.log("Processing section ".concat(e+1,"/").concat(r.length,": ").concat(t.title));try{let n=await V(t,o,r.length);a.push({originalSection:t,...n});let i=10+(e+1)*s;f(Math.round(i))}catch(e){throw console.error("Error processing section ".concat(t.title,":"),e),D('Erreur lors du traitement de la section "'.concat(t.title,'": ').concat(e instanceof Error?e.message:"Erreur inconnue")),e}}console.log("All sections processed successfully. Creating course..."),f(90);let o={title:g.title,description:g.description,thumbnail_url:t||null,creator_id:e.id,is_featured:g.isFeatured,ce_que_vous_allez_apprendre:g.ceQueVousAllezApprendre||null},{data:n,error:i}=await m.from("courses").insert(o).select().single();if(i)throw console.error("Course insert error details:",i),Error("Erreur lors de la cr\xe9ation du cours");console.log("Course created:",n.id),f(95);let l=a.map((e,t)=>{let r=e.duration&&e.duration>0?e.duration:1;return console.log("SECTION INSERT: Section ".concat(t+1," - Duration: ").concat(r," minutes (original: ").concat(e.duration,")")),{course_id:n.id,title:e.originalSection.title,section_number:t+1,playback_id:e.playbackId,chapters:e.chapters.length>0?JSON.stringify(e.chapters):"[]",duration:r}}),{data:d,error:c}=await m.from("sections").insert(l).select();if(c)throw console.error("Sections insert error:",c),Error("Erreur lors de la cr\xe9ation des sections");console.log("Created ".concat(d.length," sections in database"));try{console.log("Attempting to move captions from temp sectionIds to DB sectionIds...");for(let e=0;e<a.length;e++){let t=a[e].originalSection.id,r=d[e];if(!(null==r?void 0:r.id))continue;let s="".concat(t,"/captions.vtt"),o="".concat(r.id,"/captions.vtt");if(s===o)continue;let{data:n,error:i}=await m.storage.from("translations").move(s,o);i?console.warn("CAPTIONS MOVE: Failed to move captions",{fromPath:s,toPath:o,error:i.message}):console.log("CAPTIONS MOVE: Moved captions",{fromPath:s,toPath:o,result:n})}}catch(e){console.warn("CAPTIONS MOVE: Error while moving captions to DB section ids",e)}try{console.log("QUESTIONS: Generating mixed questions for each section...");for(let e=0;e<d.length;e++){let t=d[e];if(null==t?void 0:t.id)try{let e=await fetch("/api/video/generate-questions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sectionId:t.id,maxQuestions:8})});if(!e.ok){console.warn("QUESTIONS: Generation failed for section",t.id,await e.text());continue}let r=await e.json(),a=Array.isArray(null==r?void 0:r.questions)?r.questions:[],s={questions:a.length>0?JSON.stringify(a.slice(0,8)):"[]"},{error:o}=await m.from("sections").update(s).eq("id",t.id);o?console.warn("QUESTIONS: Failed to save questions",{sectionId:t.id,error:o.message}):console.log("QUESTIONS: Saved questions for section",t.id)}catch(e){console.warn("QUESTIONS: Error generating/saving questions for section",null==t?void 0:t.id,e)}}}catch(e){console.warn("QUESTIONS: Batch generation encountered an error",e)}f(100),E("Cours cr\xe9\xe9 avec succ\xe8s ! ".concat(r.length," section(s) ont \xe9t\xe9 upload\xe9es sur VdoCipher et seront bient\xf4t disponibles.")),u.push("/courses"),p({title:"",description:"",isFeatured:!1,aiGenerated:!1,thumbnailUrl:"",thumbnailDescription:"",primary_language:"fr",ceQueVousAllezApprendre:"",dureeEstimee:""}),v(null),N(""),k([{id:crypto.randomUUID(),title:"",videoFile:null,aiGeneratedChapters:!1,chapters:[],uploadProgress:0,status:"pending",currentStep:"En attente"}]),C(0)}catch(e){console.error("Erreur lors de la cr\xe9ation du cours:",e),D("Erreur lors de la cr\xe9ation du cours: "+(e instanceof Error?e.message:"Erreur inconnue"))}finally{h(!1),f(0)}};return(0,a.jsx)(o.Mx,{children:(0,a.jsx)(o.wn,{className:"bg-gradient-to-br from-blue-50 via-white to-purple-50 py-8 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,a.jsx)(o.mc,{children:(0,a.jsxs)("div",{className:"mx-auto max-w-4xl",children:[(0,a.jsxs)("div",{className:"mb-12 text-center",children:[(0,a.jsx)("h1",{className:"mb-4 text-4xl font-bold text-gray-900 dark:text-white",children:"Cr\xe9er un nouveau cours"}),(0,a.jsx)("p",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Partagez vos connaissances avec le monde en cr\xe9ant un cours vid\xe9o interactif"})]}),x&&(0,a.jsxs)("div",{className:"mb-8 rounded-2xl bg-white p-6 shadow-lg dark:bg-gray-800",children:[(0,a.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Cr\xe9ation du cours en cours..."}),(0,a.jsxs)("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:[b,"%"]})]}),(0,a.jsx)("div",{className:"h-3 w-full rounded-full bg-gray-200 dark:bg-gray-700",children:(0,a.jsx)("div",{className:"h-3 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300",style:{width:"".concat(b,"%")}})}),(0,a.jsx)("div",{className:"mt-4 grid grid-cols-1 gap-2 sm:grid-cols-2 lg:grid-cols-3",children:w.filter(e=>e.title.trim()&&e.videoFile).map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center rounded border p-2 text-xs ".concat("completed"===e.status?"border-green-200 bg-green-50 text-green-700 dark:border-green-800 dark:bg-green-900/20 dark:text-green-300":"error"===e.status?"border-red-200 bg-red-50 text-red-700 dark:border-red-800 dark:bg-red-900/20 dark:text-red-300":"pending"===e.status?"border-gray-200 bg-gray-50 text-gray-600 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400":"border-blue-200 bg-blue-50 text-blue-700 dark:border-blue-800 dark:bg-blue-900/20 dark:text-blue-300"),children:[(0,a.jsxs)("div",{className:"mr-2",children:["pending"===e.status&&"⏳","uploading"===e.status&&"\uD83D\uDCE4","processing"===e.status&&"⚙️","transcribing"===e.status&&"\uD83C\uDFA4","translating"===e.status&&"\uD83C\uDF0D","completed"===e.status&&"✅","error"===e.status&&"❌"]}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsxs)("div",{className:"truncate font-medium",children:["Section ",t+1]}),(0,a.jsx)("div",{className:"truncate text-xs opacity-75",children:e.currentStep})]}),"pending"!==e.status&&"completed"!==e.status&&(0,a.jsxs)("div",{className:"ml-2 text-xs font-medium",children:[e.uploadProgress,"%"]})]},e.id))}),S>0&&S<100&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("div",{className:"mb-1 flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Traduction des sous-titres..."}),(0,a.jsxs)("span",{className:"text-xs text-purple-600 dark:text-purple-400",children:[S,"%"]})]}),(0,a.jsx)("div",{className:"h-1 w-full rounded-full bg-gray-200 dark:bg-gray-700",children:(0,a.jsx)("div",{className:"h-1 rounded-full bg-purple-500 transition-all duration-300",style:{width:"".concat(S,"%")}})})]})]}),(0,a.jsxs)("form",{onSubmit:M,className:"space-y-8",children:[(0,a.jsxs)("div",{className:"rounded-2xl bg-white p-8 shadow-lg dark:bg-gray-800",children:[(0,a.jsxs)("h2",{className:"mb-6 flex items-center text-2xl font-bold text-gray-900 dark:text-white",children:[(0,a.jsx)("span",{className:"mr-3",children:"\uD83D\uDCDD"}),"Informations de base"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Titre du cours *"}),(0,a.jsx)("input",{type:"text",name:"title",value:g.title,onChange:O,required:!0,className:"w-full rounded-xl border border-gray-300 px-4 py-3 transition-all duration-200 focus:border-transparent focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Ex: Introduction \xe0 React"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description *"}),(0,a.jsx)("textarea",{name:"description",value:g.description,onChange:O,required:!0,rows:4,className:"w-full rounded-xl border border-gray-300 px-4 py-3 transition-all duration-200 focus:border-transparent focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"D\xe9crivez votre cours..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Langue principale du cours *"}),(0,a.jsxs)("select",{name:"primary_language",value:g.primary_language,onChange:O,className:"w-full rounded-xl border border-gray-300 px-4 py-3 transition-all duration-200 focus:border-transparent focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:[(0,a.jsx)("option",{value:"fr",children:"Fran\xe7ais"}),(0,a.jsx)("option",{value:"en",children:"Anglais"}),(0,a.jsx)("option",{value:"es",children:"Espagnol"})]})]}),(0,a.jsx)("div",{className:"md:col-span-2",children:(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",name:"isFeatured",checked:g.isFeatured,onChange:O,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500 dark:border-gray-600"}),(0,a.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Mettre en vedette ce cours"})]})})]})]}),(0,a.jsxs)("div",{className:"rounded-2xl bg-white p-8 shadow-lg dark:bg-gray-800",children:[(0,a.jsxs)("h2",{className:"mb-6 flex items-center text-2xl font-bold text-gray-900 dark:text-white",children:[(0,a.jsx)("span",{className:"mr-3",children:"\uD83D\uDCCB"}),"Informations d\xe9taill\xe9es"]}),(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Ce que vous allez apprendre"}),(0,a.jsx)("textarea",{name:"ceQueVousAllezApprendre",value:g.ceQueVousAllezApprendre,onChange:O,rows:3,className:"w-full rounded-xl border border-gray-300 px-4 py-3 transition-all duration-200 focus:border-transparent focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Listez les comp\xe9tences que les \xe9tudiants acquerront..."})]})})]}),(0,a.jsxs)("div",{className:"rounded-2xl bg-white p-8 shadow-lg dark:bg-gray-800",children:[(0,a.jsxs)("h2",{className:"mb-6 flex items-center text-2xl font-bold text-gray-900 dark:text-white",children:[(0,a.jsx)("span",{className:"mr-3",children:"\uD83D\uDDBC️"}),"Image de couverture"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"URL de l'image"}),(0,a.jsx)("input",{type:"url",name:"thumbnailUrl",value:g.thumbnailUrl,onChange:O,className:"w-full rounded-xl border border-gray-300 px-4 py-3 transition-all duration-200 focus:border-transparent focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"https://example.com/image.jpg"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Ou t\xe9l\xe9charger une image"}),(0,a.jsx)("input",{type:"file",ref:I,onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];if(r){v(r);let e=new FileReader;e.onload=e=>{var t;N(null==(t=e.target)?void 0:t.result)},e.readAsDataURL(r)}},accept:"image/*",className:"w-full rounded-xl border border-gray-300 px-4 py-3 transition-all duration-200 focus:border-transparent focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"})]}),j&&(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Aper\xe7u"}),(0,a.jsx)("div",{className:"relative w-full max-w-md",children:(0,a.jsx)(c.default,{src:j,alt:"Aper\xe7u de la thumbnail",width:400,height:200,className:"h-48 w-full rounded-xl border border-gray-300 object-cover dark:border-gray-600"})})]})]})]}),(0,a.jsxs)("div",{className:"rounded-2xl bg-white p-8 shadow-lg dark:bg-gray-800",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"flex items-center text-2xl font-bold text-gray-900 dark:text-white",children:[(0,a.jsx)("span",{className:"mr-3",children:"\uD83C\uDFAC"}),"Sections du cours"]}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e={id:crypto.randomUUID(),title:"",videoFile:null,aiGeneratedChapters:!1,chapters:[],uploadProgress:0,status:"pending",currentStep:"En attente"};k(t=>[...t,e])},className:"rounded-lg bg-green-600 px-4 py-2 font-medium text-white transition-colors duration-200 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",children:"➕ Ajouter une section"})]}),(0,a.jsx)("div",{className:"space-y-6",children:w.map((e,t)=>(0,a.jsx)(d,{section:e,sectionIndex:t,onSectionChange:T,onRemoveSection:U,canRemove:w.length>1},e.id))})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("button",{type:"submit",disabled:x,className:"inline-flex transform items-center rounded-full bg-gradient-to-r from-blue-600 to-purple-600 px-8 py-4 font-semibold text-white shadow-lg transition-all duration-300 hover:scale-105 hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"-ml-1 mr-3 h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Cr\xe9ation en cours..."]}):"Cr\xe9er le cours"})})]})]})})})})}},2992:(e,t,r)=>{Promise.resolve().then(r.bind(r,1782))}},e=>{var t=t=>e(e.s=t);e.O(0,[5647,6874,6766,9535,8415,4647,8441,1684,7358],()=>t(2992)),_N_E=e.O()}]);