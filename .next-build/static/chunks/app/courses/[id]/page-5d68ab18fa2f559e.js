(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7415],{20:(e,s,r)=>{"use strict";r.d(s,{As:()=>o,OJ:()=>i,cy:()=>n});var t=r(5155),a=r(2115),l=r(6414);let n=(0,a.createContext)(null);function i(e){let{children:s}=e,[r,i]=(0,a.useState)(null),[o,d]=(0,a.useState)(null),[c,u]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=(()=>{let e="https://qrowzznnnarfogfbnnow.supabase.co";if(!e)return"default";let s=e.match(/https:\/\/([a-z0-9-]+)\.supabase\.co/);return s?s[1]:"default"})();console.log("Auth cookies at startup:",document.cookie.split(";").map(e=>e.trim()).filter(e=>e.startsWith("sb-")||e.includes("supabase"))),console.log("Looking for cookie format:","sb-".concat(e,"-auth-token")),l.N.auth.getUser().then(e=>{let{data:{user:s},error:r}=e;r&&console.error("Error getting initial user:",r),console.log("Initial auth user:",s?"Present":"None",s?"(User: ".concat(s.email,")"):""),i(null!=s?s:null),s?m(s.id):u(!1)});let{data:{subscription:s}}=l.N.auth.onAuthStateChange(async(e,s)=>{var r;if(console.log("Auth state change event:",e),console.log("Session after event:",s?"Present":"None"),i(null!=(r=null==s?void 0:s.user)?r:null),null==s?void 0:s.user){if("SIGNED_IN"===e||"TOKEN_REFRESHED"===e)try{await fetch("/api/auth/cookie",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:s.access_token,refresh_token:s.refresh_token}),credentials:"include"})}catch(e){console.warn("Failed to sync auth cookies on state change:",e)}m(s.user.id)}else d(null),u(!1)});return()=>{s.unsubscribe()}},[]);let m=async e=>{try{let{data:s,error:r}=await l.N.from("users").select("*").eq("id",e).single();if(r)throw r;d(s)}catch(e){console.error("Error fetching user data:",e),d(null)}finally{u(!1)}},h=async(e,s)=>{try{console.log("Attempting sign in for:",e),await l.N.auth.signOut();let{data:r,error:t}=await l.N.auth.signInWithPassword({email:e,password:s});return r.session&&await fetch("/api/auth/cookie",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:r.session.access_token,refresh_token:r.session.refresh_token}),credentials:"include"}),{error:t}}catch(e){return console.error("Unexpected error during sign in:",e),{error:e}}},x=async()=>{try{await l.N.auth.signOut(),console.log("Sign out completed. Session cleared.")}catch(e){console.error("Error signing out:",e)}},g=async(e,s,r)=>{try{console.log("Attempting sign up for:",e);let{data:a,error:n}=await l.N.auth.signUp({email:e,password:s,options:{data:{name:r},emailRedirectTo:"".concat(window.location.origin,"/signin")}});if(n)throw n;let i={success:!n,user:a.user?"".concat(a.user.email):"Missing",session:a.session?"Present":"Missing (email confirmation may be required)"};console.log("Sign up response:",i);let o=!a.session;if(a.user){var t;return{error:null,requiresEmailConfirmation:o,email:null!=(t=a.user.email)?t:e}}throw Error("Signup failed. Please try again.")}catch(e){return console.error("Error during sign up:",e),{error:e,requiresEmailConfirmation:!1}}},p=async e=>{try{let{error:s}=await l.N.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});if(s)return{error:s};return{error:null}}catch(e){return console.error("Error sending password reset email:",e),{error:e}}},b=async(e,s)=>{try{let{data:r,error:t}=await l.N.auth.signInWithOAuth({provider:e,options:{redirectTo:null!=s?s:"".concat(window.location.origin,"/"),queryParams:{prompt:"select_account"}}});if(t)throw t;return{error:null}}catch(e){return console.error("OAuth sign-in error:",e),{error:e}}};return(0,t.jsx)(n.Provider,{value:{user:r,dbUser:o,loading:c,signIn:h,signOut:x,signUp:g,signInWithProvider:b,resetPassword:p,checkPermission:e=>{let s=null==o?void 0:o.role;return!!s&&("admin"===e?"admin"===s:"teacher"===e?"admin"===s||"teacher"===s:"student"===e)}},children:s})}function o(){let e=(0,a.useContext)(n);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},1313:(e,s,r)=>{Promise.resolve().then(r.bind(r,7884))},5695:(e,s,r)=>{"use strict";var t=r(8999);r.o(t,"useParams")&&r.d(s,{useParams:function(){return t.useParams}}),r.o(t,"usePathname")&&r.d(s,{usePathname:function(){return t.usePathname}}),r.o(t,"useRouter")&&r.d(s,{useRouter:function(){return t.useRouter}}),r.o(t,"useSearchParams")&&r.d(s,{useSearchParams:function(){return t.useSearchParams}})},6414:(e,s,r)=>{"use strict";r.d(s,{N:()=>o});var t=r(5647);let a="https://qrowzznnnarfogfbnnow.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI";if(!a)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_URL");if(!l)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_ANON_KEY");let n=(()=>{if(!a)return"default";let e=a.match(/https:\/\/([a-z0-9-]+)\.supabase\.co/);return e?e[1]:"default"})();console.log("Supabase project ref for cookies:",n);let i={auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storageKey:"sb-".concat(n,"-auth-token"),cookieOptions:{name:"sb-".concat(n,"-auth-token"),path:"/",sameSite:"Lax",secure:!0,maxAge:604800}}};console.log("Supabase client initialized with cookie config:",{cookieName:i.auth.cookieOptions.name,cookiePath:i.auth.cookieOptions.path,detectSessionInUrl:i.auth.detectSessionInUrl,persistSession:i.auth.persistSession});let o=(0,t.UU)(a,l,i);o.auth.getUser().then(()=>{}),o.auth.onAuthStateChange((e,s)=>{console.log("Supabase auth event:",e)}),window.addEventListener("focus",()=>{o.auth.refreshSession().catch(e=>{console.error("Error refreshing Supabase session on focus:",e)})})},7809:(e,s,r)=>{"use strict";r.d(s,{m:()=>a});var t=r(5155);function a(e){let{text:s,className:r="",position:a="top"}=e;return(0,t.jsxs)("div",{role:"tooltip",className:"\n        absolute z-50 px-3 py-2 text-sm text-white \n        bg-gray-800 dark:bg-gray-700 rounded-md shadow-sm \n        whitespace-nowrap pointer-events-none\n        ".concat({top:"bottom-full left-1/2 -translate-x-1/2 mb-2",right:"left-full top-1/2 -translate-y-1/2 ml-2",bottom:"top-full left-1/2 -translate-x-1/2 mt-2",left:"right-full top-1/2 -translate-y-1/2 mr-2"}[a]," \n        ").concat(r,"\n      "),children:[s,(0,t.jsx)("div",{className:"\n          absolute w-0 h-0 border-4\n          ".concat({top:"top-full left-1/2 -translate-x-1/2 border-t-gray-800 dark:border-t-gray-700 border-l-transparent border-r-transparent border-b-transparent",right:"right-full top-1/2 -translate-y-1/2 border-r-gray-800 dark:border-r-gray-700 border-t-transparent border-b-transparent border-l-transparent",bottom:"bottom-full left-1/2 -translate-x-1/2 border-b-gray-800 dark:border-b-gray-700 border-l-transparent border-r-transparent border-t-transparent",left:"left-full top-1/2 -translate-y-1/2 border-l-gray-800 dark:border-l-gray-700 border-t-transparent border-b-transparent border-r-transparent"}[a],"\n        ")})]})}r(2115)},7884:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>C});var t=r(5155),a=r(2115),l=r(5695),n=r(6874),i=r.n(n);function o(e){let{items:s}=e;return(0,t.jsx)("nav",{className:"mb-6 text-sm",children:(0,t.jsxs)("ol",{className:"flex flex-wrap items-center space-x-2",children:[(0,t.jsx)("li",{children:(0,t.jsx)(i(),{href:"/",className:"text-gray-500 hover:text-blue-600 hover:underline",children:"Accueil"})}),s.map((e,r)=>(0,t.jsxs)("li",{className:"flex items-center",children:[(0,t.jsx)("span",{className:"mx-2 text-gray-400",children:"/"}),r===s.length-1?(0,t.jsx)("span",{className:"text-gray-900 font-medium","aria-current":"page",children:e.label}):(0,t.jsx)(i(),{href:e.href,className:"text-gray-500 hover:text-blue-600 hover:underline",children:e.label})]},e.href))]})})}var d=r(6766);function c(e){let{course:s}=e;return(0,t.jsxs)("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-sky-100 via-blue-50 to-indigo-100 shadow-lg border-2 border-sky-200 mb-8",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-sky-400/10 via-blue-400/10 to-indigo-400/10"}),(0,t.jsx)("div",{className:"absolute top-4 right-4 text-4xl opacity-20",children:"\uD83D\uDCDA✨"}),(0,t.jsx)("div",{className:"absolute bottom-4 left-4 text-3xl opacity-20",children:"\uD83C\uDF93\uD83C\uDF1F"}),(0,t.jsx)("div",{className:"absolute top-1/2 left-1/4 text-2xl opacity-15",children:"\uD83D\uDCD0"}),(0,t.jsx)("div",{className:"absolute top-1/4 right-1/3 text-2xl opacity-15",children:"\uD83D\uDD22"}),(0,t.jsxs)("div",{className:"relative z-10 grid grid-cols-1 lg:grid-cols-5 gap-6 p-8",children:[(0,t.jsx)("div",{className:"lg:col-span-2 relative",children:(0,t.jsx)("div",{className:"relative h-56 lg:h-full w-full rounded-xl overflow-hidden shadow-md",children:s.thumbnail_url?(0,t.jsx)(d.default,{src:s.thumbnail_url,alt:s.title,fill:!0,sizes:"(max-width: 1024px) 100vw, 40vw",className:"object-cover",priority:!0}):(0,t.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-sky-200 to-blue-300 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-6xl mb-2",children:"\uD83D\uDCD6"}),(0,t.jsx)("span",{className:"text-blue-800 font-medium",children:"Cours \xe9ducatif"})]})})})}),(0,t.jsxs)("div",{className:"lg:col-span-3 space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)("span",{className:"text-2xl",children:"\uD83C\uDFAF"}),(0,t.jsx)("span",{className:"bg-sky-200 text-sky-800 px-3 py-1 rounded-full text-sm font-medium",children:"Cours primaire"})]}),(0,t.jsx)("h1",{className:"text-3xl md:text-4xl lg:text-5xl font-bold text-sky-700 mb-4 leading-tight",children:s.title})]}),(0,t.jsx)("p",{className:"text-gray-700 text-lg leading-relaxed",children:s.description}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-6 items-center",children:[s.creator&&(0,t.jsxs)("div",{className:"flex items-center bg-white/60 rounded-full px-4 py-2 shadow-sm",children:[(0,t.jsx)("span",{className:"text-xl mr-2",children:"\uD83D\uDC68‍\uD83C\uDFEB"}),(0,t.jsxs)("div",{className:"flex items-center",children:[s.creator.photo_url?(0,t.jsx)(d.default,{src:s.creator.photo_url,alt:s.creator.name,width:32,height:32,className:"rounded-full mr-3 border-2 border-white"}):(0,t.jsx)("div",{className:"w-8 h-8 bg-sky-200 text-sky-800 rounded-full flex items-center justify-center mr-3 border-2 border-white",children:s.creator.name.charAt(0)}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Enseignant"}),(0,t.jsx)("div",{className:"font-semibold text-gray-800",children:s.creator.name})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center bg-white/60 rounded-full px-4 py-2 shadow-sm",children:[(0,t.jsx)("span",{className:"text-xl mr-2",children:"\uD83D\uDCDD"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Sections"}),(0,t.jsxs)("div",{className:"font-semibold text-gray-800",children:[s.section_count||0," le\xe7ons"]})]})]})]})]})]})]})}function u(e){let{course:s}=e,r=e=>e?e.split("\n").filter(e=>e.trim().length>0):[],a=(e,s)=>{let r=["\uD83D\uDCD8","\uD83D\uDD22","\uD83D\uDCD0","\uD83C\uDFB2","✨","\uD83C\uDFAF","\uD83C\uDF1F","\uD83D\uDCA1"];return e.toLowerCase().includes("math\xe9matique")||e.toLowerCase().includes("calcul")||e.toLowerCase().includes("nombre")?"\uD83D\uDD22":e.toLowerCase().includes("g\xe9om\xe9trie")||e.toLowerCase().includes("forme")?"\uD83D\uDCD0":e.toLowerCase().includes("jeu")||e.toLowerCase().includes("ludique")?"\uD83C\uDFB2":e.toLowerCase().includes("pratique")||e.toLowerCase().includes("exercice")?"✨":e.toLowerCase().includes("objectif")||e.toLowerCase().includes("but")?"\uD83C\uDFAF":r[s%r.length]},l=function(e,s,l){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=s?r(s):l;if(0===i.length)return null;let o=e.includes("apprendre")?"\uD83C\uDF93":e.includes("Pr\xe9requis")?"\uD83D\uDCCB":e.includes("pour")?"\uD83D\uDC65":"\uD83D\uDCDD";return n?(0,t.jsxs)("div",{className:"mt-8",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,t.jsx)("span",{className:"text-3xl",children:o}),(0,t.jsx)("h3",{className:"text-2xl font-bold text-sky-700",children:e})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.map((e,s)=>(0,t.jsx)("div",{className:"bg-gradient-to-r from-sky-50 to-blue-50 border-2 border-sky-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-all duration-200 transform hover:scale-[1.02]",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("span",{className:"text-2xl flex-shrink-0 mt-1",children:a(e,s)}),(0,t.jsx)("p",{className:"text-gray-800 font-medium leading-relaxed",children:e})]})},s))})]}):(0,t.jsxs)("div",{className:"mt-8",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("span",{className:"text-2xl",children:o}),(0,t.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:e})]}),(0,t.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6",children:(0,t.jsx)("ul",{className:"space-y-3",children:i.map((e,s)=>(0,t.jsxs)("li",{className:"flex items-start gap-3",children:[(0,t.jsx)("span",{className:"text-lg flex-shrink-0 mt-0.5",children:a(e,s)}),(0,t.jsx)("span",{className:"text-gray-700 leading-relaxed",children:e})]},s))})})]})};return(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{className:"bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200 rounded-2xl p-6 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCD6"}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-orange-700",children:"\xc0 propos de ce cours"})]}),(0,t.jsx)("p",{className:"text-gray-800 text-lg leading-relaxed whitespace-pre-line",children:s.description})]}),l("Ce que vous allez apprendre",s.ce_que_vous_allez_apprendre,["Ma\xeetriser les concepts essentiels de ".concat(s.title),"R\xe9soudre des exercices pratiques et amusants","D\xe9velopper ta confiance en math\xe9matiques","Appliquer tes nouvelles comp\xe9tences au quotidien"],!0),l("Pr\xe9requis",s.prerequis,["Savoir lire et \xe9crire","Avoir envie d'apprendre et de s'amuser","Un cahier et un crayon pour prendre des notes"]),l("Ce cours est parfait pour...",s.public_cible,["Les \xe9l\xe8ves du primaire curieux d'apprendre","Ceux qui veulent am\xe9liorer leurs r\xe9sultats scolaires","Les enfants qui aiment les d\xe9fis amusants","Tous ceux qui veulent d\xe9couvrir la magie des math\xe9matiques"]),(s.duree_estimee||s.niveau_difficulte)&&(0,t.jsxs)("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-200 rounded-2xl p-6 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCCA"}),(0,t.jsx)("h3",{className:"text-xl font-bold text-purple-700",children:"Informations du cours"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.duree_estimee&&(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-2xl",children:"⏰"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Dur\xe9e estim\xe9e"}),(0,t.jsx)("div",{className:"font-bold text-gray-800",children:s.duree_estimee})]})]}),s.niveau_difficulte&&(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCC8"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Niveau"}),(0,t.jsxs)("div",{className:"font-bold text-gray-800",children:["debutant"===s.niveau_difficulte&&"\uD83C\uDF31 D\xe9butant","intermediaire"===s.niveau_difficulte&&"\uD83C\uDF3F Interm\xe9diaire","avance"===s.niveau_difficulte&&"\uD83C\uDF33 Avanc\xe9"]})]})]})]})]})]})}function m(e){let{creator:s}=e;return s?(0,t.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white flex items-center",children:[(0,t.jsx)("span",{className:"mr-2",children:"\uD83D\uDC68‍\uD83C\uDFEB"}),"\xc0 propos de l'instructeur"]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center",children:[(0,t.jsx)("div",{className:"mb-4 sm:mb-0 sm:mr-6",children:s.photo_url?(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(d.default,{src:s.photo_url,alt:s.name,width:80,height:80,className:"rounded-full border-2 border-blue-100 shadow-sm"}),(0,t.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white"})]}):(0,t.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-100 to-purple-100 text-blue-800 rounded-full flex items-center justify-center text-xl font-semibold shadow-sm border-2 border-blue-100",children:s.name.charAt(0)})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-1 text-gray-900 dark:text-white",children:s.name}),(0,t.jsx)("p",{className:"text-blue-600 dark:text-blue-400 font-medium mb-2 capitalize",children:"teacher"===s.role?"Enseignant":"admin"===s.role?"Administrateur":"\xc9tudiant"}),(0,t.jsx)("div",{className:"flex items-center mt-3",children:(0,t.jsx)(i(),{href:"/courses?creator=".concat(s.id),className:"text-sm bg-gradient-to-r from-gray-50 to-blue-50 hover:from-gray-100 hover:to-blue-100 text-gray-700 py-2 px-4 rounded-full transition-all duration-200 shadow-sm hover:shadow-md transform hover:scale-105",children:"\uD83D\uDCDA Voir tous les cours"})})]})]}),(0,t.jsxs)("div",{className:"mt-6",children:[(0,t.jsxs)("h4",{className:"font-medium mb-2 flex items-center text-gray-900 dark:text-white",children:["\xc0 propos",s.bio&&(0,t.jsx)("span",{className:"ml-2 text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded-full",children:"Bio personnalis\xe9e"})]}),(0,t.jsx)("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:s.bio?s.bio:(0,t.jsxs)(t.Fragment,{children:[s.name," est un \xe9ducateur passionn\xe9 avec une expertise dans divers domaines de la technologie et de la programmation. Avec des ann\xe9es d'exp\xe9rience dans l'industrie, il apporte des connaissances pratiques et des meilleures pratiques \xe0 ses cours."]})})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("h4",{className:"font-medium mb-2 flex items-center text-gray-900 dark:text-white",children:"\uD83D\uDCE7 Contact"}),(0,t.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:(0,t.jsxs)("a",{href:"mailto:".concat(s.email),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 hover:underline transition-colors duration-200 flex items-center",children:[(0,t.jsx)("span",{className:"mr-2",children:"✉️"}),s.email]})})]})]})}):(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6",children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white flex items-center",children:[(0,t.jsx)("span",{className:"mr-2",children:"\uD83D\uDC68‍\uD83C\uDFEB"}),"\xc0 propos de l'instructeur"]}),(0,t.jsxs)("div",{className:"text-gray-600 dark:text-gray-400 text-center py-8",children:[(0,t.jsx)("div",{className:"text-4xl mb-4",children:"\uD83E\uDD14"}),(0,t.jsx)("p",{className:"text-lg font-medium",children:"Informations de l'instructeur non disponibles"}),(0,t.jsx)("p",{className:"text-sm mt-2",children:"Le profil du cr\xe9ateur du cours n'est pas accessible pour le moment."})]})]})}function h(e){let{courseId:s,creatorId:r,relatedCourses:a}=e;return 0===a.length?null:(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Plus de cours de ce cr\xe9ateur"}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:a.map(e=>(0,t.jsx)(x,{course:e},e.id))}),(0,t.jsx)("div",{className:"mt-6 text-center",children:(0,t.jsx)(i(),{href:"/courses?creator=".concat(r),className:"text-blue-600 hover:text-blue-800 font-medium",children:"Voir tous les cours de ce cr\xe9ateur"})})]})})}function x(e){let{course:s}=e;return(0,t.jsxs)(i(),{href:"/courses/".concat(s.id),className:"group block bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[(0,t.jsx)("div",{className:"relative h-32 w-full",children:s.thumbnail_url?(0,t.jsx)(d.default,{src:s.thumbnail_url,alt:s.title,fill:!0,sizes:"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 25vw",className:"object-cover"}):(0,t.jsx)("div",{className:"w-full h-full bg-gray-200 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-gray-400 text-sm",children:"Aucune image"})})}),(0,t.jsxs)("div",{className:"p-3",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-800 mb-1 line-clamp-2 group-hover:text-blue-600",children:s.title}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[(0,t.jsxs)("span",{children:[s.section_count||0," sections"]}),s.creator&&(0,t.jsx)("span",{children:s.creator.name})]})]})]})}function g(){return(0,t.jsxs)("div",{className:"animate-pulse",children:[(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden mb-8",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-5",children:[(0,t.jsx)("div",{className:"lg:col-span-2 relative",children:(0,t.jsx)("div",{className:"h-48 lg:h-64 bg-gray-200"})}),(0,t.jsxs)("div",{className:"lg:col-span-3 p-6",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-3/4 mb-4"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2 w-full"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-6 w-2/3"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-4 items-center",children:[(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-36"}),(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-24"}),(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-28"})]})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,t.jsxs)("div",{className:"lg:col-span-2",children:[(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden mb-8",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-48 mb-6"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]}),(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-40 mt-6 mb-3"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]}),(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-36 mt-6 mb-3"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})]})}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden mb-8",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-48 mb-6"}),(0,t.jsx)("div",{className:"space-y-3",children:[void 0,void 0,void 0].map((e,s)=>(0,t.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("div",{className:"h-5 bg-gray-200 rounded w-1/3"}),(0,t.jsx)("div",{className:"h-5 bg-gray-200 rounded w-16"})]})},s))})]})}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-48 mb-6"}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center",children:[(0,t.jsx)("div",{className:"w-20 h-20 bg-gray-200 rounded-full mb-4 sm:mb-0 sm:mr-6"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"h-5 bg-gray-200 rounded w-40 mb-2"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-32 mb-4"}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-24"}),(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-32"})]})]})]}),(0,t.jsxs)("div",{className:"mt-6",children:[(0,t.jsx)("div",{className:"h-5 bg-gray-200 rounded w-20 mb-3"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full mb-1"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full mb-1"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})]})})]}),(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-200",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-24 mb-6"}),(0,t.jsx)("div",{className:"h-12 bg-gray-200 rounded w-full mb-6"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/6"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]})]})]})})]}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden mt-8",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-64 mb-6"}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden",children:[(0,t.jsx)("div",{className:"h-32 bg-gray-200"}),(0,t.jsxs)("div",{className:"p-3",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2"}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("div",{className:"h-3 bg-gray-200 rounded w-16"}),(0,t.jsx)("div",{className:"h-3 bg-gray-200 rounded w-20"})]})]})]},s))})]})})]})}var p=r(20),b=r(7809);let f=e=>{let{status:s="not-enrolled",className:r="",tooltipText:l,notEnrolledText:n="S'inscrire maintenant",processingText:i="Traitement...",enrolledText:o="Inscrit",onClick:d,disabled:c=!1}=e,[u,m]=(0,a.useState)(!1),h={"not-enrolled":n,processing:i,enrolled:o},x="".concat("relative inline-flex items-center justify-center px-6 py-3 rounded-md font-medium transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gold-500"," ").concat({"not-enrolled":"bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-700 hover:to-gray-900 text-white",processing:"bg-gray-400 text-white cursor-not-allowed opacity-80",enrolled:"bg-green-600 hover:bg-green-700 text-white"}[s]," ").concat(c?"opacity-50 cursor-not-allowed":""," ").concat(r);return(0,t.jsxs)("div",{className:"relative inline-block",children:[(0,t.jsxs)("button",{className:x,onClick:()=>{c||"processing"===s||null==d||d()},disabled:c||"processing"===s,"aria-busy":"processing"===s,"aria-label":h[s],onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),onFocus:()=>m(!0),onBlur:()=>m(!1),children:["processing"===s&&(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"enrolled"===s&&(0,t.jsx)("svg",{className:"-ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),h[s]]}),l&&u&&(0,t.jsx)(b.m,{text:l})]})};var v=r(9535);async function j(e,s){if(!e||!s)return{isEnrolled:!1,enrollment:null};try{let r=(0,v.createBrowserClient)("https://qrowzznnnarfogfbnnow.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI"),{data:t,error:a}=await r.from("enrollments").select("*").eq("user_id",e).eq("course_id",s).eq("status","active").single();if(a&&"PGRST116"!==a.code)throw console.error("Error checking enrollment status:",a),a;return{isEnrolled:!!t,enrollment:t}}catch(e){return console.error("Failed to check enrollment:",e),{isEnrolled:!1,enrollment:null}}}async function N(e,s,r){try{if(e){let s=(0,v.createBrowserClient)("https://qrowzznnnarfogfbnnow.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI"),{data:r}=await s.from("users").select("membership").eq("id",e).single();if((null==r?void 0:r.membership)==="subscribed")return{status:"not-enrolled",message:"Subscription active: click to enroll for free",canEnroll:!0}}}catch(e){}if(!e)return{status:"not-enrolled",message:"Please log in to enroll in this course",canEnroll:!1};if(!s)return{status:"not-enrolled",message:"Your account does not have permission to enroll in courses",canEnroll:!1};if("admin"!==s&&"teacher"!==s&&"student"!==s)return{status:"not-enrolled",message:"Your account type cannot enroll in courses",canEnroll:!1};try{if(e){let s=(0,v.createBrowserClient)("https://qrowzznnnarfogfbnnow.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI"),{data:r}=await s.from("users").select("membership").eq("id",e).single();if((null==r?void 0:r.membership)==="free")return{status:"not-enrolled",message:"Subscribe to get access to all courses",canEnroll:!1}}}catch(e){}try{let{isEnrolled:s}=await j(e,r);if(s)return{status:"enrolled",message:"You are enrolled in this course",canEnroll:!1};return{status:"not-enrolled",message:"Click to enroll in this course",canEnroll:!0}}catch(e){return console.error("Error verifying enrollment eligibility:",e),{status:"not-enrolled",message:"An error occurred. Please try again.",canEnroll:!0}}}async function y(e){try{let s=await fetch("/api/checkout/".concat(e),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok){let e=await s.json();if(401===s.status)return console.error("Authentication error from API:",e.error),{success:!1,error:"Authentication required. Please log in before enrolling."};if(409===s.status)return{success:!1,alreadyEnrolled:!0,error:e.error||"You are already enrolled in this course"};throw Error(e.error||"HTTP error! Status: ".concat(s.status))}return await s.json(),{success:!0}}catch(e){return console.error("Checkout error:",e),{success:!1,error:e.message||"Failed to initiate checkout"}}}function w(e){var s,r;let{course:n,initialEnrollmentStatus:i="not-enrolled"}=e,{user:o,dbUser:d,loading:c}=(0,p.As)(),u=(0,l.useRouter)(),[m,h]=(0,a.useState)(i),[x,g]=(0,a.useState)(!!i),[b,v]=(0,a.useState)(""),[w,k]=(0,a.useState)(null),[C,I]=(0,a.useState)(!1),[D,E]=(0,a.useState)(!1),[S,_]=(0,a.useState)(!1);(0,a.useRef)(!1),(0,a.useEffect)(()=>{h(i),"enrolled"===i?v("Cliquez pour regarder ce cours"):"processing"===i?v("Traitement de votre inscription..."):v("Cliquez pour vous inscrire \xe0 ce cours")},[i]),(0,a.useEffect)(()=>{I(!1)},[]),(0,a.useEffect)(()=>{if(i&&x)return;let e=async()=>{if(!(null==n?void 0:n.id))return;let{status:e,message:s}=await N(null==o?void 0:o.id,null==d?void 0:d.role,n.id);"enrolled"===e?h("enrolled"):h("not-enrolled"),v(s),g(!0)};c||e()},[o,d,n.id,c,i,x]);let z=async e=>{try{console.log("Creating enrollment record...");let e=await fetch("/api/enrollments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({courseId:n.id})}),s=await e.json();if(!e.ok){if(console.warn("API response not OK. Inspecting payload for success-like states:",e.status,s),(null==s?void 0:s.success)||(null==s?void 0:s.alreadyEnrolled))return console.log("Treating non-OK response as success due to payload flags"),!0;try{let{isEnrolled:e}=await j(null==o?void 0:o.id,n.id);if(e)return console.log("Enrollment verified despite non-OK response. Treating as success."),!0}catch(e){console.warn("Failed to verify enrollment after non-OK response:",e)}throw console.error("API response error:",e.status,s),Error((null==s?void 0:s.error)||"Failed to create enrollment record")}if(console.log("Enrollment record created successfully:",s),s.success)return s.alreadyEnrolled&&console.log("User was already enrolled in this course"),!0;try{let{isEnrolled:e}=await j(null==o?void 0:o.id,n.id);if(e)return console.log("Post-success-flag missing, but enrollment verified. Treating as success."),!0}catch(e){console.warn("Verification after ambiguous response failed:",e)}throw Error((null==s?void 0:s.error)||"Unknown error during enrollment")}catch(e){console.error("Error creating enrollment record:",e);try{let{isEnrolled:e}=await j(null==o?void 0:o.id,n.id);if(e)return console.log("Enrollment exists despite caught error. Treating as success."),!0}catch(e){console.warn("Verification after catch failed:",e)}return k("Impossible de finaliser votre inscription: ".concat(e.message,". Veuillez contacter le support.")),!1}},A=async()=>{if(!("string"==typeof n.id&&/^[0-9a-fA-F-]{36}$/.test(n.id))){k("L'inscription est d\xe9sactiv\xe9e en mode maquette ou pour un identifiant de cours invalide."),v("Mode donn\xe9es factices d\xe9tect\xe9");return}if("enrolled"===m)return void u.push("/learning/".concat(n.id));if(k(null),(null==d?void 0:d.membership)==="free")return void u.push("/payment?courseId=".concat(encodeURIComponent(n.id)));if((null==d?void 0:d.membership)==="subscribed"){try{h("processing"),await z("subscription")?(h("enrolled"),v("Vous \xeates inscrit \xe0 ce cours"),u.refresh()):(h("not-enrolled"),k("Impossible de finaliser votre inscription. Veuillez r\xe9essayer."))}catch(e){h("not-enrolled"),k((null==e?void 0:e.message)||"Une erreur s'est produite lors de l'inscription")}return}if(!o){sessionStorage.setItem("redirectAfterLogin","/courses/".concat(n.id)),u.push("/signin");return}if(!(null==d?void 0:d.role)||"admin"!==d.role&&"teacher"!==d.role&&"student"!==d.role){k("Votre compte n'a pas la permission de s'inscrire aux cours"),console.error("Votre compte n'a pas la permission de s'inscrire aux cours");return}h("processing");try{var e;console.log("Initiating checkout for course:",n.id);let s=await y(n.id);if(console.log("Checkout result:",s),s.success)console.log("Enrollment successful"),h("enrolled"),v("Vous \xeates inscrit \xe0 ce cours");else if(s.alreadyEnrolled)h("enrolled"),v("Vous \xeates d\xe9j\xe0 inscrit \xe0 ce cours");else if(null==(e=s.error)?void 0:e.includes("Authentication required")){console.log("Authentication error detected, redirecting to login");let e="/courses/".concat(n.id);sessionStorage.setItem("redirectAfterLogin",e),u.push("/signin?redirectTo=".concat(encodeURIComponent(e)))}else h("not-enrolled"),k(s.error||"\xc9chec de l'inscription"),v("Cliquez pour r\xe9essayer l'inscription")}catch(e){if(console.error("Enrollment error:",e),e.message&&e.message.includes("Authentication required")){console.log("Authentication error detected in catch block, redirecting to login");let e="/courses/".concat(n.id);sessionStorage.setItem("redirectAfterLogin",e),u.push("/signin?redirectTo=".concat(encodeURIComponent(e)))}else h("not-enrolled"),k(e.message||"Une erreur s'est produite lors de l'inscription"),v("Cliquez pour r\xe9essayer l'inscription")}},F="number"==typeof n.duration?Math.round(n.duration):0;return x||c?(0,t.jsxs)(a.Fragment,{children:[(0,t.jsx)("div",{className:"sticky top-6",children:(0,t.jsxs)("div",{className:"rounded-2xl border-2 border-orange-200 bg-gradient-to-br from-orange-50 to-yellow-50 p-6 shadow-lg",children:[(0,t.jsxs)("div",{className:"mb-6 flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-3xl",children:"\uD83D\uDE80"}),(0,t.jsx)("h3",{className:"text-xl font-bold text-orange-700",children:"Commencer l'aventure"})]}),(0,t.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Dur\xe9e totale :"}),(0,t.jsxs)("span",{className:"font-semibold",children:[F," min"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Cr\xe9\xe9 par :"}),(0,t.jsx)("span",{className:"font-semibold",children:(null==(s=n.creator)?void 0:s.name)||"Inconnu"})]}),n.playback_id&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Statut vid\xe9o :"}),(0,t.jsx)("span",{className:"font-semibold text-green-600",children:"Disponible"})]}),(0,t.jsxs)("div",{className:"mb-6 w-full",children:[(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)(f,{status:m,onClick:A,disabled:c||"processing"===m,tooltipText:"enrolled"===m?"Aller au cours":C?b:"Chargement du syst\xe8me de paiement...",notEnrolledText:"s'inscrire maintenant",enrolledText:"\uD83C\uDFAF Commencer \xe0 apprendre",className:"w-full transform rounded-xl border-2 border-green-400 bg-gradient-to-r from-green-500 to-emerald-600 px-6 py-4 text-lg font-bold text-white shadow-lg transition-all duration-200 hover:scale-105 hover:border-green-500 hover:from-green-600 hover:to-emerald-700 hover:shadow-xl"}),(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 rounded-xl bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 transition-opacity duration-300 group-hover:animate-pulse group-hover:opacity-100"})]}),"enrolled"===m&&(null==d?void 0:d.role)!=="admin"&&(0,t.jsx)("button",{onClick:async()=>{try{console.log("Unenrolling from course"),k(null),h("processing");let e=await fetch("/api/enrollments/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({courseId:n.id})}),s=await e.json().catch(()=>({}));if(console.log("Unenrollment response:",s),!e.ok||!(null==s?void 0:s.success))throw Error((null==s?void 0:s.error)||"Failed to unenroll from course");h("not-enrolled"),v("Cliquez pour vous inscrire \xe0 ce cours"),u.refresh()}catch(e){h("enrolled"),k((null==e?void 0:e.message)||"Impossible de vous d\xe9sinscrire pour le moment.")}},className:"mt-4 w-full rounded-xl border-2 border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 transition-all duration-200 hover:border-gray-400 hover:bg-gray-50",children:"Se d\xe9sinscrire du cours"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"rounded-xl border border-orange-200 bg-white/60 p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xl",children:"⏰"}),(0,t.jsx)("span",{className:"font-medium text-gray-700",children:"Dur\xe9e totale"})]}),(0,t.jsxs)("span",{className:"font-bold text-gray-800",children:[F," min"]})]})}),(0,t.jsx)("div",{className:"rounded-xl border border-orange-200 bg-white/60 p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xl",children:"\uD83D\uDC68‍\uD83C\uDFEB"}),(0,t.jsx)("span",{className:"font-medium text-gray-700",children:"Enseignant"})]}),(0,t.jsx)("span",{className:"font-bold text-gray-800",children:(null==(r=n.creator)?void 0:r.name)||"Inconnu"})]})}),n.playback_id&&(0,t.jsx)("div",{className:"rounded-xl border border-orange-200 bg-white/60 p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xl",children:"\uD83D\uDCF9"}),(0,t.jsx)("span",{className:"font-medium text-gray-700",children:"Vid\xe9os"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"h-2 w-2 animate-pulse rounded-full bg-green-500"}),(0,t.jsx)("span",{className:"font-bold text-green-600",children:"Disponibles"})]})]})})]}),(0,t.jsx)("div",{className:"mt-6 rounded-xl border border-sky-200 bg-gradient-to-r from-sky-100 to-blue-100 p-4",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"mb-2 text-2xl",children:"\uD83C\uDF1F"}),(0,t.jsx)("p",{className:"text-sm font-medium text-sky-800",children:"Rejoins des milliers d'\xe9l\xe8ves qui apprennent en s'amusant !"})]})})]})]})}),D&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-md rounded-lg bg-white p-6 shadow-xl",children:[(0,t.jsx)("div",{className:"mb-4 text-lg font-semibold",children:"Finalisation de votre inscription…"}),(0,t.jsx)("p",{className:"mb-4 text-sm text-gray-600",children:"Cela ne prend g\xe9n\xe9ralement qu'un instant."}),(0,t.jsx)("div",{className:"h-2 w-full overflow-hidden rounded bg-gray-200",children:(0,t.jsx)("div",{className:"h-2 w-1/2 animate-pulse rounded bg-blue-600"})})]})}),S&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-md rounded-lg bg-white p-6 shadow-xl",children:[(0,t.jsx)("div",{className:"mb-2 text-lg font-semibold",children:"Vous \xeates inscrit ! \uD83C\uDF89"}),(0,t.jsxs)("p",{className:"mb-6 text-sm text-gray-700",children:["Vous avez maintenant acc\xe8s \xe0 ",n.title,". Commencez \xe0 apprendre d\xe8s maintenant."]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-end",children:[(0,t.jsx)("button",{onClick:()=>{_(!1),u.push("/learning/".concat(n.id))},className:"w-full rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 sm:w-auto",children:"Commencer \xe0 apprendre"}),(0,t.jsx)("button",{onClick:()=>{_(!1),u.refresh()},className:"w-full rounded border border-gray-300 px-4 py-2 text-gray-700 hover:bg-gray-50 sm:w-auto",children:"Fermer"})]})]})})]}):(0,t.jsxs)("div",{className:"animate-pulse rounded-lg border border-gray-200 bg-white p-6 shadow-md",children:[(0,t.jsx)("div",{className:"mb-4 h-7 w-1/3 rounded bg-gray-200"}),(0,t.jsx)("div",{className:"mb-4 h-10 rounded bg-gray-200"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"h-4 rounded bg-gray-200"}),(0,t.jsx)("div",{className:"h-4 rounded bg-gray-200"}),(0,t.jsx)("div",{className:"h-4 rounded bg-gray-200"})]})]})}var k=r(8183);let C=(0,r(970).r)(function(e){let{params:s}=e,{id:r}=(0,a.use)(s),n=(0,l.useRouter)(),{user:i,dbUser:d}=(0,p.As)(),[x,b]=(0,a.useState)(!0),[f,v]=(0,a.useState)(null),[N,y]=(0,a.useState)(null),[C,I]=(0,a.useState)([]),[D,E]=(0,a.useState)(0),[S,_]=(0,a.useState)(!1),[z,A]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{if((null==d?void 0:d.role)==="admin"){_(!0),A(!1);return}if(!(null==i?void 0:i.id)||!r){_(!1),A(!1);return}try{A(!0);let{isEnrolled:e}=await j(i.id,r);_(e)}catch(e){console.error("Error checking enrollment:",e),_(!1)}finally{A(!1)}})()},[i,r,d]);let F=(0,a.useCallback)(async e=>{if(e)try{let s=(0,k.JT)()?k.jy.b_.find(e=>e.id===r):await (0,k.YG)(r);if(!s){e&&n.push("/404");return}if(!e)return;y(s);let t=(0,k.JT)()?k.jy.b_.filter(e=>e.creator_id===s.creator_id&&e.id!==r).slice(0,4):await (0,k.NJ)({creator_id:s.creator_id,limit:5}).then(e=>e.filter(e=>e.id!==r).slice(0,4));if(!e)return;I(t),v(null),E(Date.now())}catch(s){if(console.error("Error fetching course data:",s),!e)return;v("\xc9chec du chargement du cours. Veuillez r\xe9essayer."),y(null),I([])}finally{e&&b(!1)}},[r,n]);return((0,a.useEffect)(()=>{let e=!0,s=()=>Date.now()-D>3e5||null!==f,r=()=>{!document.hidden&&s()&&(b(!0),F(!0))};return F(!0),document.addEventListener("visibilitychange",r),()=>{document.removeEventListener("visibilitychange",r)}},[F,D,f]),x)?(0,t.jsx)(g,{}):f?(0,t.jsx)("div",{className:"min-h-screen w-full bg-white",children:(0,t.jsx)("div",{className:"w-full py-12",children:(0,t.jsx)("div",{className:"container mx-auto px-4",children:(0,t.jsxs)("div",{className:"text-center text-red-600",children:[(0,t.jsx)("p",{children:f}),(0,t.jsx)("button",{onClick:()=>{b(!0),F(!0)},className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"R\xe9essayer"})]})})})}):N?(0,t.jsx)("div",{className:"min-h-screen w-full bg-gradient-to-br from-sky-50 via-white to-blue-50",children:(0,t.jsx)("div",{className:"w-full pt-6 pb-16",children:(0,t.jsxs)("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl",children:[(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)(o,{items:[{label:"Cours",href:"/courses"},{label:N.title,href:"/courses/".concat(N.id)}]})}),(0,t.jsxs)(a.Suspense,{fallback:(0,t.jsx)(g,{}),children:[(0,t.jsx)(c,{course:N}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-12",children:[(0,t.jsx)(u,{course:N}),(0,t.jsxs)("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-2xl p-6 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,t.jsx)("span",{className:"text-3xl",children:"\uD83D\uDC68‍\uD83C\uDFEB"}),(0,t.jsx)("h3",{className:"text-2xl font-bold text-indigo-700",children:"Ton enseignant"})]}),(0,t.jsx)(m,{creator:N.creator})]})]}),(0,t.jsx)("div",{className:"lg:col-span-1 order-first lg:order-last",children:(0,t.jsx)(w,{course:N,initialEnrollmentStatus:(null==d?void 0:d.role)==="admin"?"enrolled":z?"processing":S?"enrolled":"not-enrolled"})})]}),(0,t.jsx)("div",{className:"mt-16",children:(0,t.jsxs)("div",{className:"bg-gradient-to-r from-green-50 to-teal-50 border-2 border-green-200 rounded-2xl p-8 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-8",children:[(0,t.jsx)("span",{className:"text-3xl",children:"\uD83C\uDFAA"}),(0,t.jsx)("h3",{className:"text-2xl font-bold text-green-700",children:"Autres cours qui pourraient te plaire"})]}),(0,t.jsx)(h,{courseId:N.id,creatorId:N.creator_id,relatedCourses:C})]})})]})]})})}):null},{requireAuth:!1})}},e=>{var s=s=>e(e.s=s);e.O(0,[5647,6874,6766,9535,4704,8441,1684,7358],()=>s(1313)),_N_E=e.O()}]);