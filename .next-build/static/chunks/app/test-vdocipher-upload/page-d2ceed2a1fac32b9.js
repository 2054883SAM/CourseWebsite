(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[988],{7035:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var s=a(5155),i=a(2115),o=a(4647),r=a(3107);function l(){let{user:e,dbUser:t}=(0,r.As)(),[a,l]=(0,i.useState)(""),[n,d]=(0,i.useState)(null),[c,u]=(0,i.useState)(!1),[p,g]=(0,i.useState)(0),[x,m]=(0,i.useState)([]),[h,f]=(0,i.useState)(null),[b,y]=(0,i.useState)(null),v=(0,i.useRef)(null),w=(e,t)=>{let a=new Date().toLocaleTimeString(),s="[".concat(a,"] ").concat(e);console.log(s,t||""),m(e=>[...e,t?"".concat(s," - ").concat(JSON.stringify(t,null,2)):s])},N=async()=>{if(!n||!a.trim())return void w("ERROR: Video file and title are required");u(!0),g(0),f(null),w("=== STARTING VDOCIPHER UPLOAD TEST ===");try{w("STEP 1: Requesting upload credentials from VdoCipher..."),g(10);let e=await fetch("/api/upload-video/vdocipher-credentials",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:a.trim(),folderId:"root"})});if(w("STEP 1: Credentials request sent",{status:e.status,statusText:e.statusText}),!e.ok){let t=await e.text();throw Error("Credentials request failed: ".concat(e.status," - ").concat(t))}let{clientPayload:t,videoId:s}=await e.json();w("STEP 1: Upload credentials received",{videoId:s,hasClientPayload:!!t,uploadLink:null==t?void 0:t.uploadLink}),g(25),w("STEP 2: Uploading video file to VdoCipher...");let i=new FormData;i.append("file",n),i.append("uploadCredentials",JSON.stringify(t)),w("STEP 2: FormData prepared, sending upload request...");let o=await fetch("/api/upload-video/vdocipher-upload",{method:"POST",body:i});if(w("STEP 2: Upload request sent",{status:o.status,statusText:o.statusText}),!o.ok){let e=await o.text();throw Error("Upload failed: ".concat(o.status," - ").concat(e))}let r=await o.json();w("STEP 2: Video upload completed",r),g(50),w("STEP 3: Monitoring video processing status..."),w("NOTE: Large videos can take several hours to process. This test will monitor for up to 10 minutes.");let l=!1,d=0,c=Date.now();for(;!l&&d<60;){d++;let e=Date.now()-c,t=(e/6e4).toFixed(1),a=50+d/60*40;if(g(a),e>6e5){w("⏰ STEP 3: Maximum test time reached (10 minutes). Stopping monitoring."),w("NOTE: Video processing may continue in the background for hours.");break}w("STEP 3: Status check attempt ".concat(d,"/").concat(60," (").concat(t,"m elapsed)...")),d>1&&await new Promise(e=>setTimeout(e,1e4));let i=await fetch("/api/upload-video/vdocipher-status?videoId=".concat(s),{method:"GET"});if(!i.ok){let e=await i.text();w("STEP 3: Status check ".concat(d," failed"),{status:i.status,error:e});continue}let o=await i.json();if(w("STEP 3: Status check ".concat(d," result"),{...o,elapsedTime:"".concat(t,"m")}),o.isReady)l=!0,w("\uD83C\uDF89 STEP 3: Video is ready for playback after ".concat(t," minutes!"));else if("Error"===o.status||"Failed"===o.status)throw Error("Video processing failed with status: ".concat(o.status));else w("STEP 3: Video still processing (status: ".concat(o.status,"), waiting...")),12===d?w("ℹ️ STEP 3: Processing is taking longer than usual. Large videos can take hours to process."):30===d?w("ℹ️ STEP 3: Still processing... VdoCipher may need significant time for large/high-quality videos."):48===d&&w("ℹ️ STEP 3: Long processing detected. In production, courses can be created while videos process in background.")}if(!l){let e=((Date.now()-c)/6e4).toFixed(1);w("⚠️ STEP 3: Video is still processing after ".concat(e," minutes of monitoring.")),w("✅ STEP 3: Upload was successful! Processing will continue in background."),w("\uD83D\uDCDD NOTE: In production, courses are created immediately while videos process separately.")}g(100);let u={success:!0,videoId:s,isReady:l,attempts:d,message:l?"Video uploaded and processed successfully!":"Video uploaded successfully, still processing..."};f(u),w("=== UPLOAD TEST COMPLETED ===",u)}catch(t){let e=t instanceof Error?t.message:"Unknown error";w("❌ ERROR: Upload test failed",{error:e}),f({success:!1,error:e})}finally{u(!1)}},T=async()=>{try{if(y(null),w("=== STARTING CAPTION GENERATION ==="),!(null==h?void 0:h.videoId))return void w("ERROR: No videoId available from previous upload");w("CAPTIONS: Requesting Deepgram transcription (webvtt)...");let e=await fetch("/api/upload-video/deepgram-captions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:"https://static.deepgram.com/examples/deep-learning-podcast-clip.wav",format:"vtt"})});if(!e.ok){let t=await e.text();throw Error("Deepgram captions failed: ".concat(e.status," - ").concat(t))}let{captions:t}=await e.json();w("CAPTIONS: Deepgram captions generated. Uploading to VdoCipher...");let a=await fetch("/api/upload-video/vdocipher-upload-caption",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoId:h.videoId,captions:t,language:"en"})});if(!a.ok){let e=await a.text();throw Error("VdoCipher caption upload failed: ".concat(a.status," - ").concat(e))}let s=await a.json();y({success:!0,...s}),w("=== CAPTION UPLOAD COMPLETED ===",s)}catch(t){let e=t instanceof Error?t.message:"Unknown error";y({success:!1,error:e}),w("❌ ERROR: Caption flow failed",{error:e})}};return e?(0,s.jsx)(o.Mx,{children:(0,s.jsx)(o.wn,{className:"py-8 bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,s.jsx)(o.mc,{children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"\uD83E\uDDEA VdoCipher Upload Test"}),(0,s.jsx)("p",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Test the VdoCipher video upload integration with detailed logging"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["Logged in as: ",(0,s.jsx)("span",{className:"font-semibold",children:(null==t?void 0:t.name)||(null==e?void 0:e.email)})," (",null==e?void 0:e.role,")"]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8 dark:bg-gray-800 mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6",children:"Upload Configuration"}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Video Title *"}),(0,s.jsx)("input",{type:"text",value:a,onChange:e=>l(e.target.value),disabled:c,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200",placeholder:"Enter video title for VdoCipher..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Video File *"}),(0,s.jsx)("input",{type:"file",ref:v,onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&(d(a),w("Video file selected",{name:a.name,size:"".concat((a.size/1024/1024).toFixed(2)," MB"),type:a.type}))},accept:"video/*",disabled:c,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200"}),n&&(0,s.jsxs)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Selected: ",n.name," (",(n.size/1024/1024).toFixed(2)," MB)"]})]}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{onClick:N,disabled:c||!n||!a.trim(),className:"flex-1 inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-xl shadow-lg hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300",children:c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Testing Upload... (",p.toFixed(0),"%)"]}):"\uD83D\uDE80 Start VdoCipher Upload Test"}),(0,s.jsx)("button",{onClick:T,disabled:c||!(null==h?void 0:h.videoId),className:"px-6 py-3 bg-indigo-600 text-white font-semibold rounded-xl hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 transition-all duration-200",children:"Generate & Upload Captions (VTT)"}),(0,s.jsx)("button",{onClick:()=>{m([]),f(null),w("Logs cleared")},disabled:c,className:"px-6 py-3 bg-gray-500 text-white font-semibold rounded-xl hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 disabled:opacity-50 transition-all duration-200",children:"Clear Logs"}),(0,s.jsx)("button",{onClick:()=>{l(""),d(null),g(0),m([]),f(null),u(!1),v.current&&(v.current.value=""),w("Test reset")},disabled:c,className:"px-6 py-3 bg-red-500 text-white font-semibold rounded-xl hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 transition-all duration-200",children:"Reset"})]})]}),c&&(0,s.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded-xl dark:bg-blue-900/20",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Upload Progress"}),(0,s.jsxs)("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:[p.toFixed(0),"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-3 dark:bg-blue-800",children:(0,s.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-3 rounded-full transition-all duration-300",style:{width:"".concat(p,"%")}})})]}),h&&(0,s.jsxs)("div",{className:"mt-6 p-4 rounded-xl ".concat(h.success?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"),children:[(0,s.jsx)("h3",{className:"font-semibold mb-2 ".concat(h.success?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"),children:h.success?"✅ Test Result: SUCCESS":"❌ Test Result: FAILED"}),(0,s.jsx)("pre",{className:"text-sm ".concat(h.success?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:JSON.stringify(h,null,2)})]})]}),(0,s.jsxs)("div",{className:"bg-gray-900 rounded-2xl shadow-lg p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h2",{className:"text-xl font-bold text-white",children:["\uD83D\uDCCB Debug Logs (",x.length,")"]}),(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"Real-time logging with console output"})]}),(0,s.jsx)("div",{className:"bg-black rounded-xl p-4 h-96 overflow-y-auto font-mono text-sm",children:0===x.length?(0,s.jsx)("div",{className:"text-gray-500 italic",children:"No logs yet. Start an upload test to see detailed debugging information..."}):x.map((e,t)=>(0,s.jsx)("div",{className:"mb-1 ".concat(e.includes("ERROR")||e.includes("❌")?"text-red-400":e.includes("SUCCESS")||e.includes("✅")||e.includes("\uD83C\uDF89")?"text-green-400":e.includes("STEP")?"text-blue-400":e.includes("⚠️")?"text-yellow-400":"text-gray-300"),children:e},t))})]})]})})})}):(0,s.jsx)(o.Mx,{children:(0,s.jsx)(o.wn,{className:"py-8",children:(0,s.jsx)(o.mc,{children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Authentication Required"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Please sign in to test VdoCipher upload functionality."})]})})})})}},8941:(e,t,a)=>{Promise.resolve().then(a.bind(a,7035))}},e=>{var t=t=>e(e.s=t);e.O(0,[5647,6874,6766,8415,4647,8441,1684,7358],()=>t(8941)),_N_E=e.O()}]);