(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2972],{1393:(e,r,t)=>{"use strict";t.d(r,{NJ:()=>n,Ox:()=>l,W9:()=>o,YG:()=>c,bW:()=>a});var s=t(6414);function i(e,r){if(console.error("Error while trying to ".concat(r,":"),e),e instanceof Error&&"Request timed out"===e.message)throw Error("Taking longer than expected to ".concat(r,". Please check your connection and try again."));throw e}async function a(){try{let{data:e,error:r}=await s.N.from("courses").select("categorie").not("categorie","is",null);if(r)throw r;if(!e)return[];let t=e.reduce((e,r)=>(r.categorie&&(e[r.categorie]=(e[r.categorie]||0)+1),e),{});return Object.entries(t).map(e=>{let[r,t]=e;return{categorie:r,count:t}})}catch(e){i(e,"load categories")}}async function n(e){try{let{query:r="",creator_id:t,category:i,sort_by:a="created_at",sort_order:n="desc",page:c=1,limit:o=10}=e||{},l=(c-1)*o,d=s.N.from("courses").select("*, users!creator_id(name, photo_url, bio)");r&&(d=d.ilike("title","%".concat(r,"%"))),t&&(d=d.eq("creator_id",t)),i&&(d=d.eq("categorie",i)),d=d.order(a,{ascending:"asc"===n}).range(l,l+o-1);let{data:u,error:m}=await d;if(m)throw m;if(!u)return[];return u.map(e=>({...e,creator:e.users}))}catch(e){i(e,"load courses")}}async function c(e){try{let{data:r,error:t}=await s.N.from("courses").select("*, users!creator_id(id, name, email, photo_url, role, bio)").eq("id",e).single();if(t)throw t;if(!r)return null;let{count:i}=await s.N.from("sections").select("*",{count:"exact",head:!0}).eq("course_id",e);return{...r,creator:r.users,section_count:i||0}}catch(r){console.error("Error fetching course with ID ".concat(e,":"),r),i(r,"load course")}}async function o(e){try{let{data:r,error:t}=await s.N.from("sections").select("*").eq("course_id",e).order("section_number",{ascending:!0});if(t)throw t;if(!r)return[];return r.map(e=>({id:e.id,course_id:e.course_id,section_number:e.section_number,title:e.title,duration:e.duration,playback_id:e.playback_id,chapters:e.chapters?Array.isArray(e.chapters)?e.chapters:JSON.parse(e.chapters):[],questions:e.questions?Array.isArray(e.questions)?e.questions:JSON.parse(e.questions):[],created_at:e.created_at}))}catch(r){console.error("Error fetching sections for course ".concat(e,":"),r),i(r,"load course sections")}}async function l(e){try{let{data:r,error:t}=await s.N.from("sections").select("*").eq("id",e).single();if(t)throw t;if(!r)return null;return{id:r.id,course_id:r.course_id,section_number:r.section_number,title:r.title,duration:r.duration,playback_id:r.playback_id,chapters:r.chapters?Array.isArray(r.chapters)?r.chapters:JSON.parse(r.chapters):[],questions:r.questions?Array.isArray(r.questions)?r.questions:JSON.parse(r.questions):[],created_at:r.created_at}}catch(r){console.error("Error fetching section with ID ".concat(e,":"),r),i(r,"load section")}}},1473:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>m});var s=t(5155),i=t(2115),a=t(5695),n=t(20),c=t(4387),o=t(1393),l=t(6738),d=t(2446),u=t(7667);function m(){let e=(0,a.useParams)(),r=(0,a.useRouter)(),{user:t,dbUser:m,loading:x}=(0,n.As)(),[h,g]=(0,i.useState)(null),[p,f]=(0,i.useState)(null),[b,j]=(0,i.useState)(!0),[y,N]=(0,i.useState)(null),v=(0,i.useRef)(!1),k=(0,i.useRef)(!1),[w,S]=(0,i.useState)(null),[_,q]=(0,i.useState)(!1),[C,A]=(0,i.useState)(null),[D,z]=(0,i.useState)(!1),[O,I]=(0,i.useState)(0),[E,T]=(0,i.useState)(null),[P,F]=(0,i.useState)("idle"),[R,J]=(0,i.useState)({}),[B,G]=(0,i.useState)({}),[Q,U]=(0,i.useState)({}),[W,L]=(0,i.useState)(null),[M,V]=(0,i.useState)(!1),[Y,H]=(0,i.useState)(!1),[K,X]=(0,i.useState)(!1),[Z,$]=(0,i.useState)(0),[ee,er]=(0,i.useState)(0),[et,es]=(0,i.useState)(!1),[ei,ea]=(0,i.useState)(!1),en=e.courseId,ec=e.sectionId,eo=()=>{$(e=>e+1),er(e=>e+1)},el=()=>{er(e=>e+1)},ed=()=>0===ee?0:Math.round(Z/ee*100),eu=e=>e>=90?{emoji:"\uD83C\uDF1F",message:"Incroyable ! Tu es une superstar !",className:"kid-result-success"}:e>=80?{emoji:"\uD83C\uDF89",message:"Excellent travail ! Continue comme \xe7a !",className:"kid-result-success"}:e>=70?{emoji:"\uD83D\uDC4D",message:"Bravo ! Tu peux continuer !",className:"kid-result-success"}:{emoji:"\uD83D\uDCAA",message:"Continue \xe0 t'entra\xeener ! Essaie d'obtenir 70% ou plus.",className:"kid-result-failure"},em=()=>{I(0),$(0),er(0),es(!1),ea(!1),T(null),F("idle"),U({})},ex=async(e,r)=>{if(t&&en&&ec)try{let t=await fetch("/api/progress/section?courseId=".concat(encodeURIComponent(en),"&sectionId=").concat(encodeURIComponent(ec)),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({progressPercentage:100,quizScore:e,quizPassed:r})});if(t.ok)console.log("Quiz score saved successfully");else{let e=await t.json();console.error("Failed to save quiz score:",e)}}catch(e){console.error("Failed to save quiz score:",e)}};if((0,i.useEffect)(()=>{v.current||h&&p||e();async function e(){if(!x){if(!t)return void r.replace("/unauthorized?requiredRole=student");try{j(!0);try{let e=sessionStorage.getItem("course_".concat(en)),r=sessionStorage.getItem("section_".concat(ec));if(e&&r){let t=JSON.parse(e),s=JSON.parse(r);console.log("Using cached course and section data"),g(t),f(s),v.current=!0,j(!1);return}}catch(e){console.warn("Failed to read from session storage:",e)}if(console.log("Fetching course and section data from API"),(null==m?void 0:m.role)==="admin"){let[e,r]=await Promise.all([(0,o.YG)(en),(0,o.Ox)(ec)]);if(!e){N("Course not found"),j(!1);return}if(!r){N("Section not found"),j(!1);return}if(r.course_id!==en){N("Section does not belong to this course"),j(!1);return}let t={id:e.id,title:e.title,description:e.description,thumbnail_url:e.thumbnail_url,created_at:e.created_at,creator_id:e.creator_id,section_count:e.section_count,creator:e.creator};try{sessionStorage.setItem("course_".concat(en),JSON.stringify(t)),sessionStorage.setItem("section_".concat(ec),JSON.stringify(r))}catch(e){console.warn("Failed to cache data:",e)}v.current=!0,g(t),f(r),j(!1);return}let[e,s]=await Promise.all([(0,c.d)(t.id,en),(0,o.Ox)(ec)]);if(e.error||!e.data){N(e.error||"Course not found or not enrolled"),r.replace("/unauthorized?requiredRole=student");return}if(!s){N("Section not found"),j(!1);return}if(s.course_id!==en){N("Section does not belong to this course"),j(!1);return}try{sessionStorage.setItem("course_".concat(en),JSON.stringify(e.data)),sessionStorage.setItem("section_".concat(ec),JSON.stringify(s))}catch(e){console.warn("Failed to cache data:",e)}v.current=!0,g(e.data),f(s)}catch(e){N(e instanceof Error?e.message:"An error occurred")}finally{j(!1)}}}},[en,ec,t,m,x,r,h,p]),b||x)return(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(u.k,{}),(0,s.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading section content..."})]})});if(y)return(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsxs)("div",{className:"max-w-md rounded-lg bg-red-50 p-6 text-center dark:bg-red-900/20",children:[(0,s.jsx)("h2",{className:"mb-4 text-xl font-semibold text-red-800 dark:text-red-400",children:"Error"}),(0,s.jsx)("p",{className:"mb-4 text-red-700 dark:text-red-300",children:y}),(0,s.jsx)("button",{onClick:()=>r.back(),className:"rounded-lg bg-red-600 px-4 py-2 text-white transition-colors hover:bg-red-700",children:"Go Back"})]})});if(!h||!p)return null;let eh=(0,l.UQ)(p.chapters||[]);return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,s.jsx)("div",{className:"border-b border-gray-200 bg-white dark:border-gray-700 dark:bg-gray-800",children:(0,s.jsx)("div",{className:"mx-auto max-w-7xl px-4 py-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("button",{onClick:()=>r.push("/my-learning/".concat(en)),className:"flex items-center text-gray-500 transition-colors hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:[(0,s.jsx)("svg",{className:"mr-2 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Course"]}),(0,s.jsx)("div",{className:"text-gray-300 dark:text-gray-600",children:"|"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:h.title}),(0,s.jsxs)("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Section ",p.section_number,": ",p.title]})]})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Math.round(p.duration||0)," minutes"]})]})})}),(0,s.jsx)("div",{className:"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8",children:(0,s.jsx)(d.A,{videoId:p.playback_id||"",watermark:null==t?void 0:t.email,chapters:eh,className:"w-full",userId:null==t?void 0:t.id,courseId:en,duration:p.duration,onProgress:async e=>{if(t&&e>=0&&(e%5==0||e>=98))try{let r=await fetch("/api/progress/section?courseId=".concat(encodeURIComponent(en),"&sectionId=").concat(encodeURIComponent(ec)),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({progressPercentage:e})});if(!r.ok){let e=await r.json();console.error("Failed to update progress:",e)}}catch(e){console.error("Failed to update section progress:",e)}},onChapterComplete:async e=>{if(e){try{let r=eh.findIndex(r=>r.id===e.id);if(r>=0&&r===eh.length-1)return}catch(e){}if(!0===e.flashcard){V(!0),H(!0);try{let r=e.startTime,t="number"==typeof e.duration?e.duration:void 0,s=await fetch("/api/video/generate-chapter-flashcard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({courseId:en,sectionId:ec,startTime:r,duration:t})});if(!s.ok)return void console.error("Failed to generate chapter flashcard",await s.text());let i=await s.json();(null==i?void 0:i.flashcard)&&(L(i.flashcard),T(null),F("idle"))}catch(e){console.error("Error generating chapter flashcard:",e)}finally{H(!1)}}}},onComplete:async()=>{if(t)try{let e=await fetch("/api/progress/section?courseId=".concat(encodeURIComponent(en),"&sectionId=").concat(encodeURIComponent(ec)),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({progressPercentage:100})});if(e.ok)console.log("Video progress updated to 100%");else{let r=await e.json();console.error("Failed to update video progress:",r)}}catch(e){console.error("Failed to update video progress:",e)}if(!k.current){if(k.current=!0,Array.isArray(null==p?void 0:p.questions)&&(null==p?void 0:p.questions.length)>0){let e=(e=>{let r=[];return e.forEach((e,t)=>{var s,i,a;let n=String((null==e?void 0:e.type)||"").trim();if("flashcard"===n){let i=String((null==e?void 0:e.question)||"").trim(),a=Array.isArray(null==e?void 0:e.choices)?e.choices.map(e=>String(e)):[],n=String((null==e?void 0:e.correctAnswer)||"").trim();i&&a.length>=2&&n&&r.push({id:Number(null!=(s=null==e?void 0:e.id)?s:t+1),type:"flashcard",question:i,choices:a,correctAnswer:n})}else if("fillBlank"===n){let s=String((null==e?void 0:e.sentence)||"").trim(),a=Array.isArray(null==e?void 0:e.choices)?e.choices.map(e=>String(e)):[],n=String((null==e?void 0:e.correctAnswer)||(null==e?void 0:e.correct_answer)||"").trim(),c=(null==e?void 0:e.title)!=null?String(e.title):void 0,o=(null==e?void 0:e.instructions)!=null?String(e.instructions):void 0,l=(null==e?void 0:e.feedback)&&"object"==typeof e.feedback?{correct:null!=e.feedback.correct?String(e.feedback.correct):void 0,incorrect:null!=e.feedback.incorrect?String(e.feedback.incorrect):void 0}:void 0;s&&a.length>=2&&n&&r.push({id:Number(null!=(i=null==e?void 0:e.id)?i:t+1),type:"fillBlank",title:c,instructions:o,sentence:s,choices:a,correctAnswer:n,feedback:l})}else if("matchingGame"===n||"matching"===n){let s=Array.isArray(null==e?void 0:e.pairs)?e.pairs.map(e=>({left:String((null==e?void 0:e.left)||"").trim(),right:String((null==e?void 0:e.right)||"").trim()})):[],i=(null==e?void 0:e.title)!=null?String(e.title):void 0,n=(null==e?void 0:e.instructions)!=null?String(e.instructions):void 0,c=(null==e?void 0:e.feedback)&&"object"==typeof e.feedback?{correct:null!=e.feedback.correct?String(e.feedback.correct):void 0,incorrect:null!=e.feedback.incorrect?String(e.feedback.incorrect):void 0}:void 0;s.length>=2&&r.push({id:Number(null!=(a=null==e?void 0:e.id)?a:t+1),type:"matchingGame",title:i,instructions:n,pairs:s,feedback:c})}}),r.slice(0,8)})(p.questions);if(e.length>0){A(e),em(),z(!0),X(!1);return}}z(!0),X(!0);try{let e=await fetch("/api/video/generate-questions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sectionId:ec,maxQuestions:8})});if(!e.ok)return void console.error("Failed to generate questions",await e.text());let r=await e.json();Array.isArray(null==r?void 0:r.questions)&&r.questions.length>0&&(A(r.questions),em())}catch(e){console.error("Error generating questions:",e)}finally{X(!1)}}}})}),M&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>V(!1)}),(0,s.jsx)("div",{className:"relative z-10 w-full max-w-xl rounded-lg bg-white p-6 shadow-xl dark:bg-zinc-900",children:Y||!W?(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)(u.k,{}),(0,s.jsx)("p",{className:"mt-3 text-sm text-gray-700 dark:text-gray-300",children:"G\xe9n\xe9ration de la r\xe9vision rapide…"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-4 text-sm text-gray-500",children:"R\xe9vision rapide"}),(0,s.jsx)("h3",{className:"mb-4 text-lg font-semibold",children:W.question}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-3",children:W.choices.map((e,r)=>{let t=E===e,i="idle"!==P&&e===W.correctAnswer,a="incorrect"===P&&t&&e!==W.correctAnswer,n="w-full rounded border px-4 py-3 text-left transition-colors",c=n+" border-gray-300 hover:bg-gray-50 dark:border-zinc-700 dark:hover:bg-zinc-800";return i&&(c=n+" border-emerald-600 bg-emerald-50 text-emerald-800 dark:border-emerald-500 dark:bg-emerald-900/30 dark:text-emerald-300"),a&&(c=n+" border-red-600 bg-red-50 text-red-800 dark:border-red-500 dark:bg-red-900/30 dark:text-red-300"),(0,s.jsxs)("button",{className:c,onClick:()=>{"idle"===P&&W&&(T(e),e===W.correctAnswer?(F("correct"),setTimeout(()=>{F("idle"),T(null),V(!1)},700)):(F("incorrect"),setTimeout(()=>{F("idle"),T(null)},800)))},disabled:"idle"!==P,children:[(0,s.jsx)("span",{className:"mr-2 inline-block h-2 w-2 rounded-full bg-current opacity-50"}),e]},r)})}),(0,s.jsx)("div",{className:"mt-6 flex items-center justify-end",children:(0,s.jsx)("button",{className:"rounded px-4 py-2 text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-zinc-800",onClick:()=>V(!1),children:"Skip"})})]})})]}),D&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-900/80 to-pink-900/80"}),(0,s.jsx)("div",{className:"relative z-10 w-full max-w-2xl",children:K||!C?(0,s.jsx)("div",{className:"kid-quiz-container",children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)(u.k,{}),(0,s.jsxs)("p",{className:"mt-3 text-lg font-semibold text-white",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83E\uDDE0"})," Pr\xe9paration de ton quiz amusant..."]})]})}):ei?(0,s.jsxs)("div",{className:"kid-quiz-container",children:[(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsx)("div",{className:"text-center",children:(()=>{let e=ed(),t=eu(e);return(0,s.jsxs)("div",{className:"kid-result-message ".concat(t.className),children:[(0,s.jsx)("div",{className:"kid-emoji bounce",style:{fontSize:"4rem",marginBottom:"1rem"},children:t.emoji}),(0,s.jsxs)("div",{className:"kid-score-display mb-6 justify-center",children:[(0,s.jsxs)("span",{children:["Score : ",e,"%"]}),(0,s.jsxs)("span",{children:["(",Z,"/",ee,")"]})]}),(0,s.jsx)("h3",{className:"mb-4 text-2xl font-bold",children:t.message}),(0,s.jsx)("div",{className:"mt-6 flex flex-col justify-center gap-4 sm:flex-row",children:e>=70?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{className:"kid-btn-secondary",onClick:async()=>{try{z(!1);let e=await (0,o.W9)(en);if(Array.isArray(e)&&e.length>0){let t=e.findIndex(e=>e.id===p.id),s=t>=0?e[t+1]:void 0;if(s)return void r.push("/my-learning/".concat(en,"/section/").concat(s.id))}r.push("/my-learning/".concat(en))}catch(e){console.error("Navigate to next section error:",e),r.push("/my-learning/".concat(en))}},children:[(0,s.jsx)("span",{className:"kid-emoji",children:"✨"})," Continuer \xe0 apprendre"]}),(0,s.jsxs)("button",{className:"kid-btn-primary",onClick:()=>r.push("/my-learning/".concat(en)),children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83C\uDFE0"})," Retour au cours"]}),(0,s.jsxs)("button",{className:"kid-btn-primary",onClick:async()=>{try{ea(!1),X(!0),em();let e=await fetch("/api/video/new-quiz",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sectionId:ec,maxQuestions:8,previous:Array.isArray(C)?C:void 0})});if(e.ok){let r=await e.json();Array.isArray(null==r?void 0:r.questions)&&r.questions.length>0?(A(r.questions),em()):console.error("No new questions returned")}else console.error("Failed to fetch new quiz",await e.text())}catch(e){console.error("Error regenerating quiz:",e)}finally{X(!1)}},children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83D\uDD01"})," Refaire le quiz"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{className:"kid-btn-primary",onClick:async()=>{try{ea(!1),X(!0),em();let e=await fetch("/api/video/new-quiz",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sectionId:ec,maxQuestions:8,previous:Array.isArray(C)?C:void 0})});if(e.ok){let r=await e.json();Array.isArray(null==r?void 0:r.questions)&&r.questions.length>0?(A(r.questions),em()):console.error("No new questions returned")}else console.error("Failed to fetch new quiz",await e.text())}catch(e){console.error("Error regenerating quiz:",e)}finally{X(!1)}},children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83D\uDD04"})," R\xe9essayer"]}),(0,s.jsxs)("button",{className:"kid-btn-secondary",onClick:()=>z(!1),children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83D\uDCDA"})," \xc9tudier plus"]})]})})]})})()})]}):O>=C.length?(()=>{if(!et){es(!0),ea(!0);let e=ed();ex(e,e>=70)}return null})():(0,s.jsxs)("div",{className:"kid-quiz-container",children:[(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,s.jsxs)("span",{className:"text-lg font-bold text-white",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83C\uDFAF"})," Question ",O+1," sur"," ",C.length]}),(0,s.jsxs)("div",{className:"kid-score-display",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"⭐"}),(0,s.jsxs)("span",{children:[Z,"/",ee]})]})]}),(0,s.jsx)("div",{className:"kid-progress-bar",children:(0,s.jsx)("div",{className:"kid-progress-fill",style:{width:"".concat((O+1)/C.length*100,"%")}})})]}),(0,s.jsx)("div",{className:"kid-question-card",children:(()=>{let e=C[O];if("flashcard"===e.type)return(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"mb-6 text-center text-2xl font-bold text-gray-800",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83E\uDD14"})," ",e.question]}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-4",children:e.choices.map((r,t)=>{let i=E===r,a="idle"!==P&&r===e.correctAnswer,n="incorrect"===P&&i&&r!==e.correctAnswer,c="kid-answer-btn";a&&(c+=" correct"),n&&(c+=" incorrect");let o=["\uD83C\uDD70️","\uD83C\uDD71️","\uD83C\uDD70️","\uD83C\uDD71️"];return(0,s.jsxs)("button",{className:c,onClick:()=>{"idle"===P&&(T(r),r===e.correctAnswer?(eo(),F("correct"),setTimeout(()=>{F("idle"),T(null),I(e=>e+1)},1200)):(el(),F("incorrect"),setTimeout(()=>{F("idle"),T(null),I(e=>e+1)},1200)))},disabled:"idle"!==P,children:[(0,s.jsx)("span",{className:"text-2xl",children:o[t%o.length]}),(0,s.jsx)("span",{className:"flex-1 text-left",children:r}),a&&(0,s.jsx)("span",{className:"text-2xl",children:"✅"}),n&&(0,s.jsx)("span",{className:"text-2xl",children:"❌"})]},t)})})]});if("fillBlank"===e.type){let r=String(e.sentence||"").replace("____","______");return(0,s.jsxs)("div",{children:[e.title&&(0,s.jsxs)("h3",{className:"mb-4 text-center text-2xl font-bold text-gray-800",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"✏️"})," ",e.title]}),e.instructions&&(0,s.jsx)("p",{className:"mb-4 text-center text-lg font-medium text-gray-700",children:e.instructions}),(0,s.jsx)("div",{className:"border-3 mb-6 rounded-2xl border-dashed border-blue-300 bg-gradient-to-r from-blue-50 to-purple-50 p-6",children:(0,s.jsxs)("p",{className:"text-center text-xl font-bold leading-relaxed text-gray-800",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83D\uDCDD"})," ",r]})}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3",children:e.choices.map((r,t)=>{let i=E===r,a="idle"!==P&&r===e.correctAnswer,n="incorrect"===P&&i&&r!==e.correctAnswer,c="kid-answer-btn text-center";return a&&(c+=" correct"),n&&(c+=" incorrect"),(0,s.jsxs)("button",{className:c,onClick:()=>{"idle"===P&&(T(r),r===e.correctAnswer?(eo(),F("correct"),setTimeout(()=>{F("idle"),T(null),I(e=>e+1)},1200)):(el(),F("incorrect"),setTimeout(()=>{F("idle"),T(null),I(e=>e+1)},1200)))},disabled:"idle"!==P,children:[(0,s.jsx)("span",{className:"font-bold",children:r}),a&&(0,s.jsx)("span",{className:"ml-2",children:"✅"}),n&&(0,s.jsx)("span",{className:"ml-2",children:"❌"})]},t)})}),"idle"!==P&&e.feedback&&(0,s.jsxs)("div",{className:"mt-6 rounded-xl p-4 text-center font-semibold ".concat("correct"===P?"border-2 border-green-300 bg-green-100 text-green-800":"border-2 border-orange-300 bg-orange-100 text-orange-800"),children:[(0,s.jsx)("span",{className:"kid-emoji",children:"correct"===P?"\uD83C\uDF89":"\uD83D\uDCAA"})," ","correct"===P?e.feedback.correct||"Fantastique !":e.feedback.incorrect||"Continue \xe0 essayer !"]})]})}if("matchingGame"===e.type){let r=e.pairs.map(e=>e.left),t=e.pairs.map(e=>e.right),i=R[O]||{},a=(e,r)=>{J(t=>({...t,[O]:{...t[O],[e]:r}}))};return(0,s.jsxs)("div",{children:[e.title&&(0,s.jsxs)("h3",{className:"mb-4 text-center text-2xl font-bold text-gray-800",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83D\uDD17"})," ",e.title]}),e.instructions&&(0,s.jsx)("p",{className:"mb-6 text-center text-lg font-medium text-gray-700",children:e.instructions}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:r.map((e,r)=>(0,s.jsxs)("div",{className:"border-3 rounded-2xl p-4 transition-all ".concat(Q[O]&&B[r]?"animate-wiggle border-red-400 bg-red-50":Q[O]&&i[r]&&!B[r]?"border-green-400 bg-green-50":i[r]?"border-blue-400 bg-blue-100":"border-blue-300 bg-blue-50"),children:[(0,s.jsxs)("div",{className:"mb-3 text-center text-lg font-bold text-gray-800",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83C\uDFAF"})," ",e]}),(0,s.jsxs)("select",{className:"w-full rounded-xl border-2 px-4 py-3 text-center text-lg font-semibold ".concat(Q[O]&&B[r]?"border-red-500 bg-red-100":Q[O]&&i[r]&&!B[r]?"border-green-500 bg-green-100":"border-blue-400 bg-white"),value:i[r]||"",onChange:e=>a(r,e.target.value),children:[(0,s.jsx)("option",{value:"",disabled:!0,children:"Choisir... \uD83E\uDD14"}),t.map((e,r)=>(0,s.jsx)("option",{value:e,children:e},r))]}),Q[O]&&B[r]&&(0,s.jsxs)("p",{className:"mt-2 text-center font-bold text-red-600",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"❌"})," R\xe9essaie !"]}),Q[O]&&i[r]&&!B[r]&&(0,s.jsxs)("p",{className:"mt-2 text-center font-bold text-green-600",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"✅"})," Excellent choix !"]})]},r))}),(0,s.jsx)("div",{className:"mt-8 text-center",children:(0,s.jsxs)("button",{className:"kid-btn-primary px-8 py-4 text-xl",onClick:()=>{let r={},t=0;e.pairs.forEach((e,s)=>{let a=i[s];a&&a===e.right?t++:r[s]=!0}),G(r);let s=Object.values(r).every(e=>!1===e);U(e=>({...e,[O]:!0})),s?(eo(),setTimeout(()=>{G({}),J(e=>({...e,[O]:{}})),U(e=>({...e,[O]:!1})),I(e=>e+1)},1500)):el()},disabled:Object.keys(i).length<r.length,children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83C\uDFAA"})," V\xe9rifier mes associations !"]})})]})}return null})()}),(0,s.jsx)("div",{className:"mt-6 text-center",children:(0,s.jsxs)("button",{className:"kid-btn-secondary opacity-75 hover:opacity-100",onClick:()=>z(!1),children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83D\uDEAA"})," Quitter le quiz"]})})]})})]}),_&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>q(!1)}),(0,s.jsx)("div",{className:"relative z-10 w-full max-w-xl rounded-lg bg-white p-6 shadow-xl dark:bg-zinc-900",children:K||!w||0===w.length?(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)(u.k,{}),(0,s.jsx)("p",{className:"mt-3 text-sm text-gray-700 dark:text-gray-300",children:"G\xe9n\xe9ration des questions flash…"})]}):O>=w.length?(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h3",{className:"mb-4 text-xl font-semibold",children:"Bravo! \uD83C\uDF89"}),(0,s.jsx)("p",{className:"mb-6 text-gray-600 dark:text-gray-300",children:"Tu as termin\xe9 toutes les questions flash."}),(0,s.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,s.jsx)("button",{className:"rounded bg-emerald-600 px-4 py-2 text-white hover:bg-emerald-700",onClick:()=>q(!1),children:"Close"}),(0,s.jsx)("button",{className:"rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",onClick:()=>r.push("/my-learning/".concat(en)),children:"Back to Course"})]})]}):(()=>{let e=w[O];return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"mb-4 text-sm text-gray-500",children:["Question ",O+1," of ",w.length]}),(0,s.jsx)("h3",{className:"mb-4 text-lg font-semibold",children:e.question}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-3",children:e.choices.map((r,t)=>{let i=E===r,a="idle"!==P&&r===e.correctAnswer,n="incorrect"===P&&i&&r!==e.correctAnswer,c="w-full rounded border px-4 py-3 text-left transition-colors",o=c+" border-gray-300 hover:bg-gray-50 dark:border-zinc-700 dark:hover:bg-zinc-800";return a&&(o=c+" border-emerald-600 bg-emerald-50 text-emerald-800 dark:border-emerald-500 dark:bg-emerald-900/30 dark:text-emerald-300"),n&&(o=c+" border-red-600 bg-red-50 text-red-800 dark:border-red-500 dark:bg-red-900/30 dark:text-red-300"),(0,s.jsxs)("button",{className:o,onClick:()=>{"idle"===P&&w&&(T(r),r===w[O].correctAnswer?(F("correct"),setTimeout(()=>{F("idle"),T(null),I(e=>e+1)},700)):(F("incorrect"),setTimeout(()=>{S(e=>{if(!e)return e;let r=e.slice(),[t]=r.splice(O,1);return r.push(t),r}),F("idle"),T(null)},800)))},disabled:"idle"!==P,children:[(0,s.jsx)("span",{className:"mr-2 inline-block h-2 w-2 rounded-full bg-current opacity-50"}),r]},t)})}),(0,s.jsx)("div",{className:"mt-6 flex items-center justify-end",children:(0,s.jsx)("button",{className:"rounded px-4 py-2 text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-zinc-800",onClick:()=>q(!1),children:"Exit"})})]})})()})]})]})}},5695:(e,r,t)=>{"use strict";var s=t(8999);t.o(s,"useParams")&&t.d(r,{useParams:function(){return s.useParams}}),t.o(s,"usePathname")&&t.d(r,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(r,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(r,{useSearchParams:function(){return s.useSearchParams}})},7667:(e,r,t)=>{"use strict";t.d(r,{k:()=>i});var s=t(5155);function i(e){let{size:r="medium",color:t="blue"}=e;return(0,s.jsx)("div",{className:"\n        ".concat({small:"h-4 w-4 border-2",medium:"h-8 w-8 border-2",large:"h-12 w-12 border-3"}[r],"\n        ").concat({blue:"border-blue-200 border-t-blue-600",white:"border-gray-200/30 border-t-white"}[t],"\n        animate-spin rounded-full border-solid\n      "),role:"status","aria-label":"Chargement",children:(0,s.jsx)("span",{className:"sr-only",children:"Chargement..."})})}},9498:(e,r,t)=>{Promise.resolve().then(t.bind(t,1473))}},e=>{var r=r=>e(e.s=r);e.O(0,[5647,9535,9494,2446,8441,1684,7358],()=>r(9498)),_N_E=e.O()}]);