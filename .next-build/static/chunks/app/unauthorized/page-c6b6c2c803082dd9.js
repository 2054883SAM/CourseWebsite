(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4305],{20:(e,t,s)=>{"use strict";s.d(t,{As:()=>c,OJ:()=>a,cy:()=>i});var r=s(5155),n=s(2115),o=s(6414);let i=(0,n.createContext)(null);function a(e){let{children:t}=e,[s,a]=(0,n.useState)(null),[c,l]=(0,n.useState)(null),[u,h]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=(()=>{let e="https://qrowzznnnarfogfbnnow.supabase.co";if(!e)return"default";let t=e.match(/https:\/\/([a-z0-9-]+)\.supabase\.co/);return t?t[1]:"default"})();console.log("Auth cookies at startup:",document.cookie.split(";").map(e=>e.trim()).filter(e=>e.startsWith("sb-")||e.includes("supabase"))),console.log("Looking for cookie format:","sb-".concat(e,"-auth-token")),o.N.auth.getUser().then(e=>{let{data:{user:t},error:s}=e;s&&console.error("Error getting initial user:",s),console.log("Initial auth user:",t?"Present":"None",t?"(User: ".concat(t.email,")"):""),a(null!=t?t:null),t?d(t.id):h(!1)});let{data:{subscription:t}}=o.N.auth.onAuthStateChange(async(e,t)=>{var s;if(console.log("Auth state change event:",e),console.log("Session after event:",t?"Present":"None"),a(null!=(s=null==t?void 0:t.user)?s:null),null==t?void 0:t.user){if("SIGNED_IN"===e||"TOKEN_REFRESHED"===e)try{await fetch("/api/auth/cookie",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:t.access_token,refresh_token:t.refresh_token}),credentials:"include"})}catch(e){console.warn("Failed to sync auth cookies on state change:",e)}d(t.user.id)}else l(null),h(!1)});return()=>{t.unsubscribe()}},[]);let d=async e=>{try{let{data:t,error:s}=await o.N.from("users").select("*").eq("id",e).single();if(s)throw s;l(t)}catch(e){console.error("Error fetching user data:",e),l(null)}finally{h(!1)}},m=async(e,t)=>{try{console.log("Attempting sign in for:",e),await o.N.auth.signOut();let{data:s,error:r}=await o.N.auth.signInWithPassword({email:e,password:t});return s.session&&await fetch("/api/auth/cookie",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:s.session.access_token,refresh_token:s.session.refresh_token}),credentials:"include"}),{error:r}}catch(e){return console.error("Unexpected error during sign in:",e),{error:e}}},g=async()=>{try{await o.N.auth.signOut(),console.log("Sign out completed. Session cleared.")}catch(e){console.error("Error signing out:",e)}},p=async(e,t,s)=>{try{console.log("Attempting sign up for:",e);let{data:n,error:i}=await o.N.auth.signUp({email:e,password:t,options:{data:{name:s},emailRedirectTo:"".concat(window.location.origin,"/signin")}});if(i)throw i;let a={success:!i,user:n.user?"".concat(n.user.email):"Missing",session:n.session?"Present":"Missing (email confirmation may be required)"};console.log("Sign up response:",a);let c=!n.session;if(n.user){var r;return{error:null,requiresEmailConfirmation:c,email:null!=(r=n.user.email)?r:e}}throw Error("Signup failed. Please try again.")}catch(e){return console.error("Error during sign up:",e),{error:e,requiresEmailConfirmation:!1}}},f=async e=>{try{let{error:t}=await o.N.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});if(t)return{error:t};return{error:null}}catch(e){return console.error("Error sending password reset email:",e),{error:e}}},b=async(e,t)=>{try{let{data:s,error:r}=await o.N.auth.signInWithOAuth({provider:e,options:{redirectTo:null!=t?t:"".concat(window.location.origin,"/"),queryParams:{prompt:"select_account"}}});if(r)throw r;return{error:null}}catch(e){return console.error("OAuth sign-in error:",e),{error:e}}};return(0,r.jsx)(i.Provider,{value:{user:s,dbUser:c,loading:u,signIn:m,signOut:g,signUp:p,signInWithProvider:b,resetPassword:f,checkPermission:e=>{let t=null==c?void 0:c.role;return!!t&&("admin"===e?"admin"===t:"teacher"===e?"admin"===t||"teacher"===t:"student"===e)}},children:t})}function c(){let e=(0,n.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},2108:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var r=s(5155),n=s(2115),o=s(5695),i=s(6874),a=s.n(i),c=s(20);let l={admin:"This page requires administrator privileges.",teacher:"This page is only accessible to teachers and administrators.",student:"This page requires a valid student account."},u={teacher:"Please contact an administrator to request teacher privileges.",admin:"Administrator access is restricted. Please contact support if you believe this is an error.",student:"Please sign in or create an account to access this content."};function h(){let{user:e}=(0,c.As)(),t=(0,o.useSearchParams)().get("requiredRole");return(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center px-4 py-12 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"w-full max-w-md space-y-8 text-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"mt-6 text-3xl font-bold tracking-tight text-gray-900 dark:text-white",children:"Access Denied"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"mb-4",children:l[t]||"You do not have permission to access this page."}),(0,r.jsx)("p",{children:u[t]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"mb-4",children:"Please sign in to access this page."}),(0,r.jsx)("p",{children:"Don't have an account? You can sign up for free."})]})})]}),(0,r.jsx)("div",{className:"mt-8 space-y-4",children:e?(0,r.jsx)(a(),{href:"/",className:"block w-full rounded-md bg-primary-600 px-4 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-primary-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600",children:"Return Home"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a(),{href:"/signin",className:"block w-full rounded-md bg-primary-600 px-4 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-primary-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600",children:"Sign In"}),(0,r.jsx)(a(),{href:"/signup",className:"block w-full rounded-md border border-gray-300 bg-white px-4 py-2 text-center text-sm font-semibold text-gray-900 shadow-sm hover:bg-gray-50",children:"Create Account"})]})})]})})}function d(){return(0,r.jsx)(n.Suspense,{fallback:(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center px-4 py-12 sm:px-6 lg:px-8",children:"Chargementâ€¦"}),children:(0,r.jsx)(h,{})})}},4552:(e,t,s)=>{Promise.resolve().then(s.bind(s,2108))},5695:(e,t,s)=>{"use strict";var r=s(8999);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},6414:(e,t,s)=>{"use strict";s.d(t,{N:()=>c});var r=s(5647);let n="https://qrowzznnnarfogfbnnow.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI";if(!n)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_URL");if(!o)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_ANON_KEY");let i=(()=>{if(!n)return"default";let e=n.match(/https:\/\/([a-z0-9-]+)\.supabase\.co/);return e?e[1]:"default"})();console.log("Supabase project ref for cookies:",i);let a={auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storageKey:"sb-".concat(i,"-auth-token"),cookieOptions:{name:"sb-".concat(i,"-auth-token"),path:"/",sameSite:"Lax",secure:!0,maxAge:604800}}};console.log("Supabase client initialized with cookie config:",{cookieName:a.auth.cookieOptions.name,cookiePath:a.auth.cookieOptions.path,detectSessionInUrl:a.auth.detectSessionInUrl,persistSession:a.auth.persistSession});let c=(0,r.UU)(n,o,a);c.auth.getUser().then(()=>{}),c.auth.onAuthStateChange((e,t)=>{console.log("Supabase auth event:",e)}),window.addEventListener("focus",()=>{c.auth.refreshSession().catch(e=>{console.error("Error refreshing Supabase session on focus:",e)})})}},e=>{var t=t=>e(e.s=t);e.O(0,[5647,6874,8441,1684,7358],()=>t(4552)),_N_E=e.O()}]);