(()=>{var e={};e.id=2962,e.ids=[2962],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},28086:(e,t,r)=>{"use strict";r.d(t,{t:()=>a});var s=r(34386),n=r(44999);async function a(){let e=await (0,n.UL)();return(0,s.createServerClient)("https://qrowzznnnarfogfbnnow.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:s})=>e.set(t,r,s))}catch{}}}})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32828:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>h,serverHooks:()=>m,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{OPTIONS:()=>f,POST:()=>d});var n=r(96559),a=r(48088),o=r(37719),i=r(32190),u=r(28086);function p(e){switch(e){case"en":default:return"EN";case"fr":return"FR";case"es":return"ES"}}async function l(e,t,r){let s=process.env.DEEPL_API_KEY;if(!s)throw Error("DEEPL_API_KEY environment variable is not set");if(!Array.isArray(e)||0===e.length)return[];let n=process.env.DEEPL_API_URL||"https://api-free.deepl.com",a=`${n}/v2/translate`,o=new URLSearchParams;for(let s of(o.append("source_lang",p(t)),o.append("target_lang",p(r)),o.append("preserve_formatting","1"),o.append("split_sentences","nonewlines"),e))o.append("text",s);let i=await fetch(a,{method:"POST",headers:{Authorization:`DeepL-Auth-Key ${s}`,"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()});if(!i.ok){let e=await i.text();throw Error(`DeepL request failed: ${i.status} ${e}`)}let u=await i.json(),l=Array.isArray(u?.translations)?u.translations.map(e=>String(e.text??"")):[];if(l.length!==e.length){let t=Array(e.length).fill("");for(let e=0;e<Math.min(t.length,l.length);e++)t[e]=l[e];return t}return l}async function c(e,t,r){let s=e.split(/\r?\n/),n=e=>/-->/.test(e),a=e=>e.startsWith("WEBVTT")||e.startsWith("NOTE")||e.startsWith("STYLE")||e.startsWith("REGION"),o=[],i=[];for(let e=0;e<s.length;e++){let t=s[e];!(0===t.trim().length||a(t)||n(t))&&(/^\d+$/.test(t.trim())||(o.push(e),i.push(t)))}if(0===i.length)return e;let u=await l(i,t,r),p=[...s];return o.forEach((e,t)=>{p[e]=u[t]??s[e]}),p.join("\n")}async function d(e){try{let{courseId:t,sectionId:r,videoId:s,sourceLanguage:n}=await e.json();if(!t||!s||!n)return i.NextResponse.json({error:"Missing courseId, videoId or sourceLanguage"},{status:400});let a=process.env.VDO_API_SECRET;if(!a)return i.NextResponse.json({error:"VDO_API_SECRET not configured"},{status:500});let o=await (0,u.t)(),p=r?`${r}/captions.vtt`:void 0;if(!p)return i.NextResponse.json({error:"Missing sectionId for captions lookup"},{status:400});let{data:l,error:d}=await o.storage.from("translations").download(p);if(d||!l)return i.NextResponse.json({error:`Unable to download original captions: ${d?.message||"unknown"}`},{status:404});let f=await l.text(),h=function(e){let t=String(e||"").toLowerCase();return"english"===t||t.startsWith("en")?"en":"french"===t||"fran\xe7ais"===t||"francais"===t||t.startsWith("fr")?"fr":"spanish"===t||"espa\xf1ol"===t||"espanol"===t||t.startsWith("es")?"es":"en"}(n),x=["fr","en","es"].filter(e=>e!==h),g={};for(let e of x){let t=await c(f,h,e);g[e]=t}let m=[];for(let e of x){let t=new FormData,r=new File([g[e]],"captions.vtt",{type:"text/vtt"});t.append("file",r);let n=`https://dev.vdocipher.com/api/videos/${encodeURIComponent(s)}/files?language=${encodeURIComponent(e)}`,o=await fetch(n,{method:"POST",headers:{Authorization:`Apisecret ${a}`},body:t});if(!o.ok){let t=await o.text();return i.NextResponse.json({error:`VdoCipher upload failed for ${e}: ${o.status} ${t}`},{status:502})}let u=await o.json();m.push({lang:e,data:u})}return i.NextResponse.json({success:!0,uploaded:m},{status:200})}catch(e){return console.error("[Translate and Upload] Unexpected error",e),i.NextResponse.json({error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function f(){return i.NextResponse.json({},{status:200})}let h=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/upload-video/translate-and-upload/route",pathname:"/api/upload-video/translate-and-upload",filename:"route",bundlePath:"app/api/upload-video/translate-and-upload/route"},resolvedPagePath:"C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\api\\upload-video\\translate-and-upload\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:g,serverHooks:m}=h;function w(){return(0,o.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:g})}},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,6570,645,4386,4999],()=>r(32828));module.exports=s})();