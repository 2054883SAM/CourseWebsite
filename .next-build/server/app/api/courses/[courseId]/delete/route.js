(()=>{var e={};e.id=6443,e.ids=[6443],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},28086:(e,r,t)=>{"use strict";t.d(r,{t:()=>i});var s=t(34386),o=t(44999);async function i(){let e=await (0,o.UL)();return(0,s.createServerClient)("https://qrowzznnnarfogfbnnow.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI",{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:t,options:s})=>e.set(r,t,s))}catch{}}}})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},90216:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>x,routeModule:()=>p,serverHooks:()=>m,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>d});var s={};t.r(s),t.d(s,{DELETE:()=>c});var o=t(96559),i=t(48088),a=t(37719),n=t(32190),u=t(28086);async function c(e){try{let r=await (0,u.t)(),t=await e.json().catch(()=>null),s=t?.courseId;if(!s)return n.NextResponse.json({error:"Missing courseId"},{status:400});let{data:{user:o},error:i}=await r.auth.getUser();if(i||!o)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{data:a,error:c}=await r.from("users").select("role").eq("id",o.id).single();if(c||!a||"admin"!==a.role)return n.NextResponse.json({error:"Forbidden"},{status:403});let{data:p,error:l}=await r.from("courses").select("id, playback_id, thumbnail_url").eq("id",s).single();if(l||!p)return n.NextResponse.json({error:"Course not found"},{status:404});if(p.playback_id){let e=process.env.VDO_API_SECRET;if(!e)return n.NextResponse.json({error:"Server misconfiguration: VDO_API_SECRET not set"},{status:500});try{console.log("Deleting VdoCipher video",p.playback_id);let r=new URL("https://dev.vdocipher.com/api/videos");r.searchParams.set("videos",p.playback_id);let t=await fetch(r.toString(),{method:"DELETE",headers:{Authorization:`Apisecret ${e}`,Accept:"application/json","Content-Type":"application/json"}});if(!t.ok&&404!==t.status){let e=await t.text().catch(()=>"");return n.NextResponse.json({error:`VdoCipher delete failed: ${t.status} ${e}`},{status:502})}}catch(e){return n.NextResponse.json({error:"Failed to contact VdoCipher API"},{status:502})}}if(p.thumbnail_url)try{let e=new URL(p.thumbnail_url),t="/storage/v1/object/public/course-thumbnails/",s=e.pathname.indexOf(t);if(-1!==s){let o=e.pathname.substring(s+t.length);if(o){let{error:e}=await r.storage.from("course-thumbnails").remove([o]);if(e)return n.NextResponse.json({error:`Failed to delete thumbnail: ${e.message}`},{status:500})}}}catch{}{let e=`${s}/captions.vtt`,{error:t}=await r.storage.from("translations").remove([e]);if(t)return n.NextResponse.json({error:`Failed to delete captions: ${t.message}`},{status:500})}let{error:d}=await r.from("courses").delete().eq("id",s);if(d)return n.NextResponse.json({error:`Failed to delete course: ${d.message}`},{status:500});return n.NextResponse.json({success:!0})}catch(e){return console.error("Delete course unexpected error:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/courses/[courseId]/delete/route",pathname:"/api/courses/[courseId]/delete",filename:"route",bundlePath:"app/api/courses/[courseId]/delete/route"},resolvedPagePath:"C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\api\\courses\\[courseId]\\delete\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:l,workUnitAsyncStorage:d,serverHooks:m}=p;function x(){return(0,a.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:d})}},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,580,6570,645,4386,4999],()=>t(90216));module.exports=s})();