(()=>{var e={};e.id=5693,e.ids=[5693],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3550:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>m,routeModule:()=>p,serverHooks:()=>x,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{POST:()=>d});var o=t(96559),i=t(48088),n=t(37719),a=t(32190),u=t(28086);async function c(e,r,t){let{data:s,error:o}=await t.from("enrollments").select("id").eq("user_id",e).eq("course_id",r).eq("status","active").single();if(o&&"PGRST116"!==o.code)throw Error(`Error checking enrollment: ${o.message}`);return!!s}async function l(e,r){let{data:t,error:s}=await r.from("courses").select(`
      id, 
      title, 
      description, 
      thumbnail_url, 
      creator_id,
      created_at,
      creator:creator_id (
        id,
        name,
        email,
        role,
        created_at
      )
    `).eq("id",e).single();if(s)throw Error(`Error fetching course: ${s.message}`);if(!t)throw Error("Course not found");return t}async function d(e,r){try{let{courseId:t}=await r.params;console.log("API: Processing checkout for courseId:",t);let s=await (0,u.t)();try{console.log("API: Request headers:",{cookie:e.headers.has("cookie")?"Present":"Missing",authorization:e.headers.has("authorization")?"Present":"Missing"});let{data:{user:r},error:o}=await s.auth.getUser();if(o)return console.error("API: Authentication error:",o),a.NextResponse.json({error:"Authentication error: "+o.message,authRequired:!0},{status:401});if(!r)return console.error("API: No active session found"),a.NextResponse.json({error:"Authentication required. Please sign in.",authRequired:!0},{status:401});let i=r.id;console.log("API: Authenticated user ID:",i);let{data:n,error:u}=await s.from("users").select("role").eq("id",i).single();if(u)return console.error("API: Error fetching user data:",u),a.NextResponse.json({error:"Error fetching user data"},{status:500});let d=n?.role;if(console.log("API: User role:",d),!d||"student"!==d&&"teacher"!==d&&"admin"!==d)return a.NextResponse.json({error:"Your account does not have permission to enroll in courses"},{status:403});if(await c(i,t,s))return a.NextResponse.json({error:"You are already enrolled in this course",alreadyEnrolled:!0},{status:409});return await l(t,s),Date.now(),a.NextResponse.json({success:!0})}catch(e){if(console.error("Authentication error:",e),e.message?.includes("Session expired")||e.message?.includes("sign in again"))return a.NextResponse.json({error:"Your session has expired. Please sign in again.",sessionExpired:!0},{status:401});return a.NextResponse.json({error:"Authentication required. Please sign in.",authRequired:!0},{status:401})}}catch(e){return console.error("Checkout error:",e),a.NextResponse.json({error:e.message||"Error creating checkout session"},{status:500})}finally{}}let p=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/checkout/[courseId]/route",pathname:"/api/checkout/[courseId]",filename:"route",bundlePath:"app/api/checkout/[courseId]/route"},resolvedPagePath:"C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\api\\checkout\\[courseId]\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:g,serverHooks:x}=p;function m(){return(0,n.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:g})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},28086:(e,r,t)=>{"use strict";t.d(r,{t:()=>i});var s=t(34386),o=t(44999);async function i(){let e=await (0,o.UL)();return(0,s.createServerClient)("https://qrowzznnnarfogfbnnow.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI",{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:t,options:s})=>e.set(r,t,s))}catch{}}}})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,580,6570,645,4386,4999],()=>t(3550));module.exports=s})();