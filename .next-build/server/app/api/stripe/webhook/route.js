(()=>{var e={};e.id=3287,e.ids=[3287],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},18435:(e,t,r)=>{"use strict";r.d(t,{D:()=>i,y:()=>a});var s=r(97877);let o=null;function a(){if(!process.env.STRIPE_SECRET_KEY)throw Error("STRIPE_SECRET_KEY is not set");return o||(o=new s.A(process.env.STRIPE_SECRET_KEY)),o}function i(){let e=process.env.STRIPE_WEBHOOK_SECRET;if(!e)throw Error("STRIPE_WEBHOOK_SECRET is not set");return e}},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79646:e=>{"use strict";e.exports=require("child_process")},81630:e=>{"use strict";e.exports=require("http")},89690:(e,t,r)=>{"use strict";async function s(e,t){let r="https://qrowzznnnarfogfbnnow.supabase.co",s=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!r)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL");if(!s)throw Error("Missing SUPABASE_SERVICE_ROLE_KEY");let o=`${r}/rest/v1/users?id=eq.${e}`,a=await fetch(o,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${s}`,apikey:s,Prefer:"return=representation"},body:JSON.stringify({membership:t})});if(!a.ok){let e=await a.text();throw Error(`Failed updating membership: ${a.status} ${e}`)}return a.json()}r.d(t,{I:()=>s})},91824:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>E,serverHooks:()=>f,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{OPTIONS:()=>l,POST:()=>d});var o=r(96559),a=r(48088),i=r(37719),n=r(32190),u=r(18435),p=r(89690);async function c(e,t){return(0,p.I)(e,t)}async function d(e){try{let t,r=(0,u.y)(),s=e.headers.get("stripe-signature");if(!s)return n.NextResponse.json({error:"Missing signature"},{status:400});let o=await e.text(),a=(0,u.D)();try{t=r.webhooks.constructEvent(o,s,a)}catch(e){return console.error("Webhook signature verification failed:",e?.message),n.NextResponse.json({error:"Invalid signature"},{status:400})}if("checkout.session.completed"===t.type){let e=t.data.object,r=e.metadata&&e.metadata.userId||null;r&&await c(r,"subscribed")}if("customer.subscription.updated"===t.type||"customer.subscription.created"===t.type){let e=t.data.object,r=e.metadata&&e.metadata.userId||null;r&&(("active"===e.status||"trialing"===e.status)&&await c(r,"subscribed"),("canceled"===e.status||"unpaid"===e.status||"incomplete_expired"===e.status||"past_due"===e.status)&&"canceled"===e.status&&await c(r,"free"))}if("customer.subscription.deleted"===t.type){let e=t.data.object,r=e.metadata&&e.metadata.userId||null;r&&await c(r,"free")}return n.NextResponse.json({received:!0})}catch(e){return console.error("Stripe webhook error:",e),n.NextResponse.json({error:e?.message||"Internal error"},{status:500})}}async function l(){return n.NextResponse.json({},{status:200})}let E=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/stripe/webhook/route",pathname:"/api/stripe/webhook",filename:"route",bundlePath:"app/api/stripe/webhook/route"},resolvedPagePath:"C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\api\\stripe\\webhook\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:x,serverHooks:f}=E;function w(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:x})}},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,7877],()=>r(91824));module.exports=s})();