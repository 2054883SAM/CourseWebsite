(()=>{var e={};e.id=8514,e.ids=[8514],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},28086:(e,r,t)=>{"use strict";t.d(r,{t:()=>i});var s=t(34386),n=t(44999);async function i(){let e=await (0,n.UL)();return(0,s.createServerClient)("https://qrowzznnnarfogfbnnow.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI",{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:t,options:s})=>e.set(r,t,s))}catch{}}}})}},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},37830:e=>{"use strict";e.exports=require("node:stream/web")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57075:e=>{"use strict";e.exports=require("node:stream")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{"use strict";e.exports=require("node:fs")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{},98880:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>m,routeModule:()=>d,serverHooks:()=>h,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{OPTIONS:()=>p,POST:()=>l});var n=t(96559),i=t(48088),o=t(37719),a=t(32190),c=t(37647),u=t(28086);async function l(e){try{let r,t=process.env.OPENAI_API_KEY;if(!t)return a.NextResponse.json({error:"Missing OPENAI_API_KEY"},{status:500});let s=await e.json().catch(()=>null),n=s?.sectionId,i=Math.min(8,Math.max(1,Number(s?.maxQuestions??8))),o=Array.isArray(s?.previous)?s?.previous:[];if(!n)return a.NextResponse.json({error:"Missing sectionId"},{status:400});let l=await (0,u.t)(),p=String(n),d=`${p}/captions.vtt`,{data:g,error:f}=await l.storage.from("translations").download(d);if(f||!g)return a.NextResponse.json({error:`Unable to download captions: ${f?.message||"not found"}`},{status:404});let h=await g.text();if(!h||0===h.trim().length)return a.NextResponse.json({error:"Empty captions"},{status:422});let m=new c.Ay({apiKey:t}),y=o.slice(0,12).map(e=>"flashcard"===e.type?{type:"flashcard",question:e.question,choices:e.choices,correctAnswer:e.correctAnswer}:"fillBlank"===e.type?{type:"fillBlank",title:e.title,sentence:e.sentence,choices:e.choices,correctAnswer:e.correctAnswer}:"matchingGame"===e.type||"matching"===e.type?{type:"matchingGame",title:e.title,pairs:e.pairs}:null).filter(Boolean),x=[`Create up to ${i} NEW, different questions (flashcard, fillBlank, matchingGame) from this WebVTT transcript.`,"Avoid duplicating or paraphrasing the following previous questions (and their ideas):",JSON.stringify(y,null,2),"Output ONLY the JSON array described above.",h.length>12e4?h.slice(0,12e4):h].join("\n"),v=await m.chat.completions.create({model:process.env.OPENAI_MODEL_ID||"gpt-4o-mini",temperature:.6,messages:[{role:"system",content:'You generate a VARIED set of kid-friendly learning questions (ages 7–11) from a WebVTT transcript.\nReturn ONLY a valid JSON array of up to N items. No prose, no code fences.\nAllowed types and strict shapes:\n- flashcard: { "id": number, "type": "flashcard", "question": string, "choices": string[3-6], "correctAnswer": string }\n- fillBlank: { "id": number, "type": "fillBlank", "title"?: string, "instructions"?: string, "sentence": string (contains exactly one "____"), "choices": string[3-6], "correctAnswer": string, "feedback"?: { "correct"?: string, "incorrect"?: string } }\n- matchingGame: { "id": number, "type": "matchingGame", "title"?: string, "instructions"?: string, "pairs": Array<{"left": string, "right": string}> (3-8), "feedback"?: { "correct"?: string, "incorrect"?: string } }\nRules:\n- Use the same language as the transcript.\n- Keep wording simple, friendly, and sensory-friendly (Grade 2–5).\n- Each item should test a single clear idea from the transcript.\n- Mix the three types to keep engagement high; avoid duplicates.\n- Ensure every flashcard has exactly one correct answer present in choices.\n- For fillBlank, sentence MUST include exactly one ____ and correctAnswer MUST be one of choices.\n- For matchingGame, provide meaningful left/right pairs based on transcript facts.\n- IMPORTANT: Avoid repeating or paraphrasing any of the provided previous questions, answers, or exact facts; generate new coverage or different angles.'},{role:"user",content:x}]}),w=v.choices?.[0]?.message?.content?.trim()||"";try{r=JSON.parse(w)}catch(e){return a.NextResponse.json({error:"Invalid JSON from model",raw:w},{status:502})}if(!Array.isArray(r))return a.NextResponse.json({error:"Model did not return an array",raw:w},{status:502});let b=new Set(["flashcard","fillBlank","matchingGame"]),q=r.map((e,r)=>{let t=Number(e?.id??r+1),s=String(e?.type||"").trim();if(!t||t<=0)return null;if("flashcard"===s){let r=String(e?.question||"").trim(),s=Array.isArray(e?.choices)?e.choices.map(e=>String(e)).slice(0,6):[],n=String(e?.correctAnswer||"").trim();return r&&!(s.length<3)&&n&&s.includes(n)?{id:t,type:"flashcard",question:r,choices:s,correctAnswer:n}:null}if("fillBlank"===s){let r=e?.title!=null?String(e.title):void 0,s=e?.instructions!=null?String(e.instructions):void 0,n=String(e?.sentence||"").trim(),i=Array.isArray(e?.choices)?e.choices.map(e=>String(e)).slice(0,6):[],o=String(e?.correctAnswer||e?.correct_answer||"").trim(),a=e?.feedback&&"object"==typeof e.feedback?{correct:null!=e.feedback.correct?String(e.feedback.correct):void 0,incorrect:null!=e.feedback.incorrect?String(e.feedback.incorrect):void 0}:void 0,c=(n.match(/____/g)||[]).length;return n&&1===c&&!(i.length<3)&&o&&i.includes(o)?{id:t,type:"fillBlank",title:r,instructions:s,sentence:n,choices:i,correctAnswer:o,feedback:a}:null}if("matchingGame"===s||!b.has(s)&&"matching"===s){let r=e?.title!=null?String(e.title):void 0,s=e?.instructions!=null?String(e.instructions):void 0,n=(Array.isArray(e?.pairs)?e.pairs:[]).map(e=>({left:String(e?.left||"").trim(),right:String(e?.right||"").trim()})).filter(e=>e.left&&e.right).slice(0,8),i=e?.feedback&&"object"==typeof e.feedback?{correct:null!=e.feedback.correct?String(e.feedback.correct):void 0,incorrect:null!=e.feedback.incorrect?String(e.feedback.incorrect):void 0}:void 0;return n.length<3?null:{id:t,type:"matchingGame",title:r,instructions:s,pairs:n,feedback:i}}return null}).filter(e=>null!==e).slice(0,i);if(0===q.length)return a.NextResponse.json({error:"No valid questions parsed",raw:w},{status:502});return a.NextResponse.json({questions:q},{status:200})}catch(e){return console.error("[new-quiz] Error:",e),a.NextResponse.json({error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function p(){return a.NextResponse.json({},{status:200})}let d=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/video/new-quiz/route",pathname:"/api/video/new-quiz",filename:"route",bundlePath:"app/api/video/new-quiz/route"},resolvedPagePath:"C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\api\\video\\new-quiz\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:g,workUnitAsyncStorage:f,serverHooks:h}=d;function m(){return(0,o.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:f})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,580,6570,645,4386,4999,7294,7647],()=>t(98880));module.exports=s})();