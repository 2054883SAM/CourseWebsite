(()=>{var e={};e.id=1140,e.ids=[1140],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3503:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>l,serverHooks:()=>g,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{OPTIONS:()=>d,POST:()=>p});var n=r(96559),o=r(48088),i=r(37719),a=r(32190),c=r(37647),u=r(28086);async function p(e){try{let t,r=process.env.OPENAI_API_KEY;if(!r)return a.NextResponse.json({error:"Missing OPENAI_API_KEY"},{status:500});let s=await e.json().catch(()=>null),n=s?.courseId,o=s?.sectionId,i="number"==typeof s?.startTime?s.startTime:void 0,p="number"==typeof s?.duration?s.duration:void 0;if(!n||!o||void 0===i)return a.NextResponse.json({error:"Missing courseId, sectionId, or startTime"},{status:400});let d=await (0,u.t)(),l=String(o),m=`${l}/captions.vtt`;console.log("Path : ",m);let{data:h,error:g}=await d.storage.from("translations").download(m);if(g||!h)return a.NextResponse.json({error:`Unable to download captions: ${g?.message||"not found"}`},{status:404});let x=await h.text();if(!x||0===x.trim().length)return a.NextResponse.json({error:"captions.vtt is empty"},{status:422});let f=p&&p>0?i+p:void 0,y=/(\d{2}):(\d{2}):(\d{2})\.(\d{3})\s+-->\s+(\d{2}):(\d{2}):(\d{2})\.(\d{3})/,v=(e,t,r,s)=>3600*Number(e)+60*Number(t)+Number(r)+Number(s)/1e3,N=x.split(/\r?\n/),b=0,w=[];for(;b<N.length;){let e=N[b],t=y.exec(e);if(!t){b++;continue}let r=v(t[1],t[2],t[3],t[4]),s=v(t[5],t[6],t[7],t[8]),n=void 0===f?s>i:r<f&&s>i,o=[];for(b++;b<N.length&&""!==N[b].trim();)o.push(N[b]),b++;for(;b<N.length&&""===N[b].trim();)b++;n&&o.length>0&&w.push(o.join("\n"))}let q=w.join("\n").trim();if(!q)return a.NextResponse.json({error:"No captions found for the specified window"},{status:422});let I=new c.Ay({apiKey:r}),j=["Create ONE flashcard from this transcript segment. Output ONLY the JSON object described.",q.length>2e4?q.slice(0,2e4):q].join("\n"),O=await I.chat.completions.create({model:process.env.OPENAI_MODEL_ID||"gpt-4o-mini",temperature:.3,messages:[{role:"system",content:'You generate a single educational multiple-choice flashcard from a short transcript segment (WebVTT text lines).\nAudience: children in elementary school (approximately ages 7–11).\nAccessibility: Make content engaging and inclusive for neurodivergent learners.\nReturn ONLY a valid JSON object, no code fences or prose.\nObject shape: { "id": number, "question": string, "choices": string[], "correctAnswer": string }\nRules:\n- Use the same language as the transcript segment.\n- Base the question on a key fact or concept present in the segment.\n- Reading level: Grade 2–5. Short sentences and simple words.\n- Be friendly and encouraging; avoid sarcasm, idioms, and metaphors.\n- Choices should be plausible (3–5 options) with exactly one correct answer.\n- Sensory-friendly wording.\n- Do not include explanations, metadata, or commentary.'},{role:"user",content:j}]}),A=O.choices?.[0]?.message?.content?.trim()||"";try{t=JSON.parse(A)}catch(r){let e=A.match(/\{[\s\S]*\}/);if(e)try{t=JSON.parse(e[0])}catch{}}let S=((e,t=1)=>{let r=Number(e?.id??t),s=String(e?.question||"").trim(),n=Array.isArray(e?.choices)?e.choices.map(e=>String(e)).slice(0,6):[],o=String(e?.correctAnswer||"").trim();return r&&s&&!(n.length<3)&&o&&n.includes(o)?{id:r,question:s,choices:n,correctAnswer:o}:null})(t);if(!S)return a.NextResponse.json({error:"Model did not return a valid flashcard",raw:A},{status:502});return a.NextResponse.json({flashcard:S},{status:200})}catch(e){return console.error("[generate-chapter-flashcard] Error:",e),a.NextResponse.json({error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function d(){return a.NextResponse.json({},{status:200})}let l=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/video/generate-chapter-flashcard/route",pathname:"/api/video/generate-chapter-flashcard",filename:"route",bundlePath:"app/api/video/generate-chapter-flashcard/route"},resolvedPagePath:"C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\api\\video\\generate-chapter-flashcard\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:h,serverHooks:g}=l;function x(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:h})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},28086:(e,t,r)=>{"use strict";r.d(t,{t:()=>o});var s=r(34386),n=r(44999);async function o(){let e=await (0,n.UL)();return(0,s.createServerClient)("https://qrowzznnnarfogfbnnow.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:s})=>e.set(t,r,s))}catch{}}}})}},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},37830:e=>{"use strict";e.exports=require("node:stream/web")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57075:e=>{"use strict";e.exports=require("node:stream")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{"use strict";e.exports=require("node:fs")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,6570,645,4386,4999,7294,7647],()=>r(3503));module.exports=s})();