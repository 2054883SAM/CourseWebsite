(()=>{var e={};e.id=4307,e.ids=[4307],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},23597:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>x,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{OPTIONS:()=>l,POST:()=>p});var n=t(96559),i=t(48088),o=t(37719),a=t(32190),c=t(37647),u=t(28086);async function p(e){try{let r,t=process.env.OPENAI_API_KEY;if(!t)return a.NextResponse.json({error:"Missing OPENAI_API_KEY"},{status:500});let s=await e.json().catch(()=>null),n=s?.courseId,i=s?.sectionId;if(!n||!i)return a.NextResponse.json({error:"Missing courseId or sectionId"},{status:400});let o=await (0,u.t)(),p=String(i),l=`${p}/captions.vtt`;console.log("Path : ",l);let{data:d,error:h}=await o.storage.from("translations").download(l);if(h||!d)return a.NextResponse.json({error:`Unable to download captions: ${h?.message||"not found"}`},{status:404});let m=await d.text();if(!m||0===m.trim().length)return a.NextResponse.json({error:"captions.vtt is empty"},{status:422});let g=new c.Ay({apiKey:t}),x=["Generate kid-friendly (elementary school) and neurodiversity-inclusive flashcards from this WebVTT transcript. Output ONLY the JSON array described.",m.length>12e4?m.slice(0,12e4):m].join("\n"),y=await g.chat.completions.create({model:process.env.OPENAI_MODEL_ID||"gpt-4o-mini",temperature:.3,messages:[{role:"system",content:'You are an assistant that generates educational multiple-choice flashcards from a transcript (WebVTT).\nAudience: children in elementary school (approximately ages 7–11).\nAccessibility: Make content engaging and inclusive for neurodivergent learners.\nReturn ONLY a valid JSON array, no code fences or prose.\nEach item must be an object with: "id" (number), "question" (string), "choices" (array of 3-6 short strings), and "correctAnswer" (string that exactly matches one of the choices).\nRules:\n- Use the same language as the transcript.\n- Base questions on key facts or concepts present in the transcript.\n- Reading level: Grade 2–5. Use short sentences and simple words.\n- Be friendly and encouraging; avoid sarcasm, idioms, and metaphors.\n- Keep one clear idea per question. Avoid trick questions.\n- Choices should be plausible, similar length, and clearly distinct; include exactly one correct answer.\n- Sensory-friendly wording: avoid intense or overwhelming language.\n- Ensure 5–20 items depending on transcript length.\n- Do not include explanations, metadata, or commentary.'},{role:"user",content:x}]}),f=y.choices?.[0]?.message?.content?.trim()||"";try{r=JSON.parse(f)}catch(t){let e=f.match(/\[[\s\S]*\]/);if(e)try{r=JSON.parse(e[0])}catch{}}if(!Array.isArray(r))return a.NextResponse.json({error:"Model did not return a JSON array",raw:f},{status:502});let v=r.map((e,r)=>{let t=Number(e?.id??r+1),s=String(e?.question||"").trim(),n=Array.isArray(e?.choices)?e.choices.map(e=>String(e)).slice(0,6):[],i=String(e?.correctAnswer||"").trim();return{id:t,question:s,choices:n,correctAnswer:i}}).filter(e=>e.id>0&&e.question&&Array.isArray(e.choices)&&e.choices.length>=3&&e.correctAnswer&&e.choices.includes(e.correctAnswer));if(0===v.length)return a.NextResponse.json({error:"No valid flashcards parsed",raw:f},{status:502});return a.NextResponse.json({flashcards:v},{status:200})}catch(e){return console.error("[generate-flashcards] Error:",e),a.NextResponse.json({error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function l(){return a.NextResponse.json({},{status:200})}let d=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/video/generate-flashcards/route",pathname:"/api/video/generate-flashcards",filename:"route",bundlePath:"app/api/video/generate-flashcards/route"},resolvedPagePath:"C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\api\\video\\generate-flashcards\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:m,serverHooks:g}=d;function x(){return(0,o.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:m})}},27910:e=>{"use strict";e.exports=require("stream")},28086:(e,r,t)=>{"use strict";t.d(r,{t:()=>i});var s=t(34386),n=t(44999);async function i(){let e=await (0,n.UL)();return(0,s.createServerClient)("https://qrowzznnnarfogfbnnow.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI",{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:t,options:s})=>e.set(r,t,s))}catch{}}}})}},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},37830:e=>{"use strict";e.exports=require("node:stream/web")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57075:e=>{"use strict";e.exports=require("node:stream")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{"use strict";e.exports=require("node:fs")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,580,6570,645,4386,4999,7294,7647],()=>t(23597));module.exports=s})();