(()=>{var e={};e.id=2972,e.ids=[2972],e.modules={1182:(e,r,t)=>{Promise.resolve().then(t.bind(t,26733))},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5910:(e,r,t)=>{Promise.resolve().then(t.bind(t,27087))},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},20141:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s}),t(43210);let s=(0,t(40700).r)(function({children:e}){return e},{requiredRole:"student"})},20337:(e,r,t)=>{"use strict";t.d(r,{NJ:()=>a,Ox:()=>c,W9:()=>l,YG:()=>o,bW:()=>n});var s=t(47828);function i(e,r){if(console.error(`Error while trying to ${r}:`,e),e instanceof Error&&"Request timed out"===e.message)throw Error(`Taking longer than expected to ${r}. Please check your connection and try again.`);throw e}async function n(){try{let{data:e,error:r}=await s.N.from("courses").select("categorie").not("categorie","is",null);if(r)throw r;if(!e)return[];let t=e.reduce((e,r)=>(r.categorie&&(e[r.categorie]=(e[r.categorie]||0)+1),e),{});return Object.entries(t).map(([e,r])=>({categorie:e,count:r}))}catch(e){i(e,"load categories")}}async function a(e){try{let{query:r="",creator_id:t,category:i,sort_by:n="created_at",sort_order:a="desc",page:o=1,limit:l=10}=e||{},c=(o-1)*l,d=s.N.from("courses").select("*, users!creator_id(name, photo_url, bio)");r&&(d=d.ilike("title",`%${r}%`)),t&&(d=d.eq("creator_id",t)),i&&(d=d.eq("categorie",i)),d=d.order(n,{ascending:"asc"===a}).range(c,c+l-1);let{data:u,error:m}=await d;if(m)throw m;if(!u)return[];return u.map(e=>({...e,creator:e.users}))}catch(e){i(e,"load courses")}}async function o(e){try{let{data:r,error:t}=await s.N.from("courses").select("*, users!creator_id(id, name, email, photo_url, role, bio)").eq("id",e).single();if(t)throw t;if(!r)return null;let{count:i}=await s.N.from("sections").select("*",{count:"exact",head:!0}).eq("course_id",e);return{...r,creator:r.users,section_count:i||0}}catch(r){console.error(`Error fetching course with ID ${e}:`,r),i(r,"load course")}}async function l(e){try{let{data:r,error:t}=await s.N.from("sections").select("*").eq("course_id",e).order("section_number",{ascending:!0});if(t)throw t;if(!r)return[];return r.map(e=>({id:e.id,course_id:e.course_id,section_number:e.section_number,title:e.title,duration:e.duration,playback_id:e.playback_id,chapters:e.chapters?Array.isArray(e.chapters)?e.chapters:JSON.parse(e.chapters):[],questions:e.questions?Array.isArray(e.questions)?e.questions:JSON.parse(e.questions):[],created_at:e.created_at}))}catch(r){console.error(`Error fetching sections for course ${e}:`,r),i(r,"load course sections")}}async function c(e){try{let{data:r,error:t}=await s.N.from("sections").select("*").eq("id",e).single();if(t)throw t;if(!r)return null;return{id:r.id,course_id:r.course_id,section_number:r.section_number,title:r.title,duration:r.duration,playback_id:r.playback_id,chapters:r.chapters?Array.isArray(r.chapters)?r.chapters:JSON.parse(r.chapters):[],questions:r.questions?Array.isArray(r.questions)?r.questions:JSON.parse(r.questions):[],created_at:r.created_at}}catch(r){console.error(`Error fetching section with ID ${e}:`,r),i(r,"load section")}}},26733:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u});var s=t(60687),i=t(43210),n=t(16189),a=t(86082);t(98294);var o=t(20337),l=t(57958),c=t(20444),d=t(95057);function u(){let e=(0,n.useParams)(),r=(0,n.useRouter)(),{user:t,dbUser:u,loading:m}=(0,a.As)(),[x,h]=(0,i.useState)(null),[p,g]=(0,i.useState)(null),[b,f]=(0,i.useState)(!0),[y,j]=(0,i.useState)(null);(0,i.useRef)(!1);let N=(0,i.useRef)(!1),[v,k]=(0,i.useState)(null),[w,C]=(0,i.useState)(!1),[_,q]=(0,i.useState)(null),[A,S]=(0,i.useState)(!1),[I,D]=(0,i.useState)(0),[z,P]=(0,i.useState)(null),[O,E]=(0,i.useState)("idle"),[F,T]=(0,i.useState)({}),[$,J]=(0,i.useState)({}),[M,U]=(0,i.useState)({}),[R,G]=(0,i.useState)(null),[B,W]=(0,i.useState)(!1),[X,K]=(0,i.useState)(!1),[Q,Z]=(0,i.useState)(!1),[L,V]=(0,i.useState)(0),[Y,H]=(0,i.useState)(0),[ee,er]=(0,i.useState)(!1),[et,es]=(0,i.useState)(!1),ei=e.courseId,en=e.sectionId,ea=()=>{V(e=>e+1),H(e=>e+1)},eo=()=>{H(e=>e+1)},el=()=>0===Y?0:Math.round(L/Y*100),ec=e=>e>=90?{emoji:"\uD83C\uDF1F",message:"Incroyable ! Tu es une superstar !",className:"kid-result-success"}:e>=80?{emoji:"\uD83C\uDF89",message:"Excellent travail ! Continue comme \xe7a !",className:"kid-result-success"}:e>=70?{emoji:"\uD83D\uDC4D",message:"Bravo ! Tu peux continuer !",className:"kid-result-success"}:{emoji:"\uD83D\uDCAA",message:"Continue \xe0 t'entra\xeener ! Essaie d'obtenir 70% ou plus.",className:"kid-result-failure"},ed=()=>{D(0),V(0),H(0),er(!1),es(!1),P(null),E("idle"),U({})},eu=async(e,r)=>{if(t&&ei&&en)try{let t=await fetch(`/api/progress/section?courseId=${encodeURIComponent(ei)}&sectionId=${encodeURIComponent(en)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({progressPercentage:100,quizScore:e,quizPassed:r})});if(t.ok)console.log("Quiz score saved successfully");else{let e=await t.json();console.error("Failed to save quiz score:",e)}}catch(e){console.error("Failed to save quiz score:",e)}};if(b||m)return(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(d.k,{}),(0,s.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading section content..."})]})});if(y)return(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsxs)("div",{className:"max-w-md rounded-lg bg-red-50 p-6 text-center dark:bg-red-900/20",children:[(0,s.jsx)("h2",{className:"mb-4 text-xl font-semibold text-red-800 dark:text-red-400",children:"Error"}),(0,s.jsx)("p",{className:"mb-4 text-red-700 dark:text-red-300",children:y}),(0,s.jsx)("button",{onClick:()=>r.back(),className:"rounded-lg bg-red-600 px-4 py-2 text-white transition-colors hover:bg-red-700",children:"Go Back"})]})});if(!x||!p)return null;let em=(0,l.UQ)(p.chapters||[]);return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,s.jsx)("div",{className:"border-b border-gray-200 bg-white dark:border-gray-700 dark:bg-gray-800",children:(0,s.jsx)("div",{className:"mx-auto max-w-7xl px-4 py-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("button",{onClick:()=>r.push(`/my-learning/${ei}`),className:"flex items-center text-gray-500 transition-colors hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:[(0,s.jsx)("svg",{className:"mr-2 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Course"]}),(0,s.jsx)("div",{className:"text-gray-300 dark:text-gray-600",children:"|"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:x.title}),(0,s.jsxs)("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Section ",p.section_number,": ",p.title]})]})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Math.round(p.duration||0)," minutes"]})]})})}),(0,s.jsx)("div",{className:"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8",children:(0,s.jsx)(c.A,{videoId:p.playback_id||"",watermark:t?.email,chapters:em,className:"w-full",userId:t?.id,courseId:ei,duration:p.duration,onProgress:async e=>{if(t&&e>=0&&(e%5==0||e>=98))try{let r=await fetch(`/api/progress/section?courseId=${encodeURIComponent(ei)}&sectionId=${encodeURIComponent(en)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({progressPercentage:e})});if(!r.ok){let e=await r.json();console.error("Failed to update progress:",e)}}catch(e){console.error("Failed to update section progress:",e)}},onChapterComplete:async e=>{if(e){try{let r=em.findIndex(r=>r.id===e.id);if(r>=0&&r===em.length-1)return}catch{}if(!0===e.flashcard){W(!0),K(!0);try{let r=e.startTime,t="number"==typeof e.duration?e.duration:void 0,s=await fetch("/api/video/generate-chapter-flashcard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({courseId:ei,sectionId:en,startTime:r,duration:t})});if(!s.ok)return void console.error("Failed to generate chapter flashcard",await s.text());let i=await s.json();i?.flashcard&&(G(i.flashcard),P(null),E("idle"))}catch(e){console.error("Error generating chapter flashcard:",e)}finally{K(!1)}}}},onComplete:async()=>{if(t)try{let e=await fetch(`/api/progress/section?courseId=${encodeURIComponent(ei)}&sectionId=${encodeURIComponent(en)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({progressPercentage:100})});if(e.ok)console.log("Video progress updated to 100%");else{let r=await e.json();console.error("Failed to update video progress:",r)}}catch(e){console.error("Failed to update video progress:",e)}if(!N.current){if(N.current=!0,Array.isArray(p?.questions)&&p?.questions.length>0){let e=(e=>{let r=[];return e.forEach((e,t)=>{let s=String(e?.type||"").trim();if("flashcard"===s){let s=String(e?.question||"").trim(),i=Array.isArray(e?.choices)?e.choices.map(e=>String(e)):[],n=String(e?.correctAnswer||"").trim();s&&i.length>=2&&n&&r.push({id:Number(e?.id??t+1),type:"flashcard",question:s,choices:i,correctAnswer:n})}else if("fillBlank"===s){let s=String(e?.sentence||"").trim(),i=Array.isArray(e?.choices)?e.choices.map(e=>String(e)):[],n=String(e?.correctAnswer||e?.correct_answer||"").trim(),a=e?.title!=null?String(e.title):void 0,o=e?.instructions!=null?String(e.instructions):void 0,l=e?.feedback&&"object"==typeof e.feedback?{correct:null!=e.feedback.correct?String(e.feedback.correct):void 0,incorrect:null!=e.feedback.incorrect?String(e.feedback.incorrect):void 0}:void 0;s&&i.length>=2&&n&&r.push({id:Number(e?.id??t+1),type:"fillBlank",title:a,instructions:o,sentence:s,choices:i,correctAnswer:n,feedback:l})}else if("matchingGame"===s||"matching"===s){let s=Array.isArray(e?.pairs)?e.pairs.map(e=>({left:String(e?.left||"").trim(),right:String(e?.right||"").trim()})):[],i=e?.title!=null?String(e.title):void 0,n=e?.instructions!=null?String(e.instructions):void 0,a=e?.feedback&&"object"==typeof e.feedback?{correct:null!=e.feedback.correct?String(e.feedback.correct):void 0,incorrect:null!=e.feedback.incorrect?String(e.feedback.incorrect):void 0}:void 0;s.length>=2&&r.push({id:Number(e?.id??t+1),type:"matchingGame",title:i,instructions:n,pairs:s,feedback:a})}}),r.slice(0,8)})(p.questions);if(e.length>0){q(e),ed(),S(!0),Z(!1);return}}S(!0),Z(!0);try{let e=await fetch("/api/video/generate-questions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sectionId:en,maxQuestions:8})});if(!e.ok)return void console.error("Failed to generate questions",await e.text());let r=await e.json();Array.isArray(r?.questions)&&r.questions.length>0&&(q(r.questions),ed())}catch(e){console.error("Error generating questions:",e)}finally{Z(!1)}}}})}),B&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>W(!1)}),(0,s.jsx)("div",{className:"relative z-10 w-full max-w-xl rounded-lg bg-white p-6 shadow-xl dark:bg-zinc-900",children:X||!R?(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)(d.k,{}),(0,s.jsx)("p",{className:"mt-3 text-sm text-gray-700 dark:text-gray-300",children:"G\xe9n\xe9ration de la r\xe9vision rapide…"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-4 text-sm text-gray-500",children:"R\xe9vision rapide"}),(0,s.jsx)("h3",{className:"mb-4 text-lg font-semibold",children:R.question}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-3",children:R.choices.map((e,r)=>{let t=z===e,i="idle"!==O&&e===R.correctAnswer,n="incorrect"===O&&t&&e!==R.correctAnswer,a="w-full rounded border px-4 py-3 text-left transition-colors",o=a+" border-gray-300 hover:bg-gray-50 dark:border-zinc-700 dark:hover:bg-zinc-800";return i&&(o=a+" border-emerald-600 bg-emerald-50 text-emerald-800 dark:border-emerald-500 dark:bg-emerald-900/30 dark:text-emerald-300"),n&&(o=a+" border-red-600 bg-red-50 text-red-800 dark:border-red-500 dark:bg-red-900/30 dark:text-red-300"),(0,s.jsxs)("button",{className:o,onClick:()=>{"idle"===O&&R&&(P(e),e===R.correctAnswer?(E("correct"),setTimeout(()=>{E("idle"),P(null),W(!1)},700)):(E("incorrect"),setTimeout(()=>{E("idle"),P(null)},800)))},disabled:"idle"!==O,children:[(0,s.jsx)("span",{className:"mr-2 inline-block h-2 w-2 rounded-full bg-current opacity-50"}),e]},r)})}),(0,s.jsx)("div",{className:"mt-6 flex items-center justify-end",children:(0,s.jsx)("button",{className:"rounded px-4 py-2 text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-zinc-800",onClick:()=>W(!1),children:"Skip"})})]})})]}),A&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-900/80 to-pink-900/80"}),(0,s.jsx)("div",{className:"relative z-10 w-full max-w-2xl",children:Q||!_?(0,s.jsx)("div",{className:"kid-quiz-container",children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)(d.k,{}),(0,s.jsxs)("p",{className:"mt-3 text-lg font-semibold text-white",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83E\uDDE0"})," Pr\xe9paration de ton quiz amusant..."]})]})}):et?(0,s.jsxs)("div",{className:"kid-quiz-container",children:[(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsx)("div",{className:"text-center",children:(()=>{let e=el(),t=ec(e);return(0,s.jsxs)("div",{className:`kid-result-message ${t.className}`,children:[(0,s.jsx)("div",{className:"kid-emoji bounce",style:{fontSize:"4rem",marginBottom:"1rem"},children:t.emoji}),(0,s.jsxs)("div",{className:"kid-score-display mb-6 justify-center",children:[(0,s.jsxs)("span",{children:["Score : ",e,"%"]}),(0,s.jsxs)("span",{children:["(",L,"/",Y,")"]})]}),(0,s.jsx)("h3",{className:"mb-4 text-2xl font-bold",children:t.message}),(0,s.jsx)("div",{className:"mt-6 flex flex-col justify-center gap-4 sm:flex-row",children:e>=70?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{className:"kid-btn-secondary",onClick:async()=>{try{S(!1);let e=await (0,o.W9)(ei);if(Array.isArray(e)&&e.length>0){let t=e.findIndex(e=>e.id===p.id),s=t>=0?e[t+1]:void 0;if(s)return void r.push(`/my-learning/${ei}/section/${s.id}`)}r.push(`/my-learning/${ei}`)}catch(e){console.error("Navigate to next section error:",e),r.push(`/my-learning/${ei}`)}},children:[(0,s.jsx)("span",{className:"kid-emoji",children:"✨"})," Continuer \xe0 apprendre"]}),(0,s.jsxs)("button",{className:"kid-btn-primary",onClick:()=>r.push(`/my-learning/${ei}`),children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83C\uDFE0"})," Retour au cours"]}),(0,s.jsxs)("button",{className:"kid-btn-primary",onClick:async()=>{try{es(!1),Z(!0),ed();let e=await fetch("/api/video/new-quiz",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sectionId:en,maxQuestions:8,previous:Array.isArray(_)?_:void 0})});if(e.ok){let r=await e.json();Array.isArray(r?.questions)&&r.questions.length>0?(q(r.questions),ed()):console.error("No new questions returned")}else console.error("Failed to fetch new quiz",await e.text())}catch(e){console.error("Error regenerating quiz:",e)}finally{Z(!1)}},children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83D\uDD01"})," Refaire le quiz"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{className:"kid-btn-primary",onClick:async()=>{try{es(!1),Z(!0),ed();let e=await fetch("/api/video/new-quiz",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sectionId:en,maxQuestions:8,previous:Array.isArray(_)?_:void 0})});if(e.ok){let r=await e.json();Array.isArray(r?.questions)&&r.questions.length>0?(q(r.questions),ed()):console.error("No new questions returned")}else console.error("Failed to fetch new quiz",await e.text())}catch(e){console.error("Error regenerating quiz:",e)}finally{Z(!1)}},children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83D\uDD04"})," R\xe9essayer"]}),(0,s.jsxs)("button",{className:"kid-btn-secondary",onClick:()=>S(!1),children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83D\uDCDA"})," \xc9tudier plus"]})]})})]})})()})]}):I>=_.length?(()=>{if(!ee){er(!0),es(!0);let e=el();eu(e,e>=70)}return null})():(0,s.jsxs)("div",{className:"kid-quiz-container",children:[(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsx)("div",{className:"kid-confetti"}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,s.jsxs)("span",{className:"text-lg font-bold text-white",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83C\uDFAF"})," Question ",I+1," sur"," ",_.length]}),(0,s.jsxs)("div",{className:"kid-score-display",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"⭐"}),(0,s.jsxs)("span",{children:[L,"/",Y]})]})]}),(0,s.jsx)("div",{className:"kid-progress-bar",children:(0,s.jsx)("div",{className:"kid-progress-fill",style:{width:`${(I+1)/_.length*100}%`}})})]}),(0,s.jsx)("div",{className:"kid-question-card",children:(()=>{let e=_[I];if("flashcard"===e.type)return(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"mb-6 text-center text-2xl font-bold text-gray-800",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83E\uDD14"})," ",e.question]}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-4",children:e.choices.map((r,t)=>{let i=z===r,n="idle"!==O&&r===e.correctAnswer,a="incorrect"===O&&i&&r!==e.correctAnswer,o="kid-answer-btn";n&&(o+=" correct"),a&&(o+=" incorrect");let l=["\uD83C\uDD70️","\uD83C\uDD71️","\uD83C\uDD70️","\uD83C\uDD71️"];return(0,s.jsxs)("button",{className:o,onClick:()=>{"idle"===O&&(P(r),r===e.correctAnswer?(ea(),E("correct"),setTimeout(()=>{E("idle"),P(null),D(e=>e+1)},1200)):(eo(),E("incorrect"),setTimeout(()=>{E("idle"),P(null),D(e=>e+1)},1200)))},disabled:"idle"!==O,children:[(0,s.jsx)("span",{className:"text-2xl",children:l[t%l.length]}),(0,s.jsx)("span",{className:"flex-1 text-left",children:r}),n&&(0,s.jsx)("span",{className:"text-2xl",children:"✅"}),a&&(0,s.jsx)("span",{className:"text-2xl",children:"❌"})]},t)})})]});if("fillBlank"===e.type){let r=String(e.sentence||"").replace("____","______");return(0,s.jsxs)("div",{children:[e.title&&(0,s.jsxs)("h3",{className:"mb-4 text-center text-2xl font-bold text-gray-800",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"✏️"})," ",e.title]}),e.instructions&&(0,s.jsx)("p",{className:"mb-4 text-center text-lg font-medium text-gray-700",children:e.instructions}),(0,s.jsx)("div",{className:"border-3 mb-6 rounded-2xl border-dashed border-blue-300 bg-gradient-to-r from-blue-50 to-purple-50 p-6",children:(0,s.jsxs)("p",{className:"text-center text-xl font-bold leading-relaxed text-gray-800",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83D\uDCDD"})," ",r]})}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3",children:e.choices.map((r,t)=>{let i=z===r,n="idle"!==O&&r===e.correctAnswer,a="incorrect"===O&&i&&r!==e.correctAnswer,o="kid-answer-btn text-center";return n&&(o+=" correct"),a&&(o+=" incorrect"),(0,s.jsxs)("button",{className:o,onClick:()=>{"idle"===O&&(P(r),r===e.correctAnswer?(ea(),E("correct"),setTimeout(()=>{E("idle"),P(null),D(e=>e+1)},1200)):(eo(),E("incorrect"),setTimeout(()=>{E("idle"),P(null),D(e=>e+1)},1200)))},disabled:"idle"!==O,children:[(0,s.jsx)("span",{className:"font-bold",children:r}),n&&(0,s.jsx)("span",{className:"ml-2",children:"✅"}),a&&(0,s.jsx)("span",{className:"ml-2",children:"❌"})]},t)})}),"idle"!==O&&e.feedback&&(0,s.jsxs)("div",{className:`mt-6 rounded-xl p-4 text-center font-semibold ${"correct"===O?"border-2 border-green-300 bg-green-100 text-green-800":"border-2 border-orange-300 bg-orange-100 text-orange-800"}`,children:[(0,s.jsx)("span",{className:"kid-emoji",children:"correct"===O?"\uD83C\uDF89":"\uD83D\uDCAA"})," ","correct"===O?e.feedback.correct||"Fantastique !":e.feedback.incorrect||"Continue \xe0 essayer !"]})]})}if("matchingGame"===e.type){let r=e.pairs.map(e=>e.left),t=e.pairs.map(e=>e.right),i=F[I]||{},n=(e,r)=>{T(t=>({...t,[I]:{...t[I],[e]:r}}))};return(0,s.jsxs)("div",{children:[e.title&&(0,s.jsxs)("h3",{className:"mb-4 text-center text-2xl font-bold text-gray-800",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83D\uDD17"})," ",e.title]}),e.instructions&&(0,s.jsx)("p",{className:"mb-6 text-center text-lg font-medium text-gray-700",children:e.instructions}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:r.map((e,r)=>(0,s.jsxs)("div",{className:`border-3 rounded-2xl p-4 transition-all ${M[I]&&$[r]?"animate-wiggle border-red-400 bg-red-50":M[I]&&i[r]&&!$[r]?"border-green-400 bg-green-50":i[r]?"border-blue-400 bg-blue-100":"border-blue-300 bg-blue-50"}`,children:[(0,s.jsxs)("div",{className:"mb-3 text-center text-lg font-bold text-gray-800",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83C\uDFAF"})," ",e]}),(0,s.jsxs)("select",{className:`w-full rounded-xl border-2 px-4 py-3 text-center text-lg font-semibold ${M[I]&&$[r]?"border-red-500 bg-red-100":M[I]&&i[r]&&!$[r]?"border-green-500 bg-green-100":"border-blue-400 bg-white"}`,value:i[r]||"",onChange:e=>n(r,e.target.value),children:[(0,s.jsx)("option",{value:"",disabled:!0,children:"Choisir... \uD83E\uDD14"}),t.map((e,r)=>(0,s.jsx)("option",{value:e,children:e},r))]}),M[I]&&$[r]&&(0,s.jsxs)("p",{className:"mt-2 text-center font-bold text-red-600",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"❌"})," R\xe9essaie !"]}),M[I]&&i[r]&&!$[r]&&(0,s.jsxs)("p",{className:"mt-2 text-center font-bold text-green-600",children:[(0,s.jsx)("span",{className:"kid-emoji",children:"✅"})," Excellent choix !"]})]},r))}),(0,s.jsx)("div",{className:"mt-8 text-center",children:(0,s.jsxs)("button",{className:"kid-btn-primary px-8 py-4 text-xl",onClick:()=>{let r={},t=0;e.pairs.forEach((e,s)=>{let n=i[s];n&&n===e.right?t++:r[s]=!0}),J(r);let s=Object.values(r).every(e=>!1===e);U(e=>({...e,[I]:!0})),s?(ea(),setTimeout(()=>{J({}),T(e=>({...e,[I]:{}})),U(e=>({...e,[I]:!1})),D(e=>e+1)},1500)):eo()},disabled:Object.keys(i).length<r.length,children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83C\uDFAA"})," V\xe9rifier mes associations !"]})})]})}return null})()}),(0,s.jsx)("div",{className:"mt-6 text-center",children:(0,s.jsxs)("button",{className:"kid-btn-secondary opacity-75 hover:opacity-100",onClick:()=>S(!1),children:[(0,s.jsx)("span",{className:"kid-emoji",children:"\uD83D\uDEAA"})," Quitter le quiz"]})})]})})]}),w&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>C(!1)}),(0,s.jsx)("div",{className:"relative z-10 w-full max-w-xl rounded-lg bg-white p-6 shadow-xl dark:bg-zinc-900",children:Q||!v||0===v.length?(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)(d.k,{}),(0,s.jsx)("p",{className:"mt-3 text-sm text-gray-700 dark:text-gray-300",children:"G\xe9n\xe9ration des questions flash…"})]}):I>=v.length?(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h3",{className:"mb-4 text-xl font-semibold",children:"Bravo! \uD83C\uDF89"}),(0,s.jsx)("p",{className:"mb-6 text-gray-600 dark:text-gray-300",children:"Tu as termin\xe9 toutes les questions flash."}),(0,s.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,s.jsx)("button",{className:"rounded bg-emerald-600 px-4 py-2 text-white hover:bg-emerald-700",onClick:()=>C(!1),children:"Close"}),(0,s.jsx)("button",{className:"rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",onClick:()=>r.push(`/my-learning/${ei}`),children:"Back to Course"})]})]}):(()=>{let e=v[I];return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"mb-4 text-sm text-gray-500",children:["Question ",I+1," of ",v.length]}),(0,s.jsx)("h3",{className:"mb-4 text-lg font-semibold",children:e.question}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-3",children:e.choices.map((r,t)=>{let i=z===r,n="idle"!==O&&r===e.correctAnswer,a="incorrect"===O&&i&&r!==e.correctAnswer,o="w-full rounded border px-4 py-3 text-left transition-colors",l=o+" border-gray-300 hover:bg-gray-50 dark:border-zinc-700 dark:hover:bg-zinc-800";return n&&(l=o+" border-emerald-600 bg-emerald-50 text-emerald-800 dark:border-emerald-500 dark:bg-emerald-900/30 dark:text-emerald-300"),a&&(l=o+" border-red-600 bg-red-50 text-red-800 dark:border-red-500 dark:bg-red-900/30 dark:text-red-300"),(0,s.jsxs)("button",{className:l,onClick:()=>{"idle"===O&&v&&(P(r),r===v[I].correctAnswer?(E("correct"),setTimeout(()=>{E("idle"),P(null),D(e=>e+1)},700)):(E("incorrect"),setTimeout(()=>{k(e=>{if(!e)return e;let r=e.slice(),[t]=r.splice(I,1);return r.push(t),r}),E("idle"),P(null)},800)))},disabled:"idle"!==O,children:[(0,s.jsx)("span",{className:"mr-2 inline-block h-2 w-2 rounded-full bg-current opacity-50"}),r]},t)})}),(0,s.jsx)("div",{className:"mt-6 flex items-center justify-end",children:(0,s.jsx)("button",{className:"rounded px-4 py-2 text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-zinc-800",onClick:()=>C(!1),children:"Exit"})})]})})()})]})]})}},27087:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\Konan\\\\Documents\\\\MONSPACE\\\\CourseWebsite-1\\\\app\\\\my-learning\\\\[courseId]\\\\section\\\\[sectionId]\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\my-learning\\[courseId]\\section\\[sectionId]\\page.tsx","default")},27558:(e,r,t)=>{Promise.resolve().then(t.bind(t,20141))},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},29867:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\Konan\\\\Documents\\\\MONSPACE\\\\CourseWebsite-1\\\\app\\\\my-learning\\\\[courseId]\\\\layout.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\my-learning\\[courseId]\\layout.tsx","default")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},40598:(e,r,t)=>{Promise.resolve().then(t.bind(t,64626))},40700:(e,r,t)=>{"use strict";t.d(r,{r:()=>o});var s=t(60687),i=t(86082);let n=()=>(0,s.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary-600 border-t-transparent"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}),a=()=>(0,s.jsx)("div",{className:"flex min-h-screen items-center justify-center px-4 py-12 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"mb-4 text-2xl font-bold",children:"Access Denied"}),(0,s.jsx)("p",{className:"mb-6 text-gray-600",children:"You need to be signed in to access this page."}),(0,s.jsx)("a",{href:"/signin",className:"inline-flex h-10 items-center justify-center rounded-md bg-primary-600 px-4 font-medium text-white transition-colors hover:bg-primary-700",children:"Sign In"})]})});function o(e,{requiredRole:r,requireAuth:t=!0,loadingComponent:l=(0,s.jsx)(n,{}),unauthorizedComponent:c=(0,s.jsx)(a,{})}={}){return function(n){let{user:a,loading:o,checkPermission:d}=(0,i.As)();return o?l:t&&!a||r&&!d(r)?c:(0,s.jsx)(e,{...n})}}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64158:(e,r,t)=>{Promise.resolve().then(t.bind(t,74352))},64626:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\Konan\\\\Documents\\\\MONSPACE\\\\CourseWebsite-1\\\\app\\\\my-learning\\\\layout.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\my-learning\\layout.tsx","default")},74075:e=>{"use strict";e.exports=require("zlib")},74352:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>l});var s=t(60687),i=t(86082),n=t(40700),a=t(95057),o=t(16189);t(43210);let l=(0,n.r)(function({children:e}){let{user:r,loading:t}=(0,i.As)();return((0,o.useRouter)(),t)?(0,s.jsx)("div",{className:"flex min-h-[50vh] items-center justify-center",children:(0,s.jsx)(a.k,{size:"large"})}):r?(0,s.jsx)(s.Fragment,{children:e}):null},{requireAuth:!0})},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},87390:(e,r,t)=>{Promise.resolve().then(t.bind(t,29867))},87656:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>a.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c});var s=t(65239),i=t(48088),n=t(88170),a=t.n(n),o=t(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);t.d(r,l);let c={children:["",{children:["my-learning",{children:["[courseId]",{children:["section",{children:["[sectionId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,27087)),"C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\my-learning\\[courseId]\\section\\[sectionId]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,29867)),"C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\my-learning\\[courseId]\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,64626)),"C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\my-learning\\layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,58014)),"C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["C:\\Users\\Konan\\Documents\\MONSPACE\\CourseWebsite-1\\app\\my-learning\\[courseId]\\section\\[sectionId]\\page.tsx"],u={require:t,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/my-learning/[courseId]/section/[sectionId]/page",pathname:"/my-learning/[courseId]/section/[sectionId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},95057:(e,r,t)=>{"use strict";t.d(r,{k:()=>i});var s=t(60687);function i({size:e="medium",color:r="blue"}){return(0,s.jsx)("div",{className:`
        ${{small:"h-4 w-4 border-2",medium:"h-8 w-8 border-2",large:"h-12 w-12 border-3"}[e]}
        ${{blue:"border-blue-200 border-t-blue-600",white:"border-gray-200/30 border-t-white"}[r]}
        animate-spin rounded-full border-solid
      `,role:"status","aria-label":"Chargement",children:(0,s.jsx)("span",{className:"sr-only",children:"Chargement..."})})}},98294:(e,r,t)=>{"use strict";t.d(r,{d:()=>a,e:()=>n});var s=t(29605),i=t(57958);async function n(e,r={}){if(!e)return console.log("No user ID provided"),{data:[],error:"User not authenticated",count:0};try{console.log(`Fetching enrollments for user: ${e}`);let t=(0,s.createBrowserClient)("https://qrowzznnnarfogfbnnow.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI"),{limit:i=50,offset:n=0,sortBy:a="enrolledAt",sortOrder:o="desc",status:l="all"}=r;console.log(`Query params: limit=${i}, offset=${n}, sortBy=${a}, sortOrder=${o}, status=${l}`);let c=t.from("enrollments").select(`
        id,
        status,
        enrolled_at,
        course:course_id (
          id,
          title,
          description,
          thumbnail_url,
          created_at,
          creator_id,
          playback_id
        )
        `,{count:"exact"}).eq("user_id",e);"all"!==l&&(c=c.eq("status",l));let{data:d,error:u,count:m}=await c.order("title"===a?"course.title":"enrolled_at",{ascending:"asc"===o}).range(n,n+i-1);if(u)return console.error("Supabase error:",u),{data:[],error:u.message,count:0};if(!d?.length)return console.log("No enrollments found for user:",e),{data:[],error:null,count:m??0};let x={};try{let r=d.map(e=>Array.isArray(e.course)?e.course[0]?.id:e.course?.id).filter(Boolean);if(r.length>0){let{data:s,error:i}=await t.from("courses_progress").select("course_id, progress, updated_at").eq("user_id",e).in("course_id",r);!i&&s&&(x=s.reduce((e,r)=>(e[r.course_id]={progress:Number(r.progress??0),updated_at:r.updated_at},e),{}))}}catch(e){console.warn("Could not fetch persistent course progress:",e)}let h=d.map(e=>{let r={id:e.id,status:e.status,enrolled_at:e.enrolled_at},t=Array.isArray(e.course)?e.course[0]:e.course,s={id:t.id,title:t.title,description:t.description,thumbnail_url:t.thumbnail_url,created_at:t.created_at,creator_id:t.creator_id,playback_id:t.playback_id},i=x[s.id]?.progress??0,n=x[s.id]?.updated_at;return 0===i,{id:s.id,title:s.title,description:s.description,thumbnail_url:s.thumbnail_url,created_at:s.created_at,creator_id:s.creator_id,progress:i,lastAccessedAt:n,playbackId:s.playback_id,enrollment:r}});return console.log(`Returning ${h.length} enrolled course(s)`),{data:h,error:null,count:m??0}}catch(e){return console.error("Failed to get enrolled courses:",e),{data:[],error:"Failed to fetch enrolled courses",count:0}}}async function a(e,r){if(!e)return console.log("No user ID provided"),{data:null,error:"User not authenticated"};if(!r)return console.log("No course ID provided"),{data:null,error:"Course ID is required"};try{let t;console.log(`Fetching enrollment for user: ${e} and course: ${r}`);let n=(0,s.createBrowserClient)("https://qrowzznnnarfogfbnnow.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyb3d6em5ubmFyZm9nZmJubm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNjg1MzUsImV4cCI6MjA2NzY0NDUzNX0.MkCeFSLoOyGl-y1_eZTXTXXV8hGOJM7WuBV7gvLc_rI"),{data:a,error:o}=await n.from("enrollments").select(`
        id,
        status,
        enrolled_at,
        course:course_id (
          id,
          title,
          description,
          thumbnail_url,
          created_at,
          creator_id,
          playback_id,
          chapters
        )
      `).eq("user_id",e).eq("course_id",r).eq("status","active").single();if(o)return console.error("Supabase error:",o),{data:null,error:o.message};if(!a)return console.log("No enrollment found for user:",e,"and course:",r),{data:null,error:"Not enrolled in this course"};let l=Array.isArray(a.course)?a.course[0]:a.course,c=0;try{let{data:r,error:s}=await n.from("courses_progress").select("progress, updated_at").eq("user_id",e).eq("course_id",l.id).maybeSingle();!s&&r&&(c=Number(r.progress??0),t=r.updated_at??void 0)}catch(e){console.warn("Could not fetch persisted progress:",e)}let d=new Date().toISOString();return{data:{id:l.id,title:l.title,description:l.description,thumbnail_url:l.thumbnail_url,created_at:l.created_at,creator_id:l.creator_id,progress:c,lastAccessedAt:t??d,chapters:(0,i.UQ)(l.chapters),enrollment:{id:a.id,status:a.status,enrolled_at:a.enrolled_at},playbackId:l.playback_id},error:null}}catch(e){return console.error("Failed to get enrolled course:",e),{data:null,error:"Failed to fetch enrolled course"}}}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,9278,1658,9605,9679,6356],()=>t(87656));module.exports=s})();